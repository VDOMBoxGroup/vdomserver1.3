<?xml version="1.0" encoding="utf-8"?>
<Type>
  <Information>
    <Name>xmldialog</Name>
    <DisplayName>#Lang(001)</DisplayName>
    <Description>#Lang(002)</Description>
    <ClassName>VDOM_xmldialog</ClassName>
    <ID>887e2a68-4cb0-e28a-6d7b-4dd41c35ca6a</ID>
    <Icon>#Res(723723b4-c8f4-5e4a-b02c-16fa8e0d53f7)</Icon>
    <EditorIcon>#Res(37abe2ec-e61a-8981-e929-16faba369563)</EditorIcon>
    <StructureIcon>#Res(9f1c05cd-fee2-6055-2ef4-16fae6375ed7)</StructureIcon>
    <Moveable>1</Moveable>
    <Resizable>3</Resizable>
    <Container>1</Container>
    <Category>Additional</Category>
    <Dynamic>1</Dynamic>
    <Version>1.188.6720</Version>
    <InterfaceType>1</InterfaceType>
    <OptimizationPriority>1</OptimizationPriority>
    <Containers>htmlcontainer, container</Containers>
    <Languages>en_US</Languages>
    <Handlers>set_attr</Handlers>
    <RemoteMethods/>
    <WCAG/>
    <XMLScriptName/>
  </Information>
  <Attributes>
    <Attribute>
      <Name>hierarchy</Name>
      <DisplayName>#Lang(101)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(201)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(2)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(301)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d+$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>top</Name>
      <DisplayName>#Lang(102)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(202)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(302)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>left</Name>
      <DisplayName>#Lang(103)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(203)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(303)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>width</Name>
      <DisplayName>#Lang(104)</DisplayName>
      <DefaultValue>400</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(204)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(304)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>height</Name>
      <DisplayName>#Lang(105)</DisplayName>
      <DefaultValue>300</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(205)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(305)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>title</Name>
      <DisplayName>#Lang(106)</DisplayName>
      <DefaultValue/>
      <Visible>1</Visible>
      <Help>#Lang(206)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(1000)</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(306)</ErrorValidationMessage>
      <RegularExpressionValidation>.*</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>xmldata</Name>
      <DisplayName>#Lang(107)</DisplayName>
      <DefaultValue/>
      <Visible>1</Visible>
      <Help>#Lang(207)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>MultiLine(50000)</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(307)</ErrorValidationMessage>
      <RegularExpressionValidation>.*</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>show</Name>
      <DisplayName>#Lang(108)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(208)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>DropDown((#Lang(401)|1)|(#Lang(402)|0))</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(308)</ErrorValidationMessage>
      <RegularExpressionValidation>[01]</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>modal</Name>
      <DisplayName>#Lang(109)</DisplayName>
      <DefaultValue>1</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(209)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>DropDown((#Lang(403)|1)|(#Lang(404)|0))</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(309)</ErrorValidationMessage>
      <RegularExpressionValidation>[01]</RegularExpressionValidation>
    </Attribute>
  </Attributes>
  <Languages>
    <Language Code="en_US">
      <Sentence ID="001">XML dialog</Sentence>
      <Sentence ID="002">The XML dialog type produces an object displayed as a dialog window. The content of the dialog is described in the 'XML data' attribute ib XML format.</Sentence>
      <Sentence ID="003"></Sentence>
      <Sentence ID="101">Herarchy</Sentence>
      <Sentence ID="102">Top</Sentence>
      <Sentence ID="103">Left</Sentence>
      <Sentence ID="104">Width</Sentence>
      <Sentence ID="105">Height</Sentence>
      <Sentence ID="106">Title</Sentence>
      <Sentence ID="107">XML data</Sentence>
      <Sentence ID="108">Show</Sentence>
      <Sentence ID="109">Modal</Sentence>
      <Sentence ID="201">Hierarchy of the object</Sentence>
      <Sentence ID="202">Distance from the top edge of the parent in pixels</Sentence>
      <Sentence ID="203">Distance from the left edge of the parent in pixels</Sentence>
      <Sentence ID="204">Width in pixels</Sentence>
      <Sentence ID="205">Height in pixels</Sentence>
      <Sentence ID="206">Title of the object to display, HTML allowed</Sentence>
      <Sentence ID="207">XML data</Sentence>
      <Sentence ID="208">Show dialog after page load</Sentence>
      <Sentence ID="209">Open dialog in modal window</Sentence>
      <Sentence ID="301">Incorrect value, must be positive integer</Sentence>
      <Sentence ID="302">Incorrect value, must be positive integer</Sentence>
      <Sentence ID="303">Incorrect value, must be positive integer</Sentence>
      <Sentence ID="304">Incorrect value, must be positive integer</Sentence>
      <Sentence ID="305">Incorrect value, must be positive integer</Sentence>
      <Sentence ID="306">Incorrect value</Sentence>
      <Sentence ID="307">Incorrect value</Sentence>
      <Sentence ID="308">Incorrect value</Sentence>
      <Sentence ID="309">Incorrect value</Sentence>
      <Sentence ID="401">Yes</Sentence>
      <Sentence ID="402">No</Sentence>
      <Sentence ID="403">Yes</Sentence>
      <Sentence ID="404">No</Sentence>
      <Sentence ID="501"></Sentence>
      <Sentence ID="502"></Sentence>
      <Sentence ID="503"></Sentence>
      <Sentence ID="504"></Sentence>
      <Sentence ID="505"></Sentence>
      <Sentence ID="506"></Sentence>
      <Sentence ID="507"></Sentence>
      <Sentence ID="508"></Sentence>
      <Sentence ID="509"></Sentence>
      <Sentence ID="601"></Sentence>
      <Sentence ID="602"></Sentence>
      <Sentence ID="603"></Sentence>
      <Sentence ID="604"></Sentence>
      <Sentence ID="605"></Sentence>
      <Sentence ID="701"></Sentence>
      <Sentence ID="702"></Sentence>
      <Sentence ID="703"></Sentence>
      <Sentence ID="704"></Sentence>
      <Sentence ID="705"></Sentence>
      <Sentence ID="706"></Sentence>
      <Sentence ID="707"></Sentence>
      <Sentence ID="801"></Sentence>
      <Sentence ID="802"></Sentence>
      <Sentence ID="803"></Sentence>
      <Sentence ID="804"></Sentence>
      <Sentence ID="805"></Sentence>
      <Sentence ID="806"></Sentence>
      <Sentence ID="807"></Sentence>
      <Sentence ID="901"></Sentence>
      <Sentence ID="902"></Sentence>
    </Language>
  </Languages>
  <Resources>
    <Resource ID="723723b4-c8f4-5e4a-b02c-16fa8e0d53f7" Name="Icon" Type="png"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0
NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNl
SUQ9InhtcC5paWQ6MDg4OURDOEQwNjI5MTFFMkFGRTc5NzQxNzY5NDk4RjIiIHhtcE1NOkRvY3Vt
ZW50SUQ9InhtcC5kaWQ6MDg4OURDOEUwNjI5MTFFMkFGRTc5NzQxNzY5NDk4RjIiPiA8eG1wTU06
RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODg5REM4QjA2MjkxMUUyQUZF
Nzk3NDE3Njk0OThGMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowODg5REM4QzA2MjkxMUUy
QUZFNzk3NDE3Njk0OThGMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1w
bWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuGucnAAAAUWSURBVHja1FldSFtXHP/FZtb4May2XU2n
smqn4MA5mKgtexjVrMUvXGnKvroXHwp7qjrtg0++TMRCHwbrg3sRIVMZ7RzOTDpEiMwwiXbi0PoS
mpm1NHGiRpOo2f9cb9IYb25urs57/cPhnHPPuSfnl//H73/u0QQCARwHMRgMOqraqHxKJZvKMyp9
VL4xm80bmuMAhEAkUzVaQWI0GpGVlQWn04n+/n5YLJYJGqvURns5GsDw58H23rkBwfdDc/nxYFVd
+0FMIAk41VZeXl7R3NwcepadnY2mpia2bsXExMTXCUqCiMMaPmGaEBL++efaSkNp6qjZuqoUiJ8e
jvH9/esE3zHeuAm9Xi+4L2ZmJG8y0zontlkpICKfHUYd3s7MzOR8gplTpLDnJH8z00pVMwgm5OMw
mUyCGmEOT9KboHYQrK6trYXL5UJ3dzccDge2t7e5mvX5qNWpuVL1/ru/jkza1AoiWHu9XgwNDbGN
w+12Y2vL7wA03wd5RBtt41arFQMDA4pzCNNGUVEREhMT0dDQwBW2v8++qKmh4engPG206MRAdHV1
QUnC1Gg0aGlp4YAIR8pXohXjD7/fj42NDcWA6HQ6UXMUBCJk/8ypfD6fYkCYOQn5pBAQ0ailFokF
IgREnLHVAyYu04qclJSUpCgAZl6xQISACE0qKytDe3u74pooKSk5mLPX19ejrq7uSMhOzphkZz8q
xpY7JolHWD01NYXBwUHFTau6uhqFhYXSCTFyIgOhFmYvKCiQqhFh1amF2aX4iGj4Zcze0dHBtVtb
W9HZ2SnY/r+ZXYqPJEidqCZ2j1sjkf94tPZRg4graqmJ2Q+kkdLSUlUwe3FxsXSNCE2soQMYi+FK
kV08ZLgn+1UTY8sBkxD+8ey4gRj+7gdY7KlILvxQnkaUBhE9agUgC0TayopSuQvTBvcJa+WXHvGo
JeUfdT94EP7RVlHRHsScvOzDhJqAyPWJTa83KpATaWnIuXsXO5R02ilfS6GT3vnGRqzQ8eBlfz/y
+FzN2deHVYsFGXSQO11VhZ3NTSzeuYNcnsPsfK53YI2IjW3Qj0bVCI0tPXqE3Fu38DpxUgYdnX3L
y3jW2/sqKaU5Jy9exIvHj5GUlxdyV7buDr8u9xsH1UgsgB6W4ouYlmdkBDo6S5y7epXrP+3pwerz
59Cmp+9idbmQkp/PrZOk18PrduMEpe6sHwTikXiM4DUCWWF0PQYQJi9mZnCWtLFJm7QPDXHPXuPz
N9fcHHIqK3HWaISWACzPz+MUAV8PA7IeDxC5XOCRACTv+nX42T+ekYELt29j9t49JCYnc2MvFxaQ
dfkycgwGuAgE01Y6AWHrBuRoZM91Vxz+EgvIe21t0GVm4vf79/EGOfsF2rDDaoXLxlEAfFtb+Ndu
xxk6kzufPEFiSgq3nmzTksvKHhFnzya/ePvaNSyOjWGOIhMrZ4aH8Q45/8jk5C4QdmEzPb0LZHYW
5ynjZquxdXeozsjJwc3x8dCaNpMJNtKoIEeyi56HP/5m8/n8cTv9IIVLdREi5IVfMR5RFSHGMjWf
6phdZhbrvnQlyl17RH9vNzxL3X8+39cIu6MPkz//mBrXBLQrhxJ+P2r8UvCiXzT1DuzdnNRL10jg
Pz/969ul9ZT5qD4ST+QqzMs9tHNFLBCR7bdOBxaW1jFzKOFXKRBBuZS7xtWjZisHZK3h48qvqM7H
8ZFFtu9IZ/+HipmK5RgBWeP3HZL/BBgAs5x/nssBafMAAAAASUVORK5CYII=]]></Resource>
    <Resource ID="37abe2ec-e61a-8981-e929-16faba369563" Name="Icon" Type="png"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACwklEQVR42m1TS08TURQ+Z2b6oIXW
2gemhaamCzbs0KT9AYaNCXFpYmKMK124YGGMMZiACwxuXJjGxC0LF7Bwr24IaxIoIUQFpOXVlpnp
Y/qYufd67gBViDe5c6e953zn+75zBhlzAFEBRVHg6hKCA+eCTgGapsHS0hKk02lYWVn5Mj4+fmd6
evoZMsYeU2zoKoBMOtvcPWUyYxyOj48CuVz+eT6fDxUKBR273a5F6AO2bUOn03GTOeeXqsvfkoFc
rVYLtre3IRgMWgsLC5+w1+vuUkxybW0NfD7ff2SI/omI0G63WSwW8+3u/poPBAZfkgRnv93ujKyv
r8PY2Bg4juMGyn0VSBbY3Ny0E4mEBiheJeLD82hZVonopegC6vU6qKrqUj6TIS4xIL/A6/U62WxW
q9UqM5FIdI4AWiXqQqpYLPYTPB5PH+hiyXfJigo6yWRSqzfMmej12By221bJtp0UtQb8fj9IMzOZ
DBDNv3LOAfwDA1Dc2HBC4bAmuPP6WiT6BpvNRgkAU1tbW/0Edi7BpX6ppW5H7PToqEc3Tl9Eo/G3
2GjUXQCZ6JBGQRvP9bNe78wL+b8EpgKKqjoMQDNN/cPQUPgjmqbhAnAK4jRM3DCgt7gIgpI98Thd
IajkvtNsghoMArcsYKbZ9wYNQ+8DCDKue3ICe7OzYNdqkJichGguB82dHYhOTADrdqG6uirKy8vo
DYddTajrp/vE1gWgcYPWwQGsPn0CPcOE7NQUhG5moFOpQvz2LWjs7QGSjN/fvoP+8wcqZLoEKMtJ
lD1WCMAol+Hzw0fgUDWV2imrahTI5JiTRE8gACgLVSq2rRsWHh6V9zmDEU4POTM90l4uH7pDI6SB
5AGXtiExpm+DywsA9aRafT8cj7/D+w/u3lNQuUHJitSkKIiRwYDbe/HvOIuLB8pPzBvweb+GIsMb
fwCDLsCecWjaaQAAAABJRU5ErkJggg==]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae6375ed7" Name="Icon" Type="jpg"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACwklEQVR42m1TS08TURQ+Z2b6oIXW
2gemhaamCzbs0KT9AYaNCXFpYmKMK124YGGMMZiACwxuXJjGxC0LF7Bwr24IaxIoIUQFpOXVlpnp
Y/qYufd67gBViDe5c6e953zn+75zBhlzAFEBRVHg6hKCA+eCTgGapsHS0hKk02lYWVn5Mj4+fmd6
evoZMsYeU2zoKoBMOtvcPWUyYxyOj48CuVz+eT6fDxUKBR273a5F6AO2bUOn03GTOeeXqsvfkoFc
rVYLtre3IRgMWgsLC5+w1+vuUkxybW0NfD7ff2SI/omI0G63WSwW8+3u/poPBAZfkgRnv93ujKyv
r8PY2Bg4juMGyn0VSBbY3Ny0E4mEBiheJeLD82hZVonopegC6vU6qKrqUj6TIS4xIL/A6/U62WxW
q9UqM5FIdI4AWiXqQqpYLPYTPB5PH+hiyXfJigo6yWRSqzfMmej12By221bJtp0UtQb8fj9IMzOZ
DBDNv3LOAfwDA1Dc2HBC4bAmuPP6WiT6BpvNRgkAU1tbW/0Edi7BpX6ppW5H7PToqEc3Tl9Eo/G3
2GjUXQCZ6JBGQRvP9bNe78wL+b8EpgKKqjoMQDNN/cPQUPgjmqbhAnAK4jRM3DCgt7gIgpI98Thd
IajkvtNsghoMArcsYKbZ9wYNQ+8DCDKue3ICe7OzYNdqkJichGguB82dHYhOTADrdqG6uirKy8vo
DYddTajrp/vE1gWgcYPWwQGsPn0CPcOE7NQUhG5moFOpQvz2LWjs7QGSjN/fvoP+8wcqZLoEKMtJ
lD1WCMAol+Hzw0fgUDWV2imrahTI5JiTRE8gACgLVSq2rRsWHh6V9zmDEU4POTM90l4uH7pDI6SB
5AGXtiExpm+DywsA9aRafT8cj7/D+w/u3lNQuUHJitSkKIiRwYDbe/HvOIuLB8pPzBvweb+GIsMb
fwCDLsCecWjaaQAAAABJRU5ErkJggg==]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae66214c8" Name="style" Type="css"><![CDATA[LnhtbC1kaWFsb2ctZm9ybSBkaXYucm93IHsNCiAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgIGNsZWFyOiBib3RoOw0KICAgIGZsb2F0OiBub25lOw0KfQ0KLnhtbC1kaWFsb2ctZm9ybSBkaXYucm93ID4gbGFiZWwgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIHdpZHRoOiA0NSU7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSB7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIHdpZHRoOiA1MCU7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5mdWxsc2l6ZSA+IGxhYmVsLA0KLnhtbC1kaWFsb2ctZm9ybSBkaXYuZnVsbHNpemUgPiBkaXYuaXRlbSB7DQogICAgZmxvYXQ6IG5vbmU7DQogICAgd2lkdGg6IDEwMCU7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgZGl2Lml0ZW0gPiBsYWJlbCB7DQogICAgZmxvYXQ6IG5vbmU7DQogICAgd2lkdGg6IGF1dG87DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYubGl2ZXNlYXJjaCA+IGlucHV0LA0KLnhtbC1kaWFsb2ctZm9ybSBkaXYucm93ID4gZGl2LnRleHRib3ggPiBpbnB1dCwNCi54bWwtZGlhbG9nLWZvcm0gZGl2LnJvdyA+IGRpdi5pdGVtID4gc2VsZWN0LA0KLnhtbC1kaWFsb2ctZm9ybSBkaXYucm93ID4gZGl2Lml0ZW0gPiB0ZXh0YXJlYSB7DQogICAgd2lkdGg6IDk5JTsNCiAgICByZXNpemU6IG5vbmU7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSBiciB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgY2xlYXI6IGJvdGg7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBoZWlnaHQ6IDFweDsNCn0NCi54bWwtZGlhbG9nLWZvcm0gZGl2LnN1Ym1pdCB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIG1hcmdpbi10b3A6IDEwcHg7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5zdWJtaXQgaW1nIHsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQovKiBsaXZlIHNlYXJjaCAqLw0KLnhtbC1kaWFsb2ctZm9ybSBkaXYubGl2ZXNlYXJjaCA+IGRpdi5zZWxlY3RlZC1pdGVtIHsNCiAgICBwYWRkaW5nLXRvcDogMnB4Ow0KICAgIGZvbnQtc2l6ZTogMTNweDsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgcGFkZGluZzogM3B4Ow0KICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5saXZlc2VhcmNoIHRleHRhcmVhIHsNCiAgICByZXNpemU6IG5vbmU7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5saXZlc2VhcmNoID4gZGl2LnNlbGVjdGVkLWl0ZW0gPiBzcGFuIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNkOWQ5ZDk7DQogICAgY3Vyc29yOiBkZWZhdWx0Ow0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMjBweDsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIC13ZWJraXQtYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCn0NCi54bWwtZGlhbG9nLWZvcm0gZGl2LmxpdmVzZWFyY2ggPiBkaXYuc2VsZWN0ZWQtaXRlbSA+IHNwYW4gPiBkaXYudmFsdWUgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBjb2xvcjogIzIyMjsNCiAgICBtYXJnaW46IDJweCA1cHg7DQogICAgbWF4LXdpZHRoOiAzMjVweDsNCiAgICBtYXgtaGVpZ2h0OiAxN3B4Ow0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgZGlyZWN0aW9uOiBsdHI7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KLnhtbC1kaWFsb2ctZm9ybSBkaXYubGl2ZXNlYXJjaCA+IGRpdi5zZWxlY3RlZC1pdGVtID4gc3BhbiA+IGRpdi5jbG9zZSB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAxNHB4Ow0KICAgIGhlaWdodDogMjBweDsNCiAgICBiYWNrZ3JvdW5kOiBuby1yZXBlYXQgdXJsKC85ZjFjMDVjZC1mZWUyLTYwNTUtMmVmNC0xNmZhZTQ1YWFhYjEucmVzKSAtNHB4IDA7DQogICAgb3BhY2l0eTogLjY7DQogICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5saXZlc2VhcmNoID4gZGl2LnNlbGVjdGVkLWl0ZW0gPiBzcGFuID4gZGl2LmNsb3NlOmhvdmVyIHsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KLnhtbC1kaWFsb2ctZm9ybSBkaXYubGl2ZXNlYXJjaCA+IGRpdi5zZWxlY3RlZC1pdGVtID4gc3Bhbjpob3ZlciB7DQogICAgYm9yZGVyLWNvbG9yOiAjYjliOWI5Ow0KfQ0KDQovKiByaWNoIHRleHQgZWRpdG9yIHN0eWxlICovDQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAjaW5wdXQgew0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICBmb250OiAxNHB4ICdDb3VyaWVyIE5ldycsIFZlcmRhbmE7DQogICAgYm9yZGVyOiAwDQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI2JiYjsNCiAgICBwYWRkaW5nOiAwIDFweCAxcHg7DQogICAgZm9udDogMTJweCBWZXJkYW5hLCBBcmlhbDsNCiAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50Ow0KfQ0KLnhtbC1kaWFsb2ctZm9ybSBkaXYucm93ID4gZGl2Lml0ZW0gPiBkaXYudGUgaWZyYW1lIHsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAudGVoZWFkZXIgew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjYmJiOw0KICAgIGJhY2tncm91bmQ6IHVybCgvOWYxYzA1Y2QtZmVlMi02MDU1LTJlZjQtMTZmYWU0NWRkZGQxLnJlcykgcmVwZWF0Ow0KICAgIHBhZGRpbmctdG9wOiAxcHgNCn0NCi54bWwtZGlhbG9nLWZvcm0gZGl2LnJvdyA+IGRpdi5pdGVtID4gZGl2LnRlIC50ZWhlYWRlciBzZWxlY3Qgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIG1hcmdpbi10b3A6IDVweDsNCiAgICB3aWR0aDogaW5pdGlhbDsNCn0NCi54bWwtZGlhbG9nLWZvcm0gZGl2LnJvdyA+IGRpdi5pdGVtID4gZGl2LnRlIC50ZWZvbnQgew0KICAgIG1hcmdpbi1sZWZ0OiAxMnB4DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAudGVzaXplIHsNCiAgICBtYXJnaW46IDAgM3B4DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAudGVzdHlsZSB7DQogICAgbWFyZ2luLXJpZ2h0OiAxMnB4DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAudGVkaXZpZGVyIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IDFweDsNCiAgICBoZWlnaHQ6IDMwcHg7DQogICAgYmFja2dyb3VuZDogI2NjYw0KfQ0KLnhtbC1kaWFsb2ctZm9ybSBkaXYucm93ID4gZGl2Lml0ZW0gPiBkaXYudGUgLnRlY29udHJvbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAzNHB4Ow0KICAgIGhlaWdodDogMzBweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKC85ZjFjMDVjZC1mZWUyLTYwNTUtMmVmNC0xNmZhZTQ2Y2NjYzEucmVzKQ0KfQ0KLnhtbC1kaWFsb2ctZm9ybSBkaXYucm93ID4gZGl2Lml0ZW0gPiBkaXYudGUgLnRlY29udHJvbDpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAzMHB4IDANCn0NCi54bWwtZGlhbG9nLWZvcm0gZGl2LnJvdyA+IGRpdi5pdGVtID4gZGl2LnRlIC50ZWZvb3RlciB7DQogICAgaGVpZ2h0OiAzMnB4Ow0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjYmJiOw0KICAgIGJhY2tncm91bmQ6ICNmNWY1ZjUNCn0NCi54bWwtZGlhbG9nLWZvcm0gZGl2LnJvdyA+IGRpdi5pdGVtID4gZGl2LnRlIC50b2dnbGUgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGJhY2tncm91bmQ6IHVybCgvOWYxYzA1Y2QtZmVlMi02MDU1LTJlZjQtMTZmYWU0NmNjY2MxLnJlcykgLTM0cHggMnB4IG5vLXJlcGVhdDsNCiAgICBwYWRkaW5nOiA5cHggMTNweCAwIDMxcHg7DQogICAgaGVpZ2h0OiAyM3B4Ow0KICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNjY2M7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGNvbG9yOiAjNjY2DQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAudG9nZ2xlOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmDQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAucmVzaXplIHsNCiAgICBmbG9hdDogcmlnaHQ7DQogICAgaGVpZ2h0OiAzMnB4Ow0KICAgIHdpZHRoOiAzMnB4Ow0KICAgIGJhY2tncm91bmQ6IHVybCgvOWYxYzA1Y2QtZmVlMi02MDU1LTJlZjQtMTZmYWU0NWJiYmIxLnJlcykgMTVweCAxNXB4IG5vLXJlcGVhdDsNCiAgICBjdXJzb3I6IHMtcmVzaXplDQp9DQoueG1sLWRpYWxvZy1mb3JtIGRpdi5yb3cgPiBkaXYuaXRlbSA+IGRpdi50ZSAjZWRpdG9yIHsNCiAgICBjdXJzb3I6IHRleHQ7DQogICAgbWFyZ2luOiAxMHB4DQp9DQo=]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae32145d0" Name="vdom_xml_dialog" Type="js"><![CDATA[U3RyaW5nLnByb3RvdHlwZS5mbXQ9ZnVuY3Rpb24oKXsNCiAgdmFyIGEgPSBhcmd1bWVudHM7DQogIHJldHVybiB0aGlzLnJlcGxhY2UoL3soXGQrKX0vZywgZnVuY3Rpb24obSwgbikgew0KICAgIHJldHVybiB0eXBlb2YgYVtuXSAhPSAndW5kZWZpbmVkJyA/IGFbbl0gOiBtOw0KICB9KTsNCn07DQoNCmpRdWVyeS51aS5kaWFsb2cucHJvdG90eXBlLmN1c3RvbUV2ZW50ID0gZnVuY3Rpb24oYXJncyl7DQogIHZhciBvYmpJRCA9IHRoaXMuZWxlbWVudC5jb250ZXh0LmlkLnN1YnN0cmluZygyKTsNCiAgZXhlY0V2ZW50QmluZGVkKG9iaklELCAnY3VzdG9tRXZlbnQnLCBhcmdzKTsNCn07DQoNCmpRdWVyeS51aS5kaWFsb2cucHJvdG90eXBlLnJlZ2lzdGVyQ2FsbGJhY2tzID0gZnVuY3Rpb24oY2FsbGJhY2tzKXsNCiAgdGhpcy5jYWxsYmFja3MgPSB0aGlzLmNhbGxiYWNrcyB8fCB7fTsNCiAgZm9yIChuYW1lIGluIGNhbGxiYWNrcyl7DQogICAgdGhpcy5jYWxsYmFja3NbbmFtZV0gPSBjYWxsYmFja3NbbmFtZV07DQogIH0NCn07DQoNCmpRdWVyeS51aS5kaWFsb2cucHJvdG90eXBlLmV4ZWN1dGVDYWxsYmFjayA9IGZ1bmN0aW9uKG5hbWUsIHBhcmFtcyl7DQogIHRoaXMuY2FsbGJhY2tzID0gdGhpcy5jYWxsYmFja3MgfHwge307DQogIHZhciBjYWxsYmFjayA9IHRoaXMuY2FsbGJhY2tzW25hbWVdOw0KICBpZiAoY2FsbGJhY2spDQogICAgY2FsbGJhY2socGFyYW1zKTsNCn07DQoNCmZ1bmN0aW9uIHZkb21feGRfbG9hZChkaWFsb2dJRCwgeG1sRGF0YSl7DQoNCiAgLy8gcmVtb3ZlIENEQVRBIHNjcGVjaWFsIHdyYXBwZXINCiAgeG1sRGF0YSA9IGpRdWVyeS50cmltKHhtbERhdGEpLnNwbGl0KCc8IS0tW0NEQVRBWycpLmpvaW4oJzwhW0NEQVRBWycpLnNwbGl0KCddXS0tPicpLmpvaW4oJ10nKyddPicpOw0KICBpZiAoeG1sRGF0YSA9PT0gJycpDQogICAgcmV0dXJuOw0KDQogIHZhciBCT09MX01BUCA9IHsNCiAgICAiMCI6IGZhbHNlLA0KICAgICJmYWxzZSI6IGZhbHNlLA0KICAgICIxIjogdHJ1ZSwNCiAgICAidHJ1ZSI6IHRydWUNCiAgfTsNCg0KICAvL1NvcnQgYnkga2V5IGZ1bmN0aW9uDQogIHZhciBzb3J0X2J5X2tleSA9IGZ1bmN0aW9uKGEgLGIpew0KICAgIGEgPSBhWzBdLnRvTG93ZXJDYXNlKCk7DQogICAgYiA9IGJbMF0udG9Mb3dlckNhc2UoKTsNCiAgICBpZiAoYSA9PSBiKQ0KICAgICAgcmV0dXJuIDA7DQoNCiAgICBpZiAoYSA+IGIpDQogICAgICByZXR1cm4gMTsNCg0KICAgIHJldHVybiAtMTsNCiAgfTsNCg0KICAvLyBTb3J0IGJ5IHZhbHVlIGZ1bmN0aW9uDQogIHZhciBzb3J0X2J5X3ZhbCA9IGZ1bmN0aW9uKGEgLGIpew0KICAgIGEgPSBhWzFdLnRvTG93ZXJDYXNlKCk7DQogICAgYiA9IGJbMV0udG9Mb3dlckNhc2UoKTsNCiAgICBpZiAoYSA9PSBiKQ0KICAgICAgcmV0dXJuIDA7DQoNCiAgICBpZiAoYSA+IGIpDQogICAgICByZXR1cm4gMTsNCg0KICAgIHJldHVybiAtMTsNCiAgfTsNCg0KICAvLyBTb3J0aW5nIG1hcA0KICBTT1JUX01BUCA9IHsNCiAgICAiMCI6ICJkZWZhdWx0IiwNCiAgICAiMSI6IHNvcnRfYnlfa2V5LA0KICAgICIyIjogc29ydF9ieV92YWwsDQogICAgImtleSI6IHNvcnRfYnlfa2V5LA0KICAgICJ2YWx1ZSI6IHNvcnRfYnlfdmFsDQogIH07DQoNCiAgLy9Tb3J0aW5nIG9yZGVyIG1hcA0KICBTT1JUX09SREVSX01BUCA9IHsNCiAgICAiMCI6ICJkZWZhdWx0IiwNCiAgICAiMSI6ICJhc2MiLA0KICAgICIyIjogImRlc2MiLA0KICAgICJhc2MiOiAiYXNjIiwNCiAgICAiZGVzYyI6ICJkZXNjIg0KICB9Ow0KDQogIC8vQ29tcG9uZW50cyBDU1MgY2xhc3NlcyBtYXANCiAgdmFyIENPTVBPTkVOVFNfQ1NTX01BUCA9IHsNCiAgICAiaGVhZGluZyIgOiAiaGVhZGluZyIsDQogICAgInRleHRib3giIDogInRleHRib3giLA0KICAgICJwYXNzd29yZCIgOiAicGFzc3dvcmQiLA0KICAgICJkcm9wZG93biIgOiAiZHJvcGRvd24iLA0KICAgICJyYWRpb2J1dHRvbiIgOiAicmFkaW8iLA0KICAgICJjaGVja2JveCIgOiAiY2hlY2tib3giLA0KICAgICJ0ZXh0YXJlYSIgOiAidGV4dGFyZWEiLA0KICAgICJoeXBlcnRleHQiIDogImh5cGVydGV4dCIsDQogICAgImJ1dHRvbiIgOiAiYnV0dG9uIiwNCiAgICAiY29udGFpbmVyIjogImNvbnRhaW5lciIsDQogICAgImxpdmVzZWFyY2giOiAibGl2ZXNlYXJjaCIsDQogICAgInJpY2h0ZXh0YXJlYSI6ICJyaWNodGV4dGFyZWEiLA0KICAgICJmaWxldXBsb2FkIiA6ICJmaWxldXBsb2FkIiwNCiAgfTsNCg0KICB2YXIgZXNjYXBlX3F1b3RlID0gZnVuY3Rpb24odGV4dCl7DQogICAgcmV0dXJuIHRleHQucmVwbGFjZSgvIi9nLCAiJnF1b3Q7Iik7DQogIH07DQoNCiAgdmFyIGdldF9lbGVtX3Byb3AgPSBmdW5jdGlvbihlbGVtLCBwcm9wKXsNCiAgICByZXR1cm4gZWxlbS5maW5kKCc+UHJvcGVydGllcz5Qcm9wZXJ0eVtuYW1lPScgKyBwcm9wICsgJ10nKS50ZXh0KCk7DQogIH07DQoNCiAgdmFyIGdldF9lbGVtX2F0dHIgPSBmdW5jdGlvbihlbGVtLCBhdHRyKXsNCiAgICByZXR1cm4gZWxlbS5hdHRyKGF0dHIpIHx8ICcnOw0KICB9Ow0KDQogIHZhciBnZXRfZWxlbV9wcm9wcyA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIHZhciBwcm9wZXJ0aWVzID0ge307DQogICAgZWxlbS5maW5kKCc+UHJvcGVydGllcz5Qcm9wZXJ0eScpLmVhY2goZnVuY3Rpb24oaW5kZXgsIHByb3BlcnR5KXsNCiAgICAgIHByb3BlcnR5ID0galF1ZXJ5KHByb3BlcnR5KTsNCiAgICAgIHByb3BlcnRpZXNbcHJvcGVydHkuYXR0cignbmFtZScpLnRvTG93ZXJDYXNlKCldID0gcHJvcGVydHkudGV4dCgpOw0KICAgIH0pOw0KDQogICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW0sIHByb3Apew0KICAgICAgcmV0dXJuIHByb3BlcnRpZXNbcHJvcC50b0xvd2VyQ2FzZSgpXSB8fCAnJzsNCiAgICB9DQogIH07DQoNCiAgdmFyIGdldF9lbGVtX2F0dHJzID0gZnVuY3Rpb24oZWxlbSl7DQogICAgdmFyIGF0dHJpYnV0ZXMgPSB7fTsNCiAgICAkLmVhY2goZWxlbVswXS5hdHRyaWJ1dGVzLCBmdW5jdGlvbihpbmRleCwgYXR0cmlidXRlKXsNCiAgICAgIGF0dHJpYnV0ZXNbYXR0cmlidXRlLm5hbWUudG9Mb3dlckNhc2UoKV0gPSBhdHRyaWJ1dGUudmFsdWU7DQogICAgfSk7DQoNCiAgICByZXR1cm4gZnVuY3Rpb24oZWxlbSwgYXR0cil7DQogICAgICByZXR1cm4gYXR0cmlidXRlc1thdHRyLnRvTG93ZXJDYXNlKCldIHx8ICcnOw0KICAgIH0NCiAgfTsNCg0KICB2YXIgZ2V0X2VsZW1fb3B0aW9ucyA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIHZhciBvcHRpb25zID0gW107DQogICAgZWxlbS5maW5kKCI+UHJvcGVydGllcz5Qcm9wZXJ0eVtuYW1lPW9wdGlvbnNdPm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oKXsNCiAgICAgIC8vIFRPRE8gLSByZXBsYWNlIGpxdWVyeSB3aXRoIGdldEF0dHJpYnV0ZSBjb2RlDQogICAgICB2YXIgb3B0aW9uID0galF1ZXJ5KHRoaXMpOw0KICAgICAgb3B0aW9ucy5wdXNoKFtnZXRfZWxlbV9hdHRyKG9wdGlvbiwgJ2lkJyksIG9wdGlvbi50ZXh0KCldKTsNCiAgICB9KTsNCiAgICByZXR1cm4gb3B0aW9uczsNCiAgfTsNCg0KICB2YXIgaXNfdmlzaWJsZSA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIC8vY2hlY2sgZWxlbWVudCdzIHZpc2liaWxpdHkNCiAgICByZXR1cm4gKEJPT0xfTUFQW2dldF9lbGVtX2F0dHIoZWxlbSwgJ3Zpc2libGUnKSB8fCAndHJ1ZSddKSA/ICcnIDogJ3N0eWxlPSJkaXNwbGF5OiBub25lIicgOyANCiAgfTsNCg0KICB2YXIgaXNfZnVsbHNpemUgPSBmdW5jdGlvbihlbGVtKXsNCiAgICAvL2NoZWNrIGlzIGVsZW1lbnQgZnVsbHNpemUgb3Igbm90DQogICAgcmV0dXJuIChCT09MX01BUFtnZXRfZWxlbV9hdHRyKGVsZW0sICdmdWxsc2l6ZScpXSB8fCBmYWxzZSkgPyAnZnVsbHNpemUnIDogJyc7IA0KICB9Ow0KDQogIHZhciBpc19tdWx0aXBsZSA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIC8vY2hlY2sgaXMgZWxlbWVudCBmdWxsc2l6ZSBvciBub3QNCiAgICByZXR1cm4gKEJPT0xfTUFQW2dldF9lbGVtX2F0dHIoZWxlbSwgJ211bHRpcGxlJyldIHx8IGZhbHNlKSA/ICdtdWx0aXBsZT0ibXVsdGlwbGUiJyA6ICcnOyANCiAgfTsNCg0KICB2YXIgaXNfZGlzYWJsZWQgPSBmdW5jdGlvbihlbGVtKXsNCiAgICAvL2NoZWNrIGlzIGVsZW1lbnQgZGlzYWJsZWQgb3Igbm90DQogICAgcmV0dXJuIChCT09MX01BUFtnZXRfZWxlbV9hdHRyKGVsZW0sICdkaXNhYmxlZCcpXSB8fCBmYWxzZSkgPyAnZGlzYWJsZWQ9ImRpc2FibGVkIicgOiAnJzsgDQogIH07DQoNCiAgdmFyIGlzX3JlYWRvbmx5ID0gZnVuY3Rpb24oZWxlbSl7DQogICAgLy9jaGVjayBpcyBlbGVtZW50IHJlYWRvbmx5IG9yIG5vdA0KICAgIHJldHVybiAoQk9PTF9NQVBbZ2V0X2VsZW1fYXR0cihlbGVtLCAncmVhZG9ubHknKV0gfHwgZmFsc2UpID8gJ3JlYWRvbmx5PSJyZWFkb25seSInIDogJyc7IA0KICB9Ow0KDQogIHZhciBtYWtlX2Rpdl9yb3cgPSBmdW5jdGlvbihodG1sLCBlbGVtLCBsYWJlbCwgb25seUZ1bGxzaXplKXsNCiAgICByZXR1cm4gIjxkaXYgY2xhc3M9J3JvdyB7MH0gezF9JyB7Mn0+PGxhYmVsIGNsYXNzPSd0aXRsZSc+ezN9PC9sYWJlbD48ZGl2IGNsYXNzPSdpdGVtIHs0fSc+ezV9PC9kaXY+PGJyIHN0eWxlPSdjbGVhcjogYm90aCcgLz48L2Rpdj4iLmZtdCgNCiAgICAgIChvbmx5RnVsbHNpemUgPyAiZnVsbHNpemUiIDogaXNfZnVsbHNpemUoZWxlbSkpLA0KICAgICAgZ2V0X2VsZW1fYXR0cihlbGVtLCAnY2xhc3MnKSwNCiAgICAgIGlzX3Zpc2libGUoZWxlbSksDQogICAgICBsYWJlbCwNCiAgICAgIENPTVBPTkVOVFNfQ1NTX01BUFtlbGVtWzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKV0sDQogICAgICBodG1sDQogICAgKTsNCiAgfTsNCg0KICB2YXIgcmVuZGVyX2hlYWRpbmcgPSBmdW5jdGlvbihlbGVtKXsNCiAgICBsZXZlbCA9IHBhcnNlSW50KGdldF9lbGVtX3Byb3AoZWxlbSwgJ2xldmVsJyksIDEwKSB8fCAzOw0KICAgIGxldmVsID0gbGV2ZWwgPj0gMSAmJiBsZXZlbCA8PTYgPyBsZXZlbCA6IDM7DQoNCiAgICByZXR1cm4gIjxoezB9IGNsYXNzPSd7MX0nIGlkPSd7Mn0nIHszfT57NH08L2h7MH0+Ii5mbXQoDQogICAgICBsZXZlbCwNCiAgICAgIGdldF9lbGVtX2F0dHIoZWxlbSwgJ2NsYXNzJyksDQogICAgICBlc2NhcGVfcXVvdGUoZ2V0X2VsZW1fYXR0cihlbGVtLCAnaWQnKSksDQogICAgICBpc192aXNpYmxlKGVsZW0pLA0KICAgICAgZ2V0X2VsZW1fcHJvcChlbGVtLCAndGV4dCcpDQogICAgICApOw0KICB9Ow0KDQogIHZhciByZW5kZXJfdGV4dGJveCA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIHZhciBlbGVtX3Byb3BzID0gZ2V0X2VsZW1fcHJvcHMoZWxlbSk7DQogICAgdmFyIGVsZW1fYXR0cnMgPSBnZXRfZWxlbV9hdHRycyhlbGVtKTsNCg0KICAgIHZhciBodG1sID0gIjxpbnB1dCB0eXBlPSd0ZXh0JyBuYW1lPSd7MH0nIHZhbHVlPSd7MX0nIHsyfSB7M30gLz4iLmZtdCgNCiAgICAgIGVzY2FwZV9xdW90ZShlbGVtX2F0dHJzKGVsZW0sICdpZCcpKSwNCiAgICAgIGVzY2FwZV9xdW90ZShlbGVtX3Byb3BzKGVsZW0sICdkZWZhdWx0VmFsdWUnKSksDQogICAgICBpc19kaXNhYmxlZChlbGVtKSwNCiAgICAgIGlzX3JlYWRvbmx5KGVsZW0pDQogICAgKTsNCg0KICAgIHJldHVybiBtYWtlX2Rpdl9yb3coaHRtbCwgZWxlbSwgZWxlbV9wcm9wcyhlbGVtLCAnbGFiZWwnKSk7DQogIH07DQoNCiAgdmFyIHJlbmRlcl9wYXNzd29yZCA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIHZhciBlbGVtX3Byb3BzID0gZ2V0X2VsZW1fcHJvcHMoZWxlbSk7DQogICAgdmFyIGVsZW1fYXR0cnMgPSBnZXRfZWxlbV9hdHRycyhlbGVtKTsNCiAgICANCiAgICB2YXIgaHRtbCA9ICI8aW5wdXQgdHlwZT0ncGFzc3dvcmQnIG5hbWU9J3swfScgdmFsdWU9J3sxfScgezJ9IHszfSAvPiIuZm10KA0KICAgICAgZXNjYXBlX3F1b3RlKGVsZW1fYXR0cnMoZWxlbSwgJ2lkJykpLA0KICAgICAgZXNjYXBlX3F1b3RlKGVsZW1fcHJvcHMoZWxlbSwgJ2RlZmF1bHRWYWx1ZScpKSwNCiAgICAgIGlzX2Rpc2FibGVkKGVsZW0pLA0KICAgICAgaXNfcmVhZG9ubHkoZWxlbSkNCiAgICApOw0KDQogICAgcmV0dXJuIG1ha2VfZGl2X3JvdyhodG1sLCBlbGVtLCBlbGVtX3Byb3BzKGVsZW0sICdsYWJlbCcpKTsNCiAgfTsNCg0KICB2YXIgcmVuZGVyX2Ryb3Bkb3duID0gZnVuY3Rpb24oZWxlbSl7DQogICAgdmFyIGVsZW1fcHJvcHMgPSBnZXRfZWxlbV9wcm9wcyhlbGVtKTsNCiAgICB2YXIgZWxlbV9hdHRycyA9IGdldF9lbGVtX2F0dHJzKGVsZW0pOw0KICAgIA0KICAgIHZhciByb3dzID0gcGFyc2VJbnQoZWxlbV9wcm9wcyhlbGVtLCAicm93cyIpLCAxMCkgfHwgMDsNCiAgICB2YXIgb3B0aW9ucyA9IGdldF9lbGVtX29wdGlvbnMoZWxlbSk7DQogICAgdmFyIHNvcnRfdHlwZSA9IFNPUlRfTUFQW2VsZW1fYXR0cnMoZWxlbSwgJ3NvcnQnKV0gfHwgJ2RlZmF1bHQnOw0KICAgIHZhciBzb3J0X29yZGVyID0gU09SVF9PUkRFUl9NQVBbZWxlbV9hdHRycyhlbGVtLCAnb3JkZXInKV0gfHwgJ2RlZmF1bHQnOw0KICAgIHZhciBzZWxlY3RlZF9rZXlzID0galF1ZXJ5Lm1hcChlbGVtX3Byb3BzKGVsZW0sICdzZWxlY3RlZCcpLnNwbGl0KCcsJyksIGpRdWVyeS50cmltKTsNCiAgICB2YXIgZGlzYWJsZWRfa2V5cyA9IGpRdWVyeS5tYXAoZWxlbV9wcm9wcyhlbGVtLCAnZGlzYWJsZWQnKS5zcGxpdCgnLCcpLCBqUXVlcnkudHJpbSk7DQoNCiAgICBpZiAoc29ydF90eXBlICE9ICdkZWZhdWx0Jyl7DQogICAgICBvcHRpb25zLnNvcnQoc29ydF90eXBlKTsNCg0KICAgICAgaWYgKHNvcnRfb3JkZXIgPT0gJ2Rlc2MnKQ0KICAgICAgICBvcHRpb25zLnJldmVyc2UoKTsNCiAgICB9DQoNCiAgICBpZiAoIWlzX211bHRpcGxlKGVsZW0pICYmIHNlbGVjdGVkX2tleXMubGVuZ3RoID4gMSl7DQogICAgICB2YXIgc2VsZWN0ZWRfa2V5cyA9IFtzZWxlY3RlZF9rZXlzW3NlbGVjdGVkX2tleXMubGVuZ3RoIC0gMV1dOw0KICAgIH0NCg0KICAgIHZhciBvcHRpb25zX3Jlc3VsdCA9IFtdOw0KICAgIGZvciAodmFyIGkgaW4gb3B0aW9ucyl7DQogICAgICB2YXIgb3B0aW9uID0gb3B0aW9uc1tpXTsNCiAgICAgIHZhciBvcHRfaWQgPSBvcHRpb25bMF07DQogICAgICBvcHRpb25zX3Jlc3VsdC5wdXNoKCI8b3B0aW9uIHZhbHVlPSd7MH0nezF9ezJ9PnszfTwvb3B0aW9uPiIuZm10KA0KICAgICAgICBlc2NhcGVfcXVvdGUob3B0X2lkKSwNCiAgICAgICAgKGpRdWVyeS5pbkFycmF5KG9wdF9pZCwgc2VsZWN0ZWRfa2V5cykgPj0gMCAmJiBqUXVlcnkuaW5BcnJheShvcHRfaWQsIGRpc2FibGVkX2tleXMpID09IC0xKSA/ICIgc2VsZWN0ZWQ9J3NlbGVjdGVkJyIgOiAiIiwNCiAgICAgICAgKGpRdWVyeS5pbkFycmF5KG9wdF9pZCwgZGlzYWJsZWRfa2V5cykgPj0gMCkgPyAiIGRpc2FibGVkPSdkaXNhYmxlZCciIDogIiIsDQogICAgICAgIG9wdGlvblsxXQ0KICAgICAgKSk7DQogICAgfQ0KDQogICAgdmFyIGh0bWwgPSAiPHNlbGVjdCBuYW1lPSd7MH0nIHsxfSB7Mn0gezN9Pns0fTwvc2VsZWN0PiIuZm10KA0KICAgICAgZXNjYXBlX3F1b3RlKGVsZW1fYXR0cnMoZWxlbSwgJ2lkJykpLA0KICAgICAgcm93cyA/ICgnc2l6ZT0iJyArIHJvd3MgKyAnIicpIDogJycsDQogICAgICBpc19tdWx0aXBsZShlbGVtKSwNCiAgICAgIGlzX2Rpc2FibGVkKGVsZW0pLA0KICAgICAgb3B0aW9uc19yZXN1bHQuam9pbignJykNCiAgICApOw0KDQogICAgcmV0dXJuIG1ha2VfZGl2X3JvdyhodG1sLCBlbGVtLCBlbGVtX3Byb3BzKGVsZW0sICdsYWJlbCcpKTsNCiAgfTsNCg0KICB2YXIgcmVuZGVyX3JhZGlvYnV0dG9uID0gZnVuY3Rpb24oZWxlbSl7DQogICAgdmFyIGVsZW1fcHJvcHMgPSBnZXRfZWxlbV9wcm9wcyhlbGVtKTsNCiAgICB2YXIgZWxlbV9hdHRycyA9IGdldF9lbGVtX2F0dHJzKGVsZW0pOw0KICAgIA0KICAgIHZhciBkaXNhYmxlZCA9IGlzX2Rpc2FibGVkKGVsZW0pOw0KICAgIHZhciBvcHRpb25zID0gZ2V0X2VsZW1fb3B0aW9ucyhlbGVtKTsNCiAgICB2YXIgc29ydF90eXBlID0gU09SVF9NQVBbZWxlbV9hdHRycyhlbGVtLCAnc29ydCcpXSB8fCAnZGVmYXVsdCc7DQogICAgdmFyIHNvcnRfb3JkZXIgPSBTT1JUX09SREVSX01BUFtlbGVtX2F0dHJzKGVsZW0sICdvcmRlcicpXSB8fCAnZGVmYXVsdCc7DQogICAgdmFyIGJyZWFrbGluZSA9IChCT09MX01BUFtlbGVtX2F0dHJzKGVsZW0sICdicmVha2xpbmUnKV0gfHwgZmFsc2UpID8gIjxici8+IiA6ICIiOw0KICAgIHZhciBzZWxlY3RlZF9rZXlzID0galF1ZXJ5Lm1hcChlbGVtX3Byb3BzKGVsZW0sICdzZWxlY3RlZCcpLnNwbGl0KCcsJyksIGpRdWVyeS50cmltKTsNCg0KICAgIGlmIChzb3J0X3R5cGUgIT0gJ2RlZmF1bHQnKXsNCiAgICAgIG9wdGlvbnMuc29ydChzb3J0X3R5cGUpOw0KDQogICAgICBpZiAoc29ydF9vcmRlciA9PSAnZGVzYycpDQogICAgICAgIG9wdGlvbnMucmV2ZXJzZSgpOw0KICAgIH0NCg0KICAgIHZhciBlbGVtX2lkID0gZWxlbV9hdHRycyhlbGVtLCAnaWQnKTsNCiAgICB2YXIgb3B0aW9uc19yZXN1bHQgPSBbXTsNCiAgICBmb3IgKHZhciBpIGluIG9wdGlvbnMpew0KICAgICAgdmFyIG9wdGlvbiA9IG9wdGlvbnNbaV07DQogICAgICB2YXIgb3B0X2lkID0gb3B0aW9uWzBdOw0KDQogICAgICBvcHRpb25zX3Jlc3VsdC5wdXNoKCI8bGFiZWw+PGlucHV0IGF1dG9jb21wbGV0ZT0nb2ZmJyB0eXBlPSdyYWRpbycgbmFtZT0nezB9JyB2YWx1ZT0nezF9J3syfSB7M30gLz4mbmJzcDt7NH08L2xhYmVsPns1fSIuZm10KA0KICAgICAgICBlbGVtX2lkLA0KICAgICAgICBlc2NhcGVfcXVvdGUob3B0X2lkKSwNCiAgICAgICAgKGpRdWVyeS5pbkFycmF5KG9wdF9pZCwgc2VsZWN0ZWRfa2V5cykgPj0gMCkgPyAiIGNoZWNrZWQ9J2NoZWNrZWQnIiA6ICIiLA0KICAgICAgICBkaXNhYmxlZCwNCiAgICAgICAgb3B0aW9uWzFdLA0KICAgICAgICBicmVha2xpbmUNCiAgICAgICkpOw0KICAgIH0NCg0KICAgIHZhciBodG1sID0gb3B0aW9uc19yZXN1bHQuam9pbignJyk7DQoNCiAgICByZXR1cm4gbWFrZV9kaXZfcm93KGh0bWwsIGVsZW0sIGVsZW1fcHJvcHMoZWxlbSwgJ2xhYmVsJykpOw0KICB9Ow0KDQogIHZhciByZW5kZXJfY2hlY2tib3ggPSBmdW5jdGlvbihlbGVtKXsNCiAgICB2YXIgZWxlbV9wcm9wcyA9IGdldF9lbGVtX3Byb3BzKGVsZW0pOw0KICAgIHZhciBlbGVtX2F0dHJzID0gZ2V0X2VsZW1fYXR0cnMoZWxlbSk7DQogICAgDQogICAgdmFyIGRpc2FibGVkID0gaXNfZGlzYWJsZWQoZWxlbSk7DQogICAgdmFyIG9wdGlvbnMgPSBnZXRfZWxlbV9vcHRpb25zKGVsZW0pOw0KICAgIHZhciBzb3J0X3R5cGUgPSBTT1JUX01BUFtlbGVtX2F0dHJzKGVsZW0sICdzb3J0JyldIHx8ICdkZWZhdWx0JzsNCiAgICB2YXIgc29ydF9vcmRlciA9IFNPUlRfT1JERVJfTUFQW2VsZW1fYXR0cnMoZWxlbSwgJ29yZGVyJyldIHx8ICdkZWZhdWx0JzsNCiAgICB2YXIgYnJlYWtsaW5lID0gKEJPT0xfTUFQW2VsZW1fYXR0cnMoZWxlbSwgJ2JyZWFrbGluZScpXSB8fCBmYWxzZSkgPyAiPGJyLz4iIDogIiI7DQogICAgdmFyIHNlbGVjdGVkX2tleXMgPSBqUXVlcnkubWFwKGVsZW1fcHJvcHMoZWxlbSwgJ3NlbGVjdGVkJykuc3BsaXQoJywnKSwgalF1ZXJ5LnRyaW0pOw0KICAgIHZhciBkaXNhYmxlZF9rZXlzID0galF1ZXJ5Lm1hcChlbGVtX3Byb3BzKGVsZW0sICdkaXNhYmxlZCcpLnNwbGl0KCcsJyksIGpRdWVyeS50cmltKTsNCg0KICAgIGlmIChzb3J0X3R5cGUgIT0gJ2RlZmF1bHQnKXsNCiAgICAgIG9wdGlvbnMuc29ydChzb3J0X3R5cGUpOw0KDQogICAgICBpZiAoc29ydF9vcmRlciA9PSAnZGVzYycpDQogICAgICAgIG9wdGlvbnMucmV2ZXJzZSgpOw0KICAgIH0NCg0KICAgIHZhciBlbGVtX2lkID0gZWxlbV9hdHRycyhlbGVtLCAnaWQnKTsNCiAgICB2YXIgb3B0aW9uc19yZXN1bHQgPSBbXTsNCiAgICBmb3IgKHZhciBpIGluIG9wdGlvbnMpew0KICAgICAgdmFyIG9wdGlvbiA9IG9wdGlvbnNbaV07DQogICAgICB2YXIgb3B0X2lkID0gb3B0aW9uWzBdOw0KDQogICAgICBvcHRpb25zX3Jlc3VsdC5wdXNoKCI8bGFiZWw+PGlucHV0IGF1dG9jb21wbGV0ZT0nb2ZmJyB0eXBlPSdjaGVja2JveCcgbmFtZT0nezB9W3sxfV0nezJ9ezN9IC8+Jm5ic3A7ezR9PC9sYWJlbD57NX0iLmZtdCgNCiAgICAgICAgZWxlbV9pZCwNCiAgICAgICAgZXNjYXBlX3F1b3RlKG9wdF9pZCksDQogICAgICAgIChqUXVlcnkuaW5BcnJheShvcHRfaWQsIHNlbGVjdGVkX2tleXMpID49IDApID8gIiBjaGVja2VkPSdjaGVja2VkJyIgOiAiIiwNCiAgICAgICAgKGRpc2FibGVkIHx8IGpRdWVyeS5pbkFycmF5KG9wdF9pZCwgZGlzYWJsZWRfa2V5cykgPj0gMCkgPyAiIGRpc2FibGVkPSdkaXNhYmxlZCciIDogIiIsDQogICAgICAgIG9wdGlvblsxXSwNCiAgICAgICAgYnJlYWtsaW5lDQogICAgICApKTsNCiAgICB9DQoNCiAgICB2YXIgaHRtbCA9IG9wdGlvbnNfcmVzdWx0LmpvaW4oJycpOw0KDQogICAgcmV0dXJuIG1ha2VfZGl2X3JvdyhodG1sLCBlbGVtLCBlbGVtX3Byb3BzKGVsZW0sICdsYWJlbCcpKTsNCiAgfTsNCg0KICB2YXIgcmVuZGVyX3RleHRhcmVhID0gZnVuY3Rpb24oZWxlbSl7DQogICAgdmFyIGVsZW1fcHJvcHMgPSBnZXRfZWxlbV9wcm9wcyhlbGVtKTsNCiAgICB2YXIgZWxlbV9hdHRycyA9IGdldF9lbGVtX2F0dHJzKGVsZW0pOw0KICAgIA0KICAgIHZhciB3aWR0aCA9IHBhcnNlSW50KGVsZW1fcHJvcHMoZWxlbSwgJ3dpZHRoJykpIHx8IDA7DQogICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KGVsZW1fcHJvcHMoZWxlbSwgJ2hlaWdodCcpKSB8fCAwOw0KDQogICAgdmFyIHN0eWxlID0gInN0eWxlPSd7MH17MX0nIi5mbXQoDQogICAgICB3aWR0aCA/ICJ3aWR0aDogezB9cHg7Ii5mbXQod2lkdGgpIDogIiIsDQogICAgICBoZWlnaHQgPyAiaGVpZ2h0OiB7MH1weDsiLmZtdChoZWlnaHQpIDogIiINCiAgICApOw0KDQogICAgdmFyIGh0bWwgPSAiPHRleHRhcmVhIG5hbWU9J3swfScgezF9IHsyfSB7M30+ezR9PC90ZXh0YXJlYT4iLmZtdCgNCiAgICAgIGVzY2FwZV9xdW90ZShlbGVtX2F0dHJzKGVsZW0sICdpZCcpKSwNCiAgICAgIGlzX2Rpc2FibGVkKGVsZW0pLA0KICAgICAgaXNfcmVhZG9ubHkoZWxlbSksDQogICAgICBzdHlsZSwNCiAgICAgIGVsZW1fcHJvcHMoZWxlbSwgJ2RlZmF1bHRWYWx1ZScpDQogICAgKTsNCg0KICAgIHJldHVybiBtYWtlX2Rpdl9yb3coaHRtbCwgZWxlbSwgZWxlbV9wcm9wcyhlbGVtLCAnbGFiZWwnKSk7DQogIH07DQoNCiAgdmFyIHJlbmRlcl9oeXBlcnRleHQgPSBmdW5jdGlvbihlbGVtKXsNCiAgICB2YXIgZWxlbV9wcm9wcyA9IGdldF9lbGVtX3Byb3BzKGVsZW0pOw0KICAgIHZhciBlbGVtX2F0dHJzID0gZ2V0X2VsZW1fYXR0cnMoZWxlbSk7DQogICAgDQogICAgcmV0dXJuIG1ha2VfZGl2X3JvdyhlbGVtX3Byb3BzKGVsZW0sICd2YWx1ZScpLCBlbGVtLCBlbGVtX3Byb3BzKGVsZW0sICdsYWJlbCcpKTsNCiAgfTsNCg0KICB2YXIgcmVuZGVyX2J1dHRvbiA9IGZ1bmN0aW9uKGVsZW0pew0KICAgIHZhciBlbGVtX3Byb3BzID0gZ2V0X2VsZW1fcHJvcHMoZWxlbSk7DQogICAgdmFyIGVsZW1fYXR0cnMgPSBnZXRfZWxlbV9hdHRycyhlbGVtKTsNCiAgICANCiAgICB2YXIgYWxpZ24gPSBlbGVtX3Byb3BzKGVsZW0sICdidXR0b25BbGlnbicpLnJlcGxhY2UoLycvZywnJmFjdXRlOycpOw0KICAgIHZhciBpbWFnZSA9IGVsZW1fcHJvcHMoZWxlbSwgJ2J1dHRvbkltYWdlJykucmVwbGFjZSgvJy9nLCcmYWN1dGU7Jyk7DQogICAgdmFyIGxhYmVsID0gZWxlbV9wcm9wcyhlbGVtLCAnbGFiZWwnKS5yZXBsYWNlKC8nL2csJyZhY3V0ZTsnKTsNCg0KICAgIHZhciBidXR0b24gPSAnJzsNCiAgICBpZiAoaW1hZ2Upew0KICAgICAgYnV0dG9uID0gIjxpbnB1dCB0eXBlPSdpbWFnZScgYWx0PSd7MH0nIHRpdGxlPSd7MH0nIHNyYz0nezF9JyB7Mn0gLz4iLmZtdCgNCiAgICAgICAgbGFiZWwsDQogICAgICAgIGltYWdlLA0KICAgICAgICBpc19kaXNhYmxlZChlbGVtKQ0KICAgICAgKTsNCiAgICB9IGVsc2Ugew0KICAgICAgYnV0dG9uID0gIjxpbnB1dCB0eXBlPSdzdWJtaXQnIHZhbHVlPSd7MH0nIHsxfSAvPiIuZm10KA0KICAgICAgICBsYWJlbCwNCiAgICAgICAgaXNfZGlzYWJsZWQoZWxlbSkNCiAgICAgICk7DQogICAgfQ0KDQogICAgcmV0dXJuICI8ZGl2IGNsYXNzPSdyb3cnIHswfT48ZGl2IGlkPSd7NH0nIGNsYXNzPSdzdWJtaXQgezN9JyBzdHlsZT0ndGV4dC1hbGlnbjogezF9Jz57Mn08L2Rpdj48L2Rpdj4iLmZtdCgNCiAgICAgIGlzX3Zpc2libGUoZWxlbSksDQogICAgICBhbGlnbiwNCiAgICAgIGJ1dHRvbiwNCiAgICAgIGVsZW1fYXR0cnMoZWxlbSwgJ2NsYXNzJyksDQogICAgICBlc2NhcGVfcXVvdGUoZWxlbV9hdHRycyhlbGVtLCAnaWQnKSkNCiAgICApOw0KICB9Ow0KDQogIHZhciByZW5kZXJfZGVmYXVsdF9idXR0b24gPSBmdW5jdGlvbigpew0KICAgIHJldHVybiAiPGRpdiBjbGFzcz0nc3VibWl0Jz48aW5wdXQgdHlwZT0nc3VibWl0JyAvPjwvZGl2PiI7DQogIH07DQoNCiAgdmFyIHJlbmRlcl9jb250YWluZXIgPSBmdW5jdGlvbihlbGVtKXsNCiAgICB2YXIgZWxlbV9wcm9wcyA9IGdldF9lbGVtX3Byb3BzKGVsZW0pOw0KICAgIHZhciBlbGVtX2F0dHJzID0gZ2V0X2VsZW1fYXR0cnMoZWxlbSk7DQogICAgDQogICAgdmFyIHdpZHRoID0gZWxlbV9wcm9wcyhlbGVtLCAnd2lkdGgnKTsNCiAgICB2YXIgaGVpZ2h0ID0gZWxlbV9wcm9wcyhlbGVtLCAnaGVpZ2h0Jyk7DQoNCiAgICB2YXIgc3R5bGUgPSAic3R5bGU9J3swfXsxfXsyfSciLmZtdCgNCiAgICAgIHdpZHRoID8gIndpZHRoOiB7MH07Ii5mbXQod2lkdGgpIDogIiIsDQogICAgICBoZWlnaHQgPyAiaGVpZ2h0OiB7MH07Ii5mbXQoaGVpZ2h0KSA6ICIiLA0KICAgICAgaXNfdmlzaWJsZShlbGVtKSA/ICJkaXNwbGF5OiBub25lOyIgOiAiIg0KICAgICk7DQogICAgdmFyIGNvbXBvbmVudHMgPSBlbGVtLmZpbmQoJz5Db21wb25lbnRzPionKTsNCg0KICAgICAgcmV0dXJuICI8ZGl2IGlkPSd7MH0nIGNsYXNzPSdyb3cgZnVsbHNpemUgezF9JyB7Mn0+PGRpdiBjbGFzcz0naXRlbSc+ezN9PC9kaXY+PC9kaXY+Ii5mbXQoDQogICAgICAgIGVzY2FwZV9xdW90ZShlbGVtX2F0dHJzKGVsZW0sICdpZCcpKSwNCiAgICAgICAgZWxlbV9hdHRycyhlbGVtLCAnY2xhc3MnKSwNCiAgICAgICAgc3R5bGUsDQogICAgICAgIGNvbXBvbmVudHMubGVuZ3RoID4gMCA/IHJlbmRlcl9jb21wb25lbnRzKGNvbXBvbmVudHMsIGVsZW0uZm9ybV9pZCkgOiAiIg0KICAgICAgKTsNCiAgfTsNCg0KICB2YXIgcmVuZGVyX2xpdmVzZWFyY2ggPSBmdW5jdGlvbihlbGVtKXsNCiAgICB2YXIgZWxlbV9wcm9wcyA9IGdldF9lbGVtX3Byb3BzKGVsZW0pOw0KICAgIHZhciBlbGVtX2F0dHJzID0gZ2V0X2VsZW1fYXR0cnMoZWxlbSk7DQogICAgDQogICAgdmFyIGh0bWwgPSAiPGRpdiBpZD0neG1sLWRpYWxvZy1sdnMtezB9LWRhdGEnPns2fTwvZGl2PjxpbnB1dCB0eXBlPSd0ZXh0JyBpZD0neG1sLWRpYWxvZy1sdnMtezB9JyBuYW1lPSd7MH0nIHsyfSB7M30gc291cmNldXJpPSd7NH0nIHNvdXJjZWV2ZW50PSd7NX0nIHZhbHVlPSd7MX0nIC8+Ii5mbXQoDQogICAgICBlc2NhcGVfcXVvdGUoZWxlbV9hdHRycyhlbGVtLCAnaWQnKSksDQogICAgICBlc2NhcGVfcXVvdGUoZWxlbV9wcm9wcyhlbGVtLCAnZGVmYXVsdFZhbHVlJykpLA0KICAgICAgaXNfZGlzYWJsZWQoZWxlbSksDQogICAgICBpc19yZWFkb25seShlbGVtKSwNCiAgICAgIGVsZW1fcHJvcHMoZWxlbSwgJ3NvdXJjZVVSSScpLA0KICAgICAgZWxlbV9wcm9wcyhlbGVtLCAnc291cmNlRXZlbnQnKSwNCiAgICAgIGVsZW1fcHJvcHMoZWxlbSwgJ3NvdXJjZURhdGEnKS5yZXBsYWNlKC8mL2csICImYW1wOyIpLnJlcGxhY2UoLzwvZywgIiZsdDsiKQ0KICAgICk7DQoNCiAgICByZXR1cm4gbWFrZV9kaXZfcm93KGh0bWwsIGVsZW0sIGVsZW1fcHJvcHMoZWxlbSwgJ2xhYmVsJykpOw0KICB9Ow0KICANCiAgdmFyIHJlbmRlcl9yaWNodGV4dGFyZWEgPSBmdW5jdGlvbihlbGVtKXsNCiAgICB2YXIgZWxlbV9wcm9wcyA9IGdldF9lbGVtX3Byb3BzKGVsZW0pOw0KICAgIHZhciBlbGVtX2F0dHJzID0gZ2V0X2VsZW1fYXR0cnMoZWxlbSk7DQogICAgDQogICAgdmFyIGh0bWwgPSAiPHRleHRhcmVhIGlkPSd4bWwtZGlhbG9nLXJ0ZS17MH0nIG5hbWU9J3swfScgezJ9IHszfSBlaGVpZ2h0PSd7NH0nPnsxfTwvdGV4dGFyZWE+Ii5mbXQoDQogICAgICBlc2NhcGVfcXVvdGUoZWxlbV9hdHRycyhlbGVtLCAnaWQnKSksDQogICAgICBlbGVtX3Byb3BzKGVsZW0sICdkZWZhdWx0VmFsdWUnKSwNCiAgICAgIGlzX2Rpc2FibGVkKGVsZW0pLA0KICAgICAgaXNfcmVhZG9ubHkoZWxlbSksDQogICAgICBlbGVtX3Byb3BzKGVsZW0sICdoZWlnaHQnKSB8fCAnJw0KICAgICk7DQoNCiAgICByZXR1cm4gbWFrZV9kaXZfcm93KGh0bWwsIGVsZW0sIGVsZW1fcHJvcHMoZWxlbSwgJ2xhYmVsJyksIHRydWUpOw0KICB9Ow0KICANCiAgdmFyIHJlbmRlcl9maWxldXBsb2FkID0gZnVuY3Rpb24oZWxlbSl7DQogICAgdmFyIGVsZW1fcHJvcHMgPSBnZXRfZWxlbV9wcm9wcyhlbGVtKTsNCiAgICB2YXIgZWxlbV9hdHRycyA9IGdldF9lbGVtX2F0dHJzKGVsZW0pOw0KDQogICAgdmFyIGNvZGUgPSAoJzxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij5cbicgKw0KICAgICAgICAndmFyIG1heF9maWxldXBsb2FkX3NpemUgPSAxNSAqIDEwMjQgKiAxMDI0O1xuJyArDQogICAgICAgICd2YXIgZmlsZXVwbG9hZF9uZXh0ID0gMTtcbicgKw0KICAgICAgICAndmFyIGZpbGV1cGxvYWRfcHJvZ3Jlc3MgPSAwO1xuJyArDQogICAgICAgICd2YXIgdXBkYXRlX3NlbGVjdGVkX2ZpbGVzID0gZnVuY3Rpb24oKSB7XG4nICsNCiAgICAgICAgJyAgICB2YXIgdmFsID0gIiI7XG4nICsNCiAgICAgICAgJyAgICAkKCIuezB9LWd1aWQiKS5lYWNoKGZ1bmN0aW9uKGkpIHtcbicgKw0KICAgICAgICAnICAgICAgICBpZiAodmFsICE9ICIiKSB2YWwgPSB2YWwgKyAiLCI7XG4nICsNCiAgICAgICAgJyAgICAgICAgdmFsID0gdmFsICsgJCh0aGlzKVswXS52YWx1ZTtcbicgKw0KICAgICAgICAnICAgIH0pO1xuJyArDQogICAgICAgICcgICAgJCgiI3swfSIpWzBdLnZhbHVlID0gdmFsO1xuJyArDQogICAgICAgICd9XG4nICsNCiAgICAgICAgJ3ZhciBhZGRfdXBsb2FkZWRfZmlsZSA9IGZ1bmN0aW9uKGZpbGVuYW1lLCBndWlkKSB7XG4nICsNCiAgICAgICAgJyAgICAgICAgdmFyIG5ld2VsZW0gPSBcJzxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iezB9X1wnICsgZmlsZXVwbG9hZF9uZXh0ICsgXCdfbmFtZSIgbmFtZT0iezB9X1wnICsgZmlsZXVwbG9hZF9uZXh0ICsgXCdfbmFtZSIgcmVhZG9ubHk9InJlYWRvbmx5IiBkaXNhYmxlZD0iZGlzYWJsZWQiIC8+XCc7XG4nICsNCiAgICAgICAgJyAgICAgICAgdmFyIG5ld2VsZW1lbnQgPSAkKG5ld2VsZW0pO1xuJyArDQogICAgICAgICcgICAgICAgIG5ld2VsZW1lbnRbMF0udmFsdWUgPSBmaWxlbmFtZTtcbicgKw0KICAgICAgICAnICAgICAgICB2YXIgcmVtb3ZlYnRuID0gXCc8YnV0dG9uIGlkPSJ7MH1fcmVtb3ZlX1wnICsgZmlsZXVwbG9hZF9uZXh0ICsgXCciIGNsYXNzPSJ7MH0tcmVtb3ZlLW1lIj54PC9idXR0b24+PC9kaXY+PGRpdiBpZD0iezB9X2RpdiI+XCc7XG4nICsNCiAgICAgICAgJyAgICAgICAgdmFyIHJlbW92ZWJ1dHRvbiA9ICQocmVtb3ZlYnRuKTtcbicgKw0KICAgICAgICAnICAgICAgICB2YXIgZ3VpZGVsZW0gPSBcJzxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJ7MH1fXCcgKyBmaWxldXBsb2FkX25leHQgKyBcJyIgbmFtZT0iezB9X1wnICsgZmlsZXVwbG9hZF9uZXh0ICsgXCciIGNsYXNzPSJ7MH0tZ3VpZCIgZGlzYWJsZWQ9ImRpc2FibGVkIiAvPlwnO1xuJyArDQogICAgICAgICcgICAgICAgIHZhciBndWlkZWxlbWVudCA9ICQoZ3VpZGVsZW0pO1xuJyArDQogICAgICAgICcgICAgICAgIGd1aWRlbGVtZW50WzBdLnZhbHVlID0gZ3VpZDtcbicgKw0KICAgICAgICAnICAgICAgICAkKCIjezB9X2lucHV0IikuYmVmb3JlKG5ld2VsZW1lbnQpO1xuJyArDQogICAgICAgICcgICAgICAgICQobmV3ZWxlbWVudCkuYWZ0ZXIoZ3VpZGVsZW1lbnQpO1xuJyArDQogICAgICAgICcgICAgICAgICQoZ3VpZGVsZW1lbnQpLmFmdGVyKHJlbW92ZWJ1dHRvbik7XG4nICsNCiAgICAgICAgJyAgICAgICAgZmlsZXVwbG9hZF9uZXh0ID0gZmlsZXVwbG9hZF9uZXh0ICsgMTtcbicgKw0KICAgICAgICAnICAgICAgICAkKCIuezB9LXJlbW92ZS1tZSIpLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuJyArDQogICAgICAgICcgICAgICAgICAgICB2YXIgZmllbGRudW0gPSB0aGlzLmlkLnN1YnN0cmluZygiezB9Ii5sZW5ndGggKyA4KTtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgJCgiI3swfV8iICsgZmllbGRudW0gKyAiX25hbWUiKS5yZW1vdmUoKTtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgJCgiI3swfV8iICsgZmllbGRudW0pLnJlbW92ZSgpO1xuJyArDQogICAgICAgICcgICAgICAgICAgICB1cGRhdGVfc2VsZWN0ZWRfZmlsZXMoKTtcbicgKw0KICAgICAgICAnICAgICAgICB9KTtcbicgKw0KICAgICAgICAnICAgICAgICB1cGRhdGVfc2VsZWN0ZWRfZmlsZXMoKTtcbicgKw0KICAgICAgICAnfVxuJyArDQogICAgICAgICd2YXIgZmlsZXVwbG9hZF9zdGFydGVkID0gZnVuY3Rpb24oKSB7XG4nICsNCiAgICAgICAgJyAgICBpZiAoZmlsZXVwbG9hZF9wcm9ncmVzcyA9PSAwKSAkKFwnaW5wdXRbdHlwZT0ic3VibWl0Il1cJywgJCgiI3sxfSIpKS5hdHRyKCJkaXNhYmxlZCIsIHRydWUpO1xuJyArDQogICAgICAgICcgICAgZmlsZXVwbG9hZF9wcm9ncmVzcyA9IGZpbGV1cGxvYWRfcHJvZ3Jlc3MgKyAxO1xuJyArDQogICAgICAgICd9XG4nICsNCiAgICAgICAgJ3ZhciBmaWxldXBsb2FkX2VuZGVkID0gZnVuY3Rpb24oKSB7XG4nICsNCiAgICAgICAgJyAgICBpZiAoZmlsZXVwbG9hZF9wcm9ncmVzcyA+IDApIGZpbGV1cGxvYWRfcHJvZ3Jlc3MgPSBmaWxldXBsb2FkX3Byb2dyZXNzIC0gMTtcbicgKw0KICAgICAgICAnICAgIGlmIChmaWxldXBsb2FkX3Byb2dyZXNzID09IDApIHtcbicgKw0KICAgICAgICAnICAgICAgICAkKCIjezB9X3Byb2dyZXNzIilbMF0uaW5uZXJIVE1MID0gIiI7XG4nICsNCiAgICAgICAgJyAgICAgICAgJChcJ2lucHV0W3R5cGU9InN1Ym1pdCJdXCcsICQoIiN7MX0iKSkuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7XG4nICsNCiAgICAgICAgJyAgICB9XG4nICsNCiAgICAgICAgJ31cbicgKw0KICAgICAgICAndmFyIGluaXRfZmlsZV91cGxvYWQgPSBmdW5jdGlvbigpIHtcbicgKw0KICAgICAgICAnICAgICQoIiN7MX0iKS5maWxlVXBsb2FkVUkoe1xuJyArDQogICAgICAgICcgICAgICAgIHVybDogIi91cGxvYWQucHkiLFxuJyArDQogICAgICAgICcgICAgICAgIGRhdGFUeXBlOiAianNvbiIsXG4nICsNCiAgICAgICAgJyAgICAgICAgZHJvcFpvbmU6ICQoIiN7MX0iKSxcbicgKw0KICAgICAgICAnICAgICAgICBhdXRvVXBsb2FkOiB0cnVlLFxuJyArDQogICAgICAgICcgICAgICAgIHJlcGxhY2VGaWxlSW5wdXQ6IGZhbHNlLFxuJyArDQogICAgICAgICcgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uIChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpIHtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgdmFyIHJlc3AgPSB4aHIucmVzcG9uc2UudHJpbSgpO1xuJyArDQogICAgICAgICcgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSAyMDAgJiYgcmVzcC5sZW5ndGggPT0gMzYpIGFkZF91cGxvYWRlZF9maWxlKGZpbGVzWzBdLm5hbWUsIHJlc3ApO1xuJyArDQogICAgICAgICcgICAgICAgICAgICBlbHNlIHtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzICE9IDIwMCkgYWxlcnQoIlVwbG9hZCBlcnJvcjogIiArIHhoci5zdGF0dXNUZXh0KTtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgICAgIGVsc2UgYWxlcnQoIlVwbG9hZCBlcnJvciIpO1xuJyArDQogICAgICAgICcgICAgICAgICAgICB9XG4nICsNCiAgICAgICAgJyAgICAgICAgICAgIGZpbGV1cGxvYWRfZW5kZWQoKTtcbicgKw0KICAgICAgICAnICAgICAgICB9LFxuJyArDQogICAgICAgICcgICAgICAgIG9uU2VuZDogZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikge1xuJyArDQogICAgICAgICcgICAgICAgICAgICBpZiAoIXhoci51cGxvYWQgJiYgaGFuZGxlci5wcm9ncmVzc2JhcikgaGFuZGxlci5wcm9ncmVzc2Jhci5wcm9ncmVzc2JhcigidmFsdWUiLCAxMDApO1xuJyArDQogICAgICAgICcgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnR5cGUgPT0gImZpbGUiKSBldmVudC50YXJnZXQudmFsdWUgPSAiIjtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPD0gbWF4X2ZpbGV1cGxvYWRfc2l6ZSkgZmlsZXVwbG9hZF9zdGFydGVkKCk7XG4nICsNCiAgICAgICAgJyAgICAgICAgICAgIGVsc2UgYWxlcnQoIkZpbGUgaXMgdG9vIGJpZyIpO1xuJyArDQogICAgICAgICcgICAgICAgIH0sXG4nICsNCiAgICAgICAgJyAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikge1xuJyArDQogICAgICAgICcgICAgICAgIH0sXG4nICsNCiAgICAgICAgJyAgICAgICAgb25Qcm9ncmVzc0FsbDogZnVuY3Rpb24gKGV2ZW50LCBsaXN0KSB7XG4nICsNCiAgICAgICAgJyAgICAgICAgICAgIGlmIChmaWxldXBsb2FkX3Byb2dyZXNzID4gMCkge1xuJyArDQogICAgICAgICcgICAgICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSBwYXJzZUludChldmVudC5sb2FkZWQgLyBldmVudC50b3RhbCAqIDEwMCwgMTApO1xuJyArDQogICAgICAgICcgICAgICAgICAgICAgICAgJCgiI3swfV9wcm9ncmVzcyIpWzBdLmlubmVySFRNTCA9ICJVcGxvYWRpbmcgIiArIGZpbGV1cGxvYWRfcHJvZ3Jlc3MgKyAiIGZpbGUocykuLi4gIiArIHBlcmNlbnQgKyAiJSI7XG4nICsNCiAgICAgICAgJyAgICAgICAgICAgIH1cbicgKw0KICAgICAgICAnICAgICAgICB9LFxuJyArDQogICAgICAgICcgICAgICAgIG9uUHJvZ3Jlc3M6IGZ1bmN0aW9uIChwcm9ncmVzc0V2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpIHtcbicgKw0KICAgICAgICAnICAgICAgICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiBtYXhfZmlsZXVwbG9hZF9zaXplKSB4aHIuYWJvcnQoKTtcbicgKw0KICAgICAgICAnICAgICAgICB9LFxuJyArDQogICAgICAgICcgICAgfSk7XG4nICsNCiAgICAgICAgJ31cbicgKw0KICAgICAgICAnJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcbicgKw0KICAgICAgICAnICAgIGluaXRfZmlsZV91cGxvYWQoKTtcbicgKw0KICAgICAgICAnfSk7XG4nICsNCiAgICAgICAgJzwvc2NyaXB0PicpLmZtdChlc2NhcGVfcXVvdGUoZWxlbV9hdHRycyhlbGVtLCAnaWQnKSksIGVsZW0uZm9ybV9pZCkNCg0KICAgIHZhciBodG1sID0gKCc8ZGl2IGlkPSJ7MH1fZGl2Ij48aW5wdXQgaWQ9InswfV9pbnB1dCIgbmFtZT0iezB9X2lucHV0IiB0eXBlPSJmaWxlIi8+PGRpdiBpZD0iezB9X3Byb2dyZXNzIj48L2Rpdj48aW5wdXQgaWQ9InswfSIgbmFtZT0iezB9IiB0eXBlPSJoaWRkZW4iLz48L2Rpdj4nKS5mbXQoZXNjYXBlX3F1b3RlKGVsZW1fYXR0cnMoZWxlbSwgJ2lkJykpKQ0KDQogICAgcmV0dXJuIG1ha2VfZGl2X3JvdyhodG1sLCBlbGVtLCBlbGVtX3Byb3BzKGVsZW0sICdsYWJlbCcpKSArIGNvZGUNCiAgfTsNCg0KDQogIENPTVBPTkVOVFNfTUFQID0gew0KICAgICJoZWFkaW5nIiA6IHJlbmRlcl9oZWFkaW5nLA0KICAgICJ0ZXh0Ym94IiA6IHJlbmRlcl90ZXh0Ym94LA0KICAgICJwYXNzd29yZCIgOiByZW5kZXJfcGFzc3dvcmQsDQogICAgImRyb3Bkb3duIiA6IHJlbmRlcl9kcm9wZG93biwNCiAgICAicmFkaW9idXR0b24iIDogcmVuZGVyX3JhZGlvYnV0dG9uLA0KICAgICJjaGVja2JveCIgOiByZW5kZXJfY2hlY2tib3gsDQogICAgInRleHRhcmVhIiA6IHJlbmRlcl90ZXh0YXJlYSwNCiAgICAiaHlwZXJ0ZXh0IiA6IHJlbmRlcl9oeXBlcnRleHQsDQogICAgImJ1dHRvbiIgOiByZW5kZXJfYnV0dG9uLA0KICAgICJsaXZlc2VhcmNoIjogcmVuZGVyX2xpdmVzZWFyY2gsDQogICAgImNvbnRhaW5lciI6IHJlbmRlcl9jb250YWluZXIsDQogICAgImZpbGV1cGxvYWQiIDogcmVuZGVyX2ZpbGV1cGxvYWQsDQogICAgInJpY2h0ZXh0YXJlYSI6IHJlbmRlcl9yaWNodGV4dGFyZWEsDQogIH0NCg0KICB2YXIgcmVuZGVyX2NvbXBvbmVudHMgPSBmdW5jdGlvbihjb21wb25lbnRzLCBmb3JtX2lkKXsNCiAgICB2YXIgZGF0YSA9IFtdOw0KICAgIGNvbXBvbmVudHMuZWFjaChmdW5jdGlvbigpew0KICAgICAgdmFyIGNvbXBvbmVudCA9IGpRdWVyeSh0aGlzKTsNCiAgICAgIHZhciByZW5kZXIgPSBDT01QT05FTlRTX01BUFt0aGlzLnRhZ05hbWUudG9Mb3dlckNhc2UoKV07DQogICAgICBpZiAocmVuZGVyKXsNCiAgICAgICAgY29tcG9uZW50LmZvcm1faWQgPSBmb3JtX2lkOw0KICAgICAgICBkYXRhLnB1c2gocmVuZGVyKGNvbXBvbmVudCkpOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiBkYXRhLmpvaW4oJycpOw0KICB9Ow0KDQogIHZhciB4bWxEaWFsb2cgPSBqUXVlcnkoZGlhbG9nSUQpOw0KICB4bWxEaWFsb2cuaHRtbCgnJyk7DQogIHhtbERpYWxvZy5kYXRhKCdldicsJycpOw0KICANCiAgdmFyIHJlc3VsdCA9IFtdOw0KICB2YXIgeG1sRGF0YSA9IGpRdWVyeS5wYXJzZVhNTCh4bWxEYXRhKTsNCiAgeG1sRGF0YSA9IGpRdWVyeSh4bWxEYXRhKTsNCg0KICB2YXIgZm9ybV9pZCA9ICd4bWxfZm9ybV8nICsgZGlhbG9nSUQuc3Vic3RyaW5nKDMpOw0KICB2YXIgZGVmYXVsdF9idG4gPSB4bWxEYXRhLmZpbmQoJ0J1dHRvbicpLmxlbmd0aCA+IDAgPyBmYWxzZSA6IHRydWU7DQogIHZhciByZW5kZXJfcmVzdWx0ID0gcmVuZGVyX2NvbXBvbmVudHMoeG1sRGF0YS5maW5kKCJWRE9NRm9ybUNvbnRhaW5lcj5Db21wb25lbnRzPioiKSwgZm9ybV9pZCk7DQoNCiAgaWYgKGRlZmF1bHRfYnRuKSB7DQogICAgcmVuZGVyX3Jlc3VsdCArPSByZW5kZXJfZGVmYXVsdF9idXR0b24oKTsNCiAgfQ0KDQogIHhtbERpYWxvZy5odG1sKCI8Zm9ybSBpZD0nIiArIGZvcm1faWQgKyAiJyBhY3Rpb249JycgbWV0aG9kPSdwb3N0JyBlbmN0eXBlPSdtdWx0aXBhcnQvZm9ybS1kYXRhJyBjbGFzcz0neG1sLWRpYWxvZy1mb3JtJz4iICsgcmVuZGVyX3Jlc3VsdCArICI8L2Zvcm0+IikuZGlhbG9nKCdjbG9zZScpDQogIHhtbERpYWxvZy5kaWFsb2coJ29wdGlvbicsICd0aXRsZScsIHhtbERhdGEuZmluZCgiVkRPTUZvcm1Db250YWluZXI+UHJvcGVydGllcz5Qcm9wZXJ0eVtuYW1lPWxhYmVsXSIpLnRleHQoKSk7DQogIHhtbERpYWxvZy5kYXRhKCdldicsJzEnKTsNCiAgeG1sRGlhbG9nLmRpYWxvZygnb3BlbicpOw0KICANCn0NCg0KZnVuY3Rpb24gdmRvbV94ZF9jcmVhdGVfcmljaHRleHRhcmVhKCRkaWFsb2cpew0KDQogIHZhciBlZGl0b3JzID0gd2luZG93WyJ4bWxEaWFsb2dUaW55RWRpdG9ycyJdID0gW107DQogIGpRdWVyeSgiZGl2LnJpY2h0ZXh0YXJlYSA+IHRleHRhcmVhIiwgJGRpYWxvZykuZWFjaChmdW5jdGlvbigpew0KICAgIHZhciAkdGV4dGFyZWEgPSBqUXVlcnkodGhpcyk7DQoNCiAgICBlZGl0b3JzLnB1c2gobmV3IFRJTlkuZWRpdG9yLmVkaXQoJ2VkaXRvcicsew0KICAgICAgaWQ6ICR0ZXh0YXJlYS5hdHRyKCdpZCcpLA0KICAgICAgY3NzY2xhc3M6ICd0ZScsDQogICAgICBjb250cm9sY2xhc3M6ICd0ZWNvbnRyb2wnLA0KICAgICAgcm93Y2xhc3M6ICd0ZWhlYWRlcicsDQogICAgICBkaXZpZGVyY2xhc3M6ICd0ZWRpdmlkZXInLA0KICAgICAgY29udHJvbHM6Ww0KICAgICAgICAgICdib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnLCAnc3RyaWtldGhyb3VnaCcsICd8JywNCiAgICAgICAgICAnb3JkZXJlZGxpc3QnLCAndW5vcmRlcmVkbGlzdCcsICd8Jw0KICAgICAgICAgICwnb3V0ZGVudCcgLCdpbmRlbnQnLCAnfCcsDQogICAgICAgICAgJ2xlZnRhbGlnbicsICdjZW50ZXJhbGlnbicsICdyaWdodGFsaWduJywgJ2Jsb2NranVzdGlmeScsICd8JywNCiAgICAgICAgICAndW5mb3JtYXQnLCAnfCcsICdmb250JywgJ3NpemUnLCAnc3R5bGUnLCAnfCcsDQogICAgICAgICAgJ2hyJywgJ2xpbmsnLCAndW5saW5rJywgJ3wnLCAnY3V0JywgJ2NvcHknLCAncGFzdGUnLCAncHJpbnQnDQogICAgICBdLA0KICAgICAgZm9udHM6WydWZXJkYW5hJywnQXJpYWwnLCdHZW9yZ2lhJywnVHJlYnVjaGV0IE1TJ10sDQogICAgICBoZWlnaHQ6IHBhcnNlSW50KCR0ZXh0YXJlYS5hdHRyKCdlaGVpZ2h0JyksIDEwKSB8fCAnJw0KICAgIH0pKTsNCg0KICAgICR0ZXh0YXJlYS5yZW1vdmVBdHRyKCdlaGVpZ2h0Jyk7ICANCg0KICB9KTsNCn0NCg0KZnVuY3Rpb24gdmRvbV94ZF9jcmVhdGVfbGl2ZXNlYXJjaCgkZGlhbG9nKXsNCg0KICBqUXVlcnkoImRpdi5saXZlc2VhcmNoID4gaW5wdXQiLCAkZGlhbG9nKS5lYWNoKGZ1bmN0aW9uKCl7DQoNCiAgICB2YXIgdGV4dGJveCA9IHRoaXM7DQogICAgdmFyICR0ZXh0Ym94ID0galF1ZXJ5KHRoaXMpOw0KICAgIHZhciBzb3VyY2VVUkkgPSAkdGV4dGJveC5hdHRyKCdzb3VyY2V1cmknKTsNCiAgICB2YXIgc291cmNlRXZlbnQgPSAkdGV4dGJveC5hdHRyKCdzb3VyY2VldmVudCcpOw0KDQogICAgdmFyIGRhdGFEaXYgPSAkdGV4dGJveC5wYXJlbnQoKS5maW5kKCJkaXYjIiArICR0ZXh0Ym94LmF0dHIoJ2lkJykgKyAiLWRhdGEiKTsNCiAgICB2YXIgc291cmNlRGF0YSA9IGRhdGFEaXYudGV4dCgpLnJlcGxhY2UoLyZsdDsvZywgIjwiKS5yZXBsYWNlKC8mYW1wOy9nLCAiJiIpOw0KDQogICAgZGF0YURpdi5yZW1vdmUoKTsNCiAgICAkdGV4dGJveC5yZW1vdmVBdHRyKCJzb3VyY2V1cmkiKS5yZW1vdmVBdHRyKCJzb3VyY2VldmVudCIpOw0KDQogICAgdmFyIGRhdGFTb3VyY2UgPSBbXTsNCg0KICAgIGlmIChzb3VyY2VVUkkpew0KICAgICAgZGF0YVNvdXJjZSA9IHNvdXJjZVVSSTsNCg0KICAgIH0gZWxzZSBpZiAoc291cmNlRXZlbnQpew0KICAgICAgZGF0YVNvdXJjZSA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKXsNCiAgICAgICAgcmVzcG9uc2UoJGRpYWxvZy5kaWFsb2coJ2V4ZWN1dGVDYWxsYmFjaycsICdsaXZlU2VhcmNoJywgew0KICAgICAgICAgICd0ZXh0Ym94JzogdGV4dGJveCwNCiAgICAgICAgICAndGVybSc6IHJlcXVlc3QudGVybQ0KICAgICAgICB9KSk7DQogICAgICB9Ow0KDQogICAgfSBlbHNlIGlmIChzb3VyY2VEYXRhKXsNCiAgICAgIGRhdGFTb3VyY2UgPSBldmFsKHNvdXJjZURhdGEpOw0KICAgIH0NCg0KICAgICR0ZXh0Ym94LmF1dG9jb21wbGV0ZSh7DQogICAgICAgIHNvdXJjZTogZGF0YVNvdXJjZSwNCiAgICAgICAgYXBwZW5kVG86ICdib2R5JywgLy8galF1ZXJ5KCIueG1sLWRpYWxvZy1mb3JtIHRleHRhcmVhIyIgKyBvYmpJRCkuY2xvc2VzdCgiZm9ybS54bWwtZGlhbG9nLWZvcm0iKS5wYXJlbnQoKS5wYXJlbnQoKSwNCg0KICAgICAgc2VsZWN0OiBmdW5jdGlvbihldiwgdWkpew0KICAgICAgICB2YXIgaW5wdXRfbmFtZSA9IGpRdWVyeSh0aGlzKS5hdHRyKCduYW1lJyk7DQogICAgICAgIGpRdWVyeSh0aGlzKS5iZWZvcmUoIjxkaXYgY2xhc3M9J3NlbGVjdGVkLWl0ZW0nPjxzcGFuPjxkaXYgY2xhc3M9J3ZhbHVlJz4iICsgdWkuaXRlbS5sYWJlbCArICI8aW5wdXQgdHlwZT0naGlkZGVuJyBuYW1lPSciICsgaW5wdXRfbmFtZSArICJbIiArIHVpLml0ZW0udmFsdWUucmVwbGFjZSgvIi9nLCAiJnF1b3Q7IikgKyAiXScgdmFsdWU9JzEnPjwvZGl2PjxkaXYgY2xhc3M9J2Nsb3NlJyBvbmNsaWNrPSdqUXVlcnkodGhpcykucGFyZW50KCkucGFyZW50KCkucmVtb3ZlKCknPjwvZGl2Pjwvc3Bhbj48L2Rpdj4iKTsNCiAgICAgICAgalF1ZXJ5KHRoaXMpLnZhbCgnJyk7DQogICAgICAgIHJldHVybiBmYWxzZTsgDQogICAgICB9DQogICAgfSk7DQoNCiAgICAkdGV4dGJveC5rZXlkb3duKGZ1bmN0aW9uKGUpIHsNCiAgICAgIGlmIChldmVudC5rZXlDb2RlID09ICQudWkua2V5Q29kZS5FTlRFUiB8fA0KICAgICAgICAgIGV2ZW50LmtleUNvZGUgPT0gJC51aS5rZXlDb2RlLk5VTVBBRF9FTlRFUiB8fA0KICAgICAgICAgIGV2ZW50LmtleUNvZGUgPT0gJC51aS5rZXlDb2RlLlRBQil7DQogICAgICAgIA0KICAgICAgICBpZiAoalF1ZXJ5KHRoaXMpLnZhbCgpLmxlbmd0aCA+PSAyKSB7DQogICAgICAgICAgDQogICAgICAgICAgdmFyIGlucHV0X25hbWUgPSBqUXVlcnkodGhpcykuYXR0cignbmFtZScpOw0KICAgICAgICAgIHZhciB2YWx1ZSA9IGpRdWVyeSh0aGlzKS52YWwoKTsNCiAgICAgICAgICBqUXVlcnkodGhpcykuYmVmb3JlKCI8ZGl2IGNsYXNzPSdzZWxlY3RlZC1pdGVtJz48c3Bhbj48ZGl2IGNsYXNzPSd2YWx1ZSc+IiArIHZhbHVlICsgIjxpbnB1dCB0eXBlPSdoaWRkZW4nIG5hbWU9JyIgKyBpbnB1dF9uYW1lICsgIlsiICsgdmFsdWUucmVwbGFjZSgvIi9nLCAiJnF1b3Q7IikgKyAiXScgdmFsdWU9JzEnPjwvZGl2PjxkaXYgY2xhc3M9J2Nsb3NlJyBvbmNsaWNrPSdqUXVlcnkodGhpcykucGFyZW50KCkucGFyZW50KCkucmVtb3ZlKCknPjwvZGl2Pjwvc3Bhbj48L2Rpdj4iKTsNCiAgICAgICAgICBqUXVlcnkodGhpcykudmFsKCcnKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSAhPSAkLnVpLmtleUNvZGUuVEFCKQ0KICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfSk7DQp9]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae6cbdfa6" Name="vdom_xml_dialog_autocomplete" Type="js"><![CDATA[LyohDQogKiBqUXVlcnkgVUkgQXV0b2NvbXBsZXRlIDEuOC4yMA0KICoNCiAqIENvcHlyaWdodCAyMDEyLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dCkNCiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLg0KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQ0KICoNCiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvQXV0b2NvbXBsZXRlDQogKg0KICogRGVwZW5kczoNCiAqCWpxdWVyeS51aS5jb3JlLmpzDQogKglqcXVlcnkudWkud2lkZ2V0LmpzDQogKglqcXVlcnkudWkucG9zaXRpb24uanMNCiAqLw0KKGZ1bmN0aW9uKCAkLCB1bmRlZmluZWQgKSB7DQoNCi8vIHVzZWQgdG8gcHJldmVudCByYWNlIGNvbmRpdGlvbnMgd2l0aCByZW1vdGUgZGF0YSBzb3VyY2VzDQp2YXIgcmVxdWVzdEluZGV4ID0gMDsNCg0KJC53aWRnZXQoICJ1aS5hdXRvY29tcGxldGUiLCB7DQoJb3B0aW9uczogew0KCQlhcHBlbmRUbzogImJvZHkiLA0KCQlhdXRvRm9jdXM6IGZhbHNlLA0KCQlkZWxheTogMzAwLA0KCQltaW5MZW5ndGg6IDEsDQoJCXBvc2l0aW9uOiB7DQoJCQlteTogImxlZnQgdG9wIiwNCgkJCWF0OiAibGVmdCBib3R0b20iLA0KCQkJY29sbGlzaW9uOiAibm9uZSINCgkJfSwNCgkJc291cmNlOiBudWxsLA0KCQlyZXNwb25zZTogbnVsbCwNCgl9LA0KDQoJcGVuZGluZzogMCwNCg0KCV9jcmVhdGU6IGZ1bmN0aW9uKCkgew0KCQl2YXIgc2VsZiA9IHRoaXMsDQoJCQlkb2MgPSB0aGlzLmVsZW1lbnRbIDAgXS5vd25lckRvY3VtZW50LA0KCQkJc3VwcHJlc3NLZXlQcmVzczsNCgkJdGhpcy5pc011bHRpTGluZSA9IHRoaXMuZWxlbWVudC5pcyggInRleHRhcmVhIiApOw0KDQoJCXRoaXMuZWxlbWVudA0KCQkJLmFkZENsYXNzKCAidWktYXV0b2NvbXBsZXRlLWlucHV0IiApDQoJCQkuYXR0ciggImF1dG9jb21wbGV0ZSIsICJvZmYiICkNCgkJCS8vIFRPRE8gdmVyaWZ5IHRoZXNlIGFjdHVhbGx5IHdvcmsgYXMgaW50ZW5kZWQNCgkJCS5hdHRyKHsNCgkJCQlyb2xlOiAidGV4dGJveCIsDQoJCQkJImFyaWEtYXV0b2NvbXBsZXRlIjogImxpc3QiLA0KCQkJCSJhcmlhLWhhc3BvcHVwIjogInRydWUiDQoJCQl9KQ0KCQkJLmJpbmQoICJrZXlkb3duLmF1dG9jb21wbGV0ZSIsIGZ1bmN0aW9uKCBldmVudCApIHsNCgkJCQlpZiAoIHNlbGYub3B0aW9ucy5kaXNhYmxlZCB8fCBzZWxmLmVsZW1lbnQucHJvcEF0dHIoICJyZWFkT25seSIgKSApIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCXN1cHByZXNzS2V5UHJlc3MgPSBmYWxzZTsNCgkJCQl2YXIga2V5Q29kZSA9ICQudWkua2V5Q29kZTsNCgkJCQlzd2l0Y2goIGV2ZW50LmtleUNvZGUgKSB7DQoJCQkJY2FzZSBrZXlDb2RlLlBBR0VfVVA6DQoJCQkJCXNlbGYuX21vdmUoICJwcmV2aW91c1BhZ2UiLCBldmVudCApOw0KCQkJCQlicmVhazsNCgkJCQljYXNlIGtleUNvZGUuUEFHRV9ET1dOOg0KCQkJCQlzZWxmLl9tb3ZlKCAibmV4dFBhZ2UiLCBldmVudCApOw0KCQkJCQlicmVhazsNCgkJCQljYXNlIGtleUNvZGUuVVA6DQoJCQkJCXNlbGYuX2tleUV2ZW50KCAicHJldmlvdXMiLCBldmVudCApOw0KCQkJCQlicmVhazsNCgkJCQljYXNlIGtleUNvZGUuRE9XTjoNCgkJCQkJc2VsZi5fa2V5RXZlbnQoICJuZXh0IiwgZXZlbnQgKTsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSBrZXlDb2RlLkVOVEVSOg0KCQkJCWNhc2Uga2V5Q29kZS5OVU1QQURfRU5URVI6DQoJCQkJCS8vIHdoZW4gbWVudSBpcyBvcGVuIGFuZCBoYXMgZm9jdXMNCgkJCQkJaWYgKCBzZWxmLm1lbnUuYWN0aXZlICkgew0KCQkJCQkJLy8gIzYwNTUgLSBPcGVyYSBzdGlsbCBhbGxvd3MgdGhlIGtleXByZXNzIHRvIG9jY3VyDQoJCQkJCQkvLyB3aGljaCBjYXVzZXMgZm9ybXMgdG8gc3VibWl0DQoJCQkJCQlzdXBwcmVzc0tleVByZXNzID0gdHJ1ZTsNCgkJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCX0NCgkJCQkJLy9wYXNzdGhyb3VnaCAtIEVOVEVSIGFuZCBUQUIgYm90aCBzZWxlY3QgdGhlIGN1cnJlbnQgZWxlbWVudA0KCQkJCWNhc2Uga2V5Q29kZS5UQUI6DQoJCQkJCWlmICggIXNlbGYubWVudS5hY3RpdmUgKSB7DQoJCQkJCQlyZXR1cm47DQoJCQkJCX0NCgkJCQkJc2VsZi5tZW51LnNlbGVjdCggZXZlbnQgKTsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSBrZXlDb2RlLkVTQ0FQRToNCgkJCQkJc2VsZi5lbGVtZW50LnZhbCggc2VsZi50ZXJtICk7DQoJCQkJCXNlbGYuY2xvc2UoIGV2ZW50ICk7DQoJCQkJCWJyZWFrOw0KCQkJCWRlZmF1bHQ6DQoJCQkJCS8vIGtleXByZXNzIGlzIHRyaWdnZXJlZCBiZWZvcmUgdGhlIGlucHV0IHZhbHVlIGlzIGNoYW5nZWQNCgkJCQkJY2xlYXJUaW1lb3V0KCBzZWxmLnNlYXJjaGluZyApOw0KCQkJCQlzZWxmLnNlYXJjaGluZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJCQkvLyBvbmx5IHNlYXJjaCBpZiB0aGUgdmFsdWUgaGFzIGNoYW5nZWQNCgkJCQkJCWlmICggc2VsZi50ZXJtICE9IHNlbGYuZWxlbWVudC52YWwoKSApIHsNCgkJCQkJCQlzZWxmLnNlbGVjdGVkSXRlbSA9IG51bGw7DQoJCQkJCQkJc2VsZi5zZWFyY2goIG51bGwsIGV2ZW50ICk7DQoJCQkJCQl9DQoJCQkJCX0sIHNlbGYub3B0aW9ucy5kZWxheSApOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQl9KQ0KCQkJLmJpbmQoICJrZXlwcmVzcy5hdXRvY29tcGxldGUiLCBmdW5jdGlvbiggZXZlbnQgKSB7DQoJCQkJaWYgKCBzdXBwcmVzc0tleVByZXNzICkgew0KCQkJCQlzdXBwcmVzc0tleVByZXNzID0gZmFsc2U7DQoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJfQ0KCQkJfSkNCgkJCS5iaW5kKCAiZm9jdXMuYXV0b2NvbXBsZXRlIiwgZnVuY3Rpb24oKSB7DQoJCQkJaWYgKCBzZWxmLm9wdGlvbnMuZGlzYWJsZWQgKSB7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoNCgkJCQlzZWxmLnNlbGVjdGVkSXRlbSA9IG51bGw7DQoJCQkJc2VsZi5wcmV2aW91cyA9IHNlbGYuZWxlbWVudC52YWwoKTsNCgkJCX0pDQoJCQkuYmluZCggImJsdXIuYXV0b2NvbXBsZXRlIiwgZnVuY3Rpb24oIGV2ZW50ICkgew0KCQkJCWlmICggc2VsZi5vcHRpb25zLmRpc2FibGVkICkgew0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KDQoJCQkJY2xlYXJUaW1lb3V0KCBzZWxmLnNlYXJjaGluZyApOw0KCQkJCS8vIGNsaWNrcyBvbiB0aGUgbWVudSAob3IgYSBidXR0b24gdG8gdHJpZ2dlciBhIHNlYXJjaCkgd2lsbCBjYXVzZSBhIGJsdXIgZXZlbnQNCgkJCQlzZWxmLmNsb3NpbmcgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KCQkJCQlzZWxmLmNsb3NlKCBldmVudCApOw0KCQkJCQlzZWxmLl9jaGFuZ2UoIGV2ZW50ICk7DQoJCQkJfSwgMTUwICk7DQoJCQl9KTsNCgkJdGhpcy5faW5pdFNvdXJjZSgpOw0KCQl0aGlzLm1lbnUgPSAkKCAiPHVsPjwvdWw+IiApDQoJCQkuYWRkQ2xhc3MoICJ1aS1hdXRvY29tcGxldGUiICkNCgkJCS5hcHBlbmRUbyggJCggdGhpcy5vcHRpb25zLmFwcGVuZFRvIHx8ICJib2R5IiwgZG9jKVswXSApDQoJCQkvLyBwcmV2ZW50IHRoZSBjbG9zZS1vbi1ibHVyIGluIGNhc2Ugb2YgYSAic2xvdyIgY2xpY2sgb24gdGhlIG1lbnUgKGxvbmcgbW91c2Vkb3duKQ0KCQkJLm1vdXNlZG93bihmdW5jdGlvbiggZXZlbnQgKSB7DQoJCQkJLy8gY2xpY2tpbmcgb24gdGhlIHNjcm9sbGJhciBjYXVzZXMgZm9jdXMgdG8gc2hpZnQgdG8gdGhlIGJvZHkNCgkJCQkvLyBidXQgd2UgY2FuJ3QgZGV0ZWN0IGEgbW91c2V1cCBvciBhIGNsaWNrIGltbWVkaWF0ZWx5IGFmdGVyd2FyZA0KCQkJCS8vIHNvIHdlIGhhdmUgdG8gdHJhY2sgdGhlIG5leHQgbW91c2Vkb3duIGFuZCBjbG9zZSB0aGUgbWVudSBpZg0KCQkJCS8vIHRoZSB1c2VyIGNsaWNrcyBzb21ld2hlcmUgb3V0c2lkZSBvZiB0aGUgYXV0b2NvbXBsZXRlDQoJCQkJdmFyIG1lbnVFbGVtZW50ID0gc2VsZi5tZW51LmVsZW1lbnRbIDAgXTsNCgkJCQlpZiAoICEkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAiLnVpLW1lbnUtaXRlbSIgKS5sZW5ndGggKSB7DQoJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJCQkkKCBkb2N1bWVudCApLm9uZSggJ21vdXNlZG93bicsIGZ1bmN0aW9uKCBldmVudCApIHsNCgkJCQkJCQlpZiAoIGV2ZW50LnRhcmdldCAhPT0gc2VsZi5lbGVtZW50WyAwIF0gJiYNCgkJCQkJCQkJZXZlbnQudGFyZ2V0ICE9PSBtZW51RWxlbWVudCAmJg0KCQkJCQkJCQkhJC51aS5jb250YWlucyggbWVudUVsZW1lbnQsIGV2ZW50LnRhcmdldCApICkgew0KCQkJCQkJCQlzZWxmLmNsb3NlKCk7DQoJCQkJCQkJfQ0KCQkJCQkJfSk7DQoJCQkJCX0sIDEgKTsNCgkJCQl9DQoNCgkJCQkvLyB1c2UgYW5vdGhlciB0aW1lb3V0IHRvIG1ha2Ugc3VyZSB0aGUgYmx1ci1ldmVudC1oYW5kbGVyIG9uIHRoZSBpbnB1dCB3YXMgYWxyZWFkeSB0cmlnZ2VyZWQNCgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KCQkJCQljbGVhclRpbWVvdXQoIHNlbGYuY2xvc2luZyApOw0KCQkJCX0sIDEzKTsNCgkJCX0pDQoJCQkubWVudSh7DQoJCQkJZm9jdXM6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7DQoJCQkJCXZhciBpdGVtID0gdWkuaXRlbS5kYXRhKCAiaXRlbS5hdXRvY29tcGxldGUiICk7DQoJCQkJCWlmICggZmFsc2UgIT09IHNlbGYuX3RyaWdnZXIoICJmb2N1cyIsIGV2ZW50LCB7IGl0ZW06IGl0ZW0gfSApICkgew0KCQkJCQkJLy8gdXNlIHZhbHVlIHRvIG1hdGNoIHdoYXQgd2lsbCBlbmQgdXAgaW4gdGhlIGlucHV0LCBpZiBpdCB3YXMgYSBrZXkgZXZlbnQNCgkJCQkJCWlmICggL15rZXkvLnRlc3QoZXZlbnQub3JpZ2luYWxFdmVudC50eXBlKSApIHsNCgkJCQkJCQlzZWxmLmVsZW1lbnQudmFsKCBpdGVtLnZhbHVlICk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9LA0KCQkJCXNlbGVjdGVkOiBmdW5jdGlvbiggZXZlbnQsIHVpICkgew0KCQkJCQl2YXIgaXRlbSA9IHVpLml0ZW0uZGF0YSggIml0ZW0uYXV0b2NvbXBsZXRlIiApLA0KCQkJCQkJcHJldmlvdXMgPSBzZWxmLnByZXZpb3VzOw0KDQoJCQkJCS8vIG9ubHkgdHJpZ2dlciB3aGVuIGZvY3VzIHdhcyBsb3N0IChjbGljayBvbiBtZW51KQ0KCQkJCQlpZiAoIHNlbGYuZWxlbWVudFswXSAhPT0gZG9jLmFjdGl2ZUVsZW1lbnQgKSB7DQoJCQkJCQlzZWxmLmVsZW1lbnQuZm9jdXMoKTsNCgkJCQkJCXNlbGYucHJldmlvdXMgPSBwcmV2aW91czsNCgkJCQkJCS8vICM2MTA5IC0gSUUgdHJpZ2dlcnMgdHdvIGZvY3VzIGV2ZW50cyBhbmQgdGhlIHNlY29uZA0KCQkJCQkJLy8gaXMgYXN5bmNocm9ub3VzLCBzbyB3ZSBuZWVkIHRvIHJlc2V0IHRoZSBwcmV2aW91cw0KCQkJCQkJLy8gdGVybSBzeW5jaHJvbm91c2x5IGFuZCBhc3luY2hyb25vdXNseSA6LSgNCgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJCQkJc2VsZi5wcmV2aW91cyA9IHByZXZpb3VzOw0KCQkJCQkJCXNlbGYuc2VsZWN0ZWRJdGVtID0gaXRlbTsNCgkJCQkJCX0sIDEpOw0KCQkJCQl9DQoNCgkJCQkJaWYgKCBmYWxzZSAhPT0gc2VsZi5fdHJpZ2dlciggInNlbGVjdCIsIGV2ZW50LCB7IGl0ZW06IGl0ZW0gfSApICkgew0KCQkJCQkJc2VsZi5lbGVtZW50LnZhbCggaXRlbS52YWx1ZSApOw0KCQkJCQl9DQoJCQkJCS8vIHJlc2V0IHRoZSB0ZXJtIGFmdGVyIHRoZSBzZWxlY3QgZXZlbnQNCgkJCQkJLy8gdGhpcyBhbGxvd3MgY3VzdG9tIHNlbGVjdCBoYW5kbGluZyB0byB3b3JrIHByb3Blcmx5DQoJCQkJCXNlbGYudGVybSA9IHNlbGYuZWxlbWVudC52YWwoKTsNCg0KCQkJCQlzZWxmLmNsb3NlKCBldmVudCApOw0KCQkJCQlzZWxmLnNlbGVjdGVkSXRlbSA9IGl0ZW07DQoJCQkJfSwNCgkJCQlibHVyOiBmdW5jdGlvbiggZXZlbnQsIHVpICkgew0KCQkJCQkvLyBkb24ndCBzZXQgdGhlIHZhbHVlIG9mIHRoZSB0ZXh0IGZpZWxkIGlmIGl0J3MgYWxyZWFkeSBjb3JyZWN0DQoJCQkJCS8vIHRoaXMgcHJldmVudHMgbW92aW5nIHRoZSBjdXJzb3IgdW5uZWNlc3NhcmlseQ0KCQkJCQlpZiAoIHNlbGYubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpICYmDQoJCQkJCQkoIHNlbGYuZWxlbWVudC52YWwoKSAhPT0gc2VsZi50ZXJtICkgKSB7DQoJCQkJCQlzZWxmLmVsZW1lbnQudmFsKCBzZWxmLnRlcm0gKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0pDQoJCQkuekluZGV4KCB0aGlzLmVsZW1lbnQuekluZGV4KCkgKyAxICkNCgkJCS8vIHdvcmthcm91bmQgZm9yIGpRdWVyeSBidWcgIzU3ODEgaHR0cDovL2Rldi5qcXVlcnkuY29tL3RpY2tldC81NzgxDQoJCQkuY3NzKHsgdG9wOiAwLCBsZWZ0OiAwIH0pDQoJCQkuaGlkZSgpDQoJCQkuZGF0YSggIm1lbnUiICk7DQoJCWlmICggJC5mbi5iZ2lmcmFtZSApIHsNCgkJCSB0aGlzLm1lbnUuZWxlbWVudC5iZ2lmcmFtZSgpOw0KCQl9DQoJCS8vIHR1cm5pbmcgb2ZmIGF1dG9jb21wbGV0ZSBwcmV2ZW50cyB0aGUgYnJvd3NlciBmcm9tIHJlbWVtYmVyaW5nIHRoZQ0KCQkvLyB2YWx1ZSB3aGVuIG5hdmlnYXRpbmcgdGhyb3VnaCBoaXN0b3J5LCBzbyB3ZSByZS1lbmFibGUgYXV0b2NvbXBsZXRlDQoJCS8vIGlmIHRoZSBwYWdlIGlzIHVubG9hZGVkIGJlZm9yZSB0aGUgd2lkZ2V0IGlzIGRlc3Ryb3llZC4gIzc3OTANCgkJc2VsZi5iZWZvcmV1bmxvYWRIYW5kbGVyID0gZnVuY3Rpb24oKSB7DQoJCQlzZWxmLmVsZW1lbnQucmVtb3ZlQXR0ciggImF1dG9jb21wbGV0ZSIgKTsNCgkJfTsNCgkJJCggd2luZG93ICkuYmluZCggImJlZm9yZXVubG9hZCIsIHNlbGYuYmVmb3JldW5sb2FkSGFuZGxlciApOw0KCX0sDQoNCglkZXN0cm95OiBmdW5jdGlvbigpIHsNCgkJdGhpcy5lbGVtZW50DQoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1hdXRvY29tcGxldGUtaW5wdXQiICkNCgkJCS5yZW1vdmVBdHRyKCAiYXV0b2NvbXBsZXRlIiApDQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkNCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1hdXRvY29tcGxldGUiICkNCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1oYXNwb3B1cCIgKTsNCgkJdGhpcy5tZW51LmVsZW1lbnQucmVtb3ZlKCk7DQoJCSQoIHdpbmRvdyApLnVuYmluZCggImJlZm9yZXVubG9hZCIsIHRoaXMuYmVmb3JldW5sb2FkSGFuZGxlciApOw0KCQkkLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKCB0aGlzICk7DQoJfSwNCg0KCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgew0KCQkkLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7DQoJCWlmICgga2V5ID09PSAic291cmNlIiApIHsNCgkJCXRoaXMuX2luaXRTb3VyY2UoKTsNCgkJfQ0KCQlpZiAoIGtleSA9PT0gImFwcGVuZFRvIiApIHsNCgkJCXRoaXMubWVudS5lbGVtZW50LmFwcGVuZFRvKCAkKCB2YWx1ZSB8fCAiYm9keSIsIHRoaXMuZWxlbWVudFswXS5vd25lckRvY3VtZW50IClbMF0gKQ0KCQl9DQoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICYmIHZhbHVlICYmIHRoaXMueGhyICkgew0KCQkJdGhpcy54aHIuYWJvcnQoKTsNCgkJfQ0KCX0sDQoNCglfaW5pdFNvdXJjZTogZnVuY3Rpb24oKSB7DQoJCXZhciBzZWxmID0gdGhpcywNCgkJCWFycmF5LA0KCQkJdXJsOw0KCQlpZiAoICQuaXNBcnJheSh0aGlzLm9wdGlvbnMuc291cmNlKSApIHsNCgkJCWFycmF5ID0gdGhpcy5vcHRpb25zLnNvdXJjZTsNCgkJCXRoaXMuc291cmNlID0gZnVuY3Rpb24oIHJlcXVlc3QsIHJlc3BvbnNlICkgew0KCQkJCXJlc3BvbnNlKCAkLnVpLmF1dG9jb21wbGV0ZS5maWx0ZXIoYXJyYXksIHJlcXVlc3QudGVybSkgKTsNCgkJCX07DQoJCX0gZWxzZSBpZiAoIHR5cGVvZiB0aGlzLm9wdGlvbnMuc291cmNlID09PSAic3RyaW5nIiApIHsNCgkJCXVybCA9IHRoaXMub3B0aW9ucy5zb3VyY2U7DQoJCQl0aGlzLnNvdXJjZSA9IGZ1bmN0aW9uKCByZXF1ZXN0LCByZXNwb25zZSApIHsNCgkJCQlpZiAoIHNlbGYueGhyICkgew0KCQkJCQlzZWxmLnhoci5hYm9ydCgpOw0KCQkJCX0NCgkJCQlzZWxmLnhociA9ICQuYWpheCh7DQoJCQkJCXVybDogdXJsLA0KCQkJCQlkYXRhOiByZXF1ZXN0LA0KCQkJCQlkYXRhVHlwZTogImpzb24iLA0KCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiggZGF0YSwgc3RhdHVzICkgew0KCQkJCQkJcmVzcG9uc2UoIGRhdGEgKTsNCgkJCQkJfSwNCgkJCQkJZXJyb3I6IGZ1bmN0aW9uKCkgew0KCQkJCQkJcmVzcG9uc2UoIFtdICk7DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX07DQoJCX0gZWxzZSB7DQoJCQl0aGlzLnNvdXJjZSA9IHRoaXMub3B0aW9ucy5zb3VyY2U7DQoJCX0NCgl9LA0KDQoJc2VhcmNoOiBmdW5jdGlvbiggdmFsdWUsIGV2ZW50ICkgew0KCQl2YWx1ZSA9IHZhbHVlICE9IG51bGwgPyB2YWx1ZSA6IHRoaXMuZWxlbWVudC52YWwoKTsNCg0KCQkvLyBhbHdheXMgc2F2ZSB0aGUgYWN0dWFsIHZhbHVlLCBub3QgdGhlIG9uZSBwYXNzZWQgYXMgYW4gYXJndW1lbnQNCgkJdGhpcy50ZXJtID0gdGhpcy5lbGVtZW50LnZhbCgpOw0KDQoJCWlmICggdmFsdWUubGVuZ3RoIDwgdGhpcy5vcHRpb25zLm1pbkxlbmd0aCApIHsNCgkJCXJldHVybiB0aGlzLmNsb3NlKCBldmVudCApOw0KCQl9DQoNCgkJY2xlYXJUaW1lb3V0KCB0aGlzLmNsb3NpbmcgKTsNCgkJaWYgKCB0aGlzLl90cmlnZ2VyKCAic2VhcmNoIiwgZXZlbnQgKSA9PT0gZmFsc2UgKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQlyZXR1cm4gdGhpcy5fc2VhcmNoKCB2YWx1ZSApOw0KCX0sDQoNCglfc2VhcmNoOiBmdW5jdGlvbiggdmFsdWUgKSB7DQoJCXRoaXMucGVuZGluZysrOw0KCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoICJ1aS1hdXRvY29tcGxldGUtbG9hZGluZyIgKTsNCg0KCQl0aGlzLnNvdXJjZSggeyB0ZXJtOiB2YWx1ZSB9LCB0aGlzLl9yZXNwb25zZSgpICk7DQoJfSwNCg0KCV9yZXNwb25zZTogZnVuY3Rpb24oKSB7DQoJCXZhciB0aGF0ID0gdGhpcywNCgkJCWluZGV4ID0gKytyZXF1ZXN0SW5kZXg7DQoNCgkJcmV0dXJuIGZ1bmN0aW9uKCBjb250ZW50ICkgew0KCQkJaWYgKCBpbmRleCA9PT0gcmVxdWVzdEluZGV4ICkgew0KCQkJCXRoYXQuX19yZXNwb25zZSggY29udGVudCApOw0KCQkJfQ0KDQoJCQl0aGF0LnBlbmRpbmctLTsNCgkJCWlmICggIXRoYXQucGVuZGluZyApIHsNCgkJCQl0aGF0LmVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1hdXRvY29tcGxldGUtbG9hZGluZyIgKTsNCgkJCX0NCgkJfTsNCgl9LA0KDQoJX19yZXNwb25zZTogZnVuY3Rpb24oIGNvbnRlbnQgKSB7DQogICAgICAgICAgICAgaWYgKCBjb250ZW50ICkgew0KCQkJY29udGVudCA9IHRoaXMuX25vcm1hbGl6ZSggY29udGVudCApOw0KCQl9DQoJCXRoaXMuX3RyaWdnZXIoICJyZXNwb25zZSIsIG51bGwsIHsgY29udGVudDogY29udGVudCB9ICk7DQoJCWlmICggIXRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiBjb250ZW50ICYmIGNvbnRlbnQubGVuZ3RoICkgew0KCQkJY29udGVudCA9IHRoaXMuX25vcm1hbGl6ZSggY29udGVudCApOw0KCQkJdGhpcy5fc3VnZ2VzdCggY29udGVudCApOw0KCQkJdGhpcy5fdHJpZ2dlciggIm9wZW4iICk7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLmNsb3NlKCk7DQoJCX0NCgl9LA0KDQoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsNCgkJY2xlYXJUaW1lb3V0KCB0aGlzLmNsb3NpbmcgKTsNCgkJaWYgKCB0aGlzLm1lbnUuZWxlbWVudC5pcygiOnZpc2libGUiKSApIHsNCgkJCXRoaXMubWVudS5lbGVtZW50LmhpZGUoKTsNCgkJCXRoaXMubWVudS5kZWFjdGl2YXRlKCk7DQoJCQl0aGlzLl90cmlnZ2VyKCAiY2xvc2UiLCBldmVudCApOw0KCQl9DQoJfSwNCg0KCV9jaGFuZ2U6IGZ1bmN0aW9uKCBldmVudCApIHsNCgkJaWYgKCB0aGlzLnByZXZpb3VzICE9PSB0aGlzLmVsZW1lbnQudmFsKCkgKSB7DQoJCQl0aGlzLl90cmlnZ2VyKCAiY2hhbmdlIiwgZXZlbnQsIHsgaXRlbTogdGhpcy5zZWxlY3RlZEl0ZW0gfSApOw0KCQl9DQoJfSwNCg0KCV9ub3JtYWxpemU6IGZ1bmN0aW9uKCBpdGVtcyApIHsNCgkJLy8gYXNzdW1lIGFsbCBpdGVtcyBoYXZlIHRoZSByaWdodCBmb3JtYXQgd2hlbiB0aGUgZmlyc3QgaXRlbSBpcyBjb21wbGV0ZQ0KCQlpZiAoIGl0ZW1zLmxlbmd0aCAmJiBpdGVtc1swXS5sYWJlbCAmJiBpdGVtc1swXS52YWx1ZSApIHsNCgkJCXJldHVybiBpdGVtczsNCgkJfQ0KCQlyZXR1cm4gJC5tYXAoIGl0ZW1zLCBmdW5jdGlvbihpdGVtKSB7DQoJCQlpZiAoIHR5cGVvZiBpdGVtID09PSAic3RyaW5nIiApIHsNCgkJCQlyZXR1cm4gew0KCQkJCQlsYWJlbDogaXRlbSwNCgkJCQkJdmFsdWU6IGl0ZW0NCgkJCQl9Ow0KCQkJfQ0KCQkJcmV0dXJuICQuZXh0ZW5kKHsNCgkJCQlsYWJlbDogaXRlbS5sYWJlbCB8fCBpdGVtLnZhbHVlLA0KCQkJCXZhbHVlOiBpdGVtLnZhbHVlIHx8IGl0ZW0ubGFiZWwNCgkJCX0sIGl0ZW0gKTsNCgkJfSk7DQoJfSwNCg0KCV9zdWdnZXN0OiBmdW5jdGlvbiggaXRlbXMgKSB7DQoJCXZhciB1bCA9IHRoaXMubWVudS5lbGVtZW50DQoJCQkuZW1wdHkoKQ0KCQkJLnpJbmRleCggdGhpcy5lbGVtZW50LnpJbmRleCgpICsgMSApOw0KCQl0aGlzLl9yZW5kZXJNZW51KCB1bCwgaXRlbXMgKTsNCgkJLy8gVE9ETyByZWZyZXNoIHNob3VsZCBjaGVjayBpZiB0aGUgYWN0aXZlIGl0ZW0gaXMgc3RpbGwgaW4gdGhlIGRvbSwgcmVtb3ZpbmcgdGhlIG5lZWQgZm9yIGEgbWFudWFsIGRlYWN0aXZhdGUNCgkJdGhpcy5tZW51LmRlYWN0aXZhdGUoKTsNCgkJdGhpcy5tZW51LnJlZnJlc2goKTsNCg0KCQkvLyBzaXplIGFuZCBwb3NpdGlvbiBtZW51DQoJCXVsLnNob3coKTsNCgkJdGhpcy5fcmVzaXplTWVudSgpOw0KCQl1bC5wb3NpdGlvbiggJC5leHRlbmQoew0KCQkJb2Y6IHRoaXMuZWxlbWVudA0KCQl9LCB0aGlzLm9wdGlvbnMucG9zaXRpb24gKSk7DQoNCgkJaWYgKCB0aGlzLm9wdGlvbnMuYXV0b0ZvY3VzICkgew0KCQkJdGhpcy5tZW51Lm5leHQoIG5ldyAkLkV2ZW50KCJtb3VzZW92ZXIiKSApOw0KCQl9DQoJfSwNCg0KCV9yZXNpemVNZW51OiBmdW5jdGlvbigpIHsNCgkJdmFyIHVsID0gdGhpcy5tZW51LmVsZW1lbnQ7DQoJCXVsLm91dGVyV2lkdGgoIE1hdGgubWF4KA0KCQkJLy8gRmlyZWZveCB3cmFwcyBsb25nIHRleHQgKHBvc3NpYmx5IGEgcm91bmRpbmcgYnVnKQ0KCQkJLy8gc28gd2UgYWRkIDFweCB0byBhdm9pZCB0aGUgd3JhcHBpbmcgKCM3NTEzKQ0KCQkJdWwud2lkdGgoICIiICkub3V0ZXJXaWR0aCgpICsgMSwNCgkJCXRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkNCgkJKSApOw0KCX0sDQoNCglfcmVuZGVyTWVudTogZnVuY3Rpb24oIHVsLCBpdGVtcyApIHsNCgkJdmFyIHNlbGYgPSB0aGlzOw0KCQkkLmVhY2goIGl0ZW1zLCBmdW5jdGlvbiggaW5kZXgsIGl0ZW0gKSB7DQoJCQlzZWxmLl9yZW5kZXJJdGVtKCB1bCwgaXRlbSApOw0KCQl9KTsNCgl9LA0KDQoJX3JlbmRlckl0ZW06IGZ1bmN0aW9uKCB1bCwgaXRlbSkgew0KCQlyZXR1cm4gJCggIjxsaT48L2xpPiIgKQ0KCQkJLmRhdGEoICJpdGVtLmF1dG9jb21wbGV0ZSIsIGl0ZW0gKQ0KCQkJLmFwcGVuZCggJCggIjxhPjwvYT4iICkuYXBwZW5kKCBpdGVtLmxhYmVsICkgKQ0KCQkJLmFwcGVuZFRvKCB1bCApOw0KCX0sDQoNCglfbW92ZTogZnVuY3Rpb24oIGRpcmVjdGlvbiwgZXZlbnQgKSB7DQoJCWlmICggIXRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpICkgew0KCQkJdGhpcy5zZWFyY2goIG51bGwsIGV2ZW50ICk7DQoJCQlyZXR1cm47DQoJCX0NCgkJaWYgKCB0aGlzLm1lbnUuZmlyc3QoKSAmJiAvXnByZXZpb3VzLy50ZXN0KGRpcmVjdGlvbikgfHwNCgkJCQl0aGlzLm1lbnUubGFzdCgpICYmIC9ebmV4dC8udGVzdChkaXJlY3Rpb24pICkgew0KCQkJdGhpcy5lbGVtZW50LnZhbCggdGhpcy50ZXJtICk7DQoJCQl0aGlzLm1lbnUuZGVhY3RpdmF0ZSgpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCXRoaXMubWVudVsgZGlyZWN0aW9uIF0oIGV2ZW50ICk7DQoJfSwNCg0KCXdpZGdldDogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLm1lbnUuZWxlbWVudDsNCgl9LA0KCV9rZXlFdmVudDogZnVuY3Rpb24oIGtleUV2ZW50LCBldmVudCApIHsNCgkJaWYgKCAhdGhpcy5pc011bHRpTGluZSB8fCB0aGlzLm1lbnUuZWxlbWVudC5pcyggIjp2aXNpYmxlIiApICkgew0KCQkJdGhpcy5fbW92ZSgga2V5RXZlbnQsIGV2ZW50ICk7DQoNCgkJCS8vIHByZXZlbnRzIG1vdmluZyBjdXJzb3IgdG8gYmVnaW5uaW5nL2VuZCBvZiB0aGUgdGV4dCBmaWVsZCBpbiBzb21lIGJyb3dzZXJzDQoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQl9DQoJfQ0KfSk7DQoNCiQuZXh0ZW5kKCAkLnVpLmF1dG9jb21wbGV0ZSwgew0KCWVzY2FwZVJlZ2V4OiBmdW5jdGlvbiggdmFsdWUgKSB7DQoJCXJldHVybiB2YWx1ZS5yZXBsYWNlKC9bLVtcXXt9KCkqKz8uLFxcXiR8I1xzXS9nLCAiXFwkJiIpOw0KCX0sDQoJZmlsdGVyOiBmdW5jdGlvbihhcnJheSwgdGVybSkgew0KCQl2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoICQudWkuYXV0b2NvbXBsZXRlLmVzY2FwZVJlZ2V4KHRlcm0pLCAiaSIgKTsNCgkJcmV0dXJuICQuZ3JlcCggYXJyYXksIGZ1bmN0aW9uKHZhbHVlKSB7DQoJCQlyZXR1cm4gbWF0Y2hlci50ZXN0KCB2YWx1ZS5sYWJlbCB8fCB2YWx1ZS52YWx1ZSB8fCB2YWx1ZSApOw0KCQl9KTsNCgl9DQp9KTsNCg0KfSggalF1ZXJ5ICkpOw0KDQovKg0KICogalF1ZXJ5IFVJIE1lbnUgKG5vdCBvZmZpY2lhbGx5IHJlbGVhc2VkKQ0KICoNCiAqIFRoaXMgd2lkZ2V0IGlzbid0IHlldCBmaW5pc2hlZCBhbmQgdGhlIEFQSSBpcyBzdWJqZWN0IHRvIGNoYW5nZS4gV2UgcGxhbiB0byBmaW5pc2gNCiAqIGl0IGZvciB0aGUgbmV4dCByZWxlYXNlLiBZb3UncmUgd2VsY29tZSB0byBnaXZlIGl0IGEgdHJ5IGFueXdheSBhbmQgZ2l2ZSB1cyBmZWVkYmFjaywNCiAqIGFzIGxvbmcgYXMgeW91J3JlIG9rYXkgd2l0aCBtaWdyYXRpbmcgeW91ciBjb2RlIGxhdGVyIG9uLiBXZSBjYW4gaGVscCB3aXRoIHRoYXQsIHRvby4NCiAqDQogKiBDb3B5cmlnaHQgMjAxMCwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpDQogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4NCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UNCiAqDQogKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL01lbnUNCiAqDQogKiBEZXBlbmRzOg0KICoJanF1ZXJ5LnVpLmNvcmUuanMNCiAqICBqcXVlcnkudWkud2lkZ2V0LmpzDQogKi8NCihmdW5jdGlvbigkKSB7DQoNCiQud2lkZ2V0KCJ1aS5tZW51Iiwgew0KCV9jcmVhdGU6IGZ1bmN0aW9uKCkgew0KCQl2YXIgc2VsZiA9IHRoaXM7DQoJCXRoaXMuZWxlbWVudA0KCQkJLmFkZENsYXNzKCJ1aS1tZW51IHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIikNCgkJCS5hdHRyKHsNCgkJCQlyb2xlOiAibGlzdGJveCIsDQoJCQkJImFyaWEtYWN0aXZlZGVzY2VuZGFudCI6ICJ1aS1hY3RpdmUtbWVudWl0ZW0iDQoJCQl9KQ0KCQkJLmNsaWNrKGZ1bmN0aW9uKCBldmVudCApIHsNCgkJCQlpZiAoICEkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAiLnVpLW1lbnUtaXRlbSBhIiApLmxlbmd0aCApIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCgkJCQkvLyB0ZW1wb3JhcnkNCgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCXNlbGYuc2VsZWN0KCBldmVudCApOw0KCQkJfSk7DQoJCXRoaXMucmVmcmVzaCgpOw0KCX0sDQoNCglyZWZyZXNoOiBmdW5jdGlvbigpIHsNCgkJdmFyIHNlbGYgPSB0aGlzOw0KDQoJCS8vIGRvbid0IHJlZnJlc2ggbGlzdCBpdGVtcyB0aGF0IGFyZSBhbHJlYWR5IGFkYXB0ZWQNCgkJdmFyIGl0ZW1zID0gdGhpcy5lbGVtZW50LmNoaWxkcmVuKCJsaTpub3QoLnVpLW1lbnUtaXRlbSk6aGFzKGEpIikNCgkJCS5hZGRDbGFzcygidWktbWVudS1pdGVtIikNCgkJCS5hdHRyKCJyb2xlIiwgIm1lbnVpdGVtIik7DQoNCgkJaXRlbXMuY2hpbGRyZW4oImEiKQ0KCQkJLmFkZENsYXNzKCJ1aS1jb3JuZXItYWxsIikNCgkJCS5hdHRyKCJ0YWJpbmRleCIsIC0xKQ0KCQkJLy8gbW91c2VlbnRlciBkb2Vzbid0IHdvcmsgd2l0aCBldmVudCBkZWxlZ2F0aW9uDQoJCQkubW91c2VlbnRlcihmdW5jdGlvbiggZXZlbnQgKSB7DQoJCQkJc2VsZi5hY3RpdmF0ZSggZXZlbnQsICQodGhpcykucGFyZW50KCkgKTsNCgkJCX0pDQoJCQkubW91c2VsZWF2ZShmdW5jdGlvbigpIHsNCgkJCQlzZWxmLmRlYWN0aXZhdGUoKTsNCgkJCX0pOw0KCX0sDQoNCglhY3RpdmF0ZTogZnVuY3Rpb24oIGV2ZW50LCBpdGVtICkgew0KCQl0aGlzLmRlYWN0aXZhdGUoKTsNCgkJaWYgKHRoaXMuaGFzU2Nyb2xsKCkpIHsNCgkJCXZhciBvZmZzZXQgPSBpdGVtLm9mZnNldCgpLnRvcCAtIHRoaXMuZWxlbWVudC5vZmZzZXQoKS50b3AsDQoJCQkJc2Nyb2xsID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCgpLA0KCQkJCWVsZW1lbnRIZWlnaHQgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCk7DQoJCQlpZiAob2Zmc2V0IDwgMCkgew0KCQkJCXRoaXMuZWxlbWVudC5zY3JvbGxUb3AoIHNjcm9sbCArIG9mZnNldCk7DQoJCQl9IGVsc2UgaWYgKG9mZnNldCA+PSBlbGVtZW50SGVpZ2h0KSB7DQoJCQkJdGhpcy5lbGVtZW50LnNjcm9sbFRvcCggc2Nyb2xsICsgb2Zmc2V0IC0gZWxlbWVudEhlaWdodCArIGl0ZW0uaGVpZ2h0KCkpOw0KCQkJfQ0KCQl9DQoJCXRoaXMuYWN0aXZlID0gaXRlbS5lcSgwKQ0KCQkJLmNoaWxkcmVuKCJhIikNCgkJCQkuYWRkQ2xhc3MoInVpLXN0YXRlLWhvdmVyIikNCgkJCQkuYXR0cigiaWQiLCAidWktYWN0aXZlLW1lbnVpdGVtIikNCgkJCS5lbmQoKTsNCgkJdGhpcy5fdHJpZ2dlcigiZm9jdXMiLCBldmVudCwgeyBpdGVtOiBpdGVtIH0pOw0KCX0sDQoNCglkZWFjdGl2YXRlOiBmdW5jdGlvbigpIHsNCgkJaWYgKCF0aGlzLmFjdGl2ZSkgeyByZXR1cm47IH0NCg0KCQl0aGlzLmFjdGl2ZS5jaGlsZHJlbigiYSIpDQoJCQkucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIikNCgkJCS5yZW1vdmVBdHRyKCJpZCIpOw0KCQl0aGlzLl90cmlnZ2VyKCJibHVyIik7DQoJCXRoaXMuYWN0aXZlID0gbnVsbDsNCgl9LA0KDQoJbmV4dDogZnVuY3Rpb24oZXZlbnQpIHsNCgkJdGhpcy5tb3ZlKCJuZXh0IiwgIi51aS1tZW51LWl0ZW06Zmlyc3QiLCBldmVudCk7DQoJfSwNCg0KCXByZXZpb3VzOiBmdW5jdGlvbihldmVudCkgew0KCQl0aGlzLm1vdmUoInByZXYiLCAiLnVpLW1lbnUtaXRlbTpsYXN0IiwgZXZlbnQpOw0KCX0sDQoNCglmaXJzdDogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLmFjdGl2ZSAmJiAhdGhpcy5hY3RpdmUucHJldkFsbCgiLnVpLW1lbnUtaXRlbSIpLmxlbmd0aDsNCgl9LA0KDQoJbGFzdDogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLmFjdGl2ZSAmJiAhdGhpcy5hY3RpdmUubmV4dEFsbCgiLnVpLW1lbnUtaXRlbSIpLmxlbmd0aDsNCgl9LA0KDQoJbW92ZTogZnVuY3Rpb24oZGlyZWN0aW9uLCBlZGdlLCBldmVudCkgew0KCQlpZiAoIXRoaXMuYWN0aXZlKSB7DQoJCQl0aGlzLmFjdGl2YXRlKGV2ZW50LCB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oZWRnZSkpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCXZhciBuZXh0ID0gdGhpcy5hY3RpdmVbZGlyZWN0aW9uICsgIkFsbCJdKCIudWktbWVudS1pdGVtIikuZXEoMCk7DQoJCWlmIChuZXh0Lmxlbmd0aCkgew0KCQkJdGhpcy5hY3RpdmF0ZShldmVudCwgbmV4dCk7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLmFjdGl2YXRlKGV2ZW50LCB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oZWRnZSkpOw0KCQl9DQoJfSwNCg0KCS8vIFRPRE8gbWVyZ2Ugd2l0aCBwcmV2aW91c1BhZ2UNCgluZXh0UGFnZTogZnVuY3Rpb24oZXZlbnQpIHsNCgkJaWYgKHRoaXMuaGFzU2Nyb2xsKCkpIHsNCgkJCS8vIFRPRE8gbWVyZ2Ugd2l0aCBuby1zY3JvbGwtZWxzZQ0KCQkJaWYgKCF0aGlzLmFjdGl2ZSB8fCB0aGlzLmxhc3QoKSkgew0KCQkJCXRoaXMuYWN0aXZhdGUoZXZlbnQsIHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbTpmaXJzdCIpKTsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCQl2YXIgYmFzZSA9IHRoaXMuYWN0aXZlLm9mZnNldCgpLnRvcCwNCgkJCQloZWlnaHQgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCksDQoJCQkJcmVzdWx0ID0gdGhpcy5lbGVtZW50LmNoaWxkcmVuKCIudWktbWVudS1pdGVtIikuZmlsdGVyKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgY2xvc2UgPSAkKHRoaXMpLm9mZnNldCgpLnRvcCAtIGJhc2UgLSBoZWlnaHQgKyAkKHRoaXMpLmhlaWdodCgpOw0KCQkJCQkvLyBUT0RPIGltcHJvdmUgYXBwcm94aW1hdGlvbg0KCQkJCQlyZXR1cm4gY2xvc2UgPCAxMCAmJiBjbG9zZSA+IC0xMDsNCgkJCQl9KTsNCg0KCQkJLy8gVE9ETyB0cnkgdG8gY2F0Y2ggdGhpcyBlYXJsaWVyIHdoZW4gc2Nyb2xsVG9wIGluZGljYXRlcyB0aGUgbGFzdCBwYWdlIGFueXdheQ0KCQkJaWYgKCFyZXN1bHQubGVuZ3RoKSB7DQoJCQkJcmVzdWx0ID0gdGhpcy5lbGVtZW50LmNoaWxkcmVuKCIudWktbWVudS1pdGVtOmxhc3QiKTsNCgkJCX0NCgkJCXRoaXMuYWN0aXZhdGUoZXZlbnQsIHJlc3VsdCk7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLmFjdGl2YXRlKGV2ZW50LCB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oIi51aS1tZW51LWl0ZW0iKQ0KCQkJCS5maWx0ZXIoIXRoaXMuYWN0aXZlIHx8IHRoaXMubGFzdCgpID8gIjpmaXJzdCIgOiAiOmxhc3QiKSk7DQoJCX0NCgl9LA0KDQoJLy8gVE9ETyBtZXJnZSB3aXRoIG5leHRQYWdlDQoJcHJldmlvdXNQYWdlOiBmdW5jdGlvbihldmVudCkgew0KCQlpZiAodGhpcy5oYXNTY3JvbGwoKSkgew0KCQkJLy8gVE9ETyBtZXJnZSB3aXRoIG5vLXNjcm9sbC1lbHNlDQoJCQlpZiAoIXRoaXMuYWN0aXZlIHx8IHRoaXMuZmlyc3QoKSkgew0KCQkJCXRoaXMuYWN0aXZhdGUoZXZlbnQsIHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbTpsYXN0IikpOw0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJdmFyIGJhc2UgPSB0aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3AsDQoJCQkJaGVpZ2h0ID0gdGhpcy5lbGVtZW50LmhlaWdodCgpLA0KCQkJCXJlc3VsdCA9IHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbSIpLmZpbHRlcihmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGNsb3NlID0gJCh0aGlzKS5vZmZzZXQoKS50b3AgLSBiYXNlICsgaGVpZ2h0IC0gJCh0aGlzKS5oZWlnaHQoKTsNCgkJCQkJLy8gVE9ETyBpbXByb3ZlIGFwcHJveGltYXRpb24NCgkJCQkJcmV0dXJuIGNsb3NlIDwgMTAgJiYgY2xvc2UgPiAtMTA7DQoJCQkJfSk7DQoNCgkJCS8vIFRPRE8gdHJ5IHRvIGNhdGNoIHRoaXMgZWFybGllciB3aGVuIHNjcm9sbFRvcCBpbmRpY2F0ZXMgdGhlIGxhc3QgcGFnZSBhbnl3YXkNCgkJCWlmICghcmVzdWx0Lmxlbmd0aCkgew0KCQkJCXJlc3VsdCA9IHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbTpmaXJzdCIpOw0KCQkJfQ0KCQkJdGhpcy5hY3RpdmF0ZShldmVudCwgcmVzdWx0KTsNCgkJfSBlbHNlIHsNCgkJCXRoaXMuYWN0aXZhdGUoZXZlbnQsIHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbSIpDQoJCQkJLmZpbHRlcighdGhpcy5hY3RpdmUgfHwgdGhpcy5maXJzdCgpID8gIjpsYXN0IiA6ICI6Zmlyc3QiKSk7DQoJCX0NCgl9LA0KDQoJaGFzU2Nyb2xsOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMuZWxlbWVudC5oZWlnaHQoKSA8IHRoaXMuZWxlbWVudFsgJC5mbi5wcm9wID8gInByb3AiIDogImF0dHIiIF0oInNjcm9sbEhlaWdodCIpOw0KCX0sDQoNCglzZWxlY3Q6IGZ1bmN0aW9uKCBldmVudCApIHsNCgkJdGhpcy5fdHJpZ2dlcigic2VsZWN0ZWQiLCBldmVudCwgeyBpdGVtOiB0aGlzLmFjdGl2ZSB9KTsNCgl9DQp9KTsNCg0KfShqUXVlcnkpKTsNCg0KDQoNCg0KDQoNCg0KDQo=]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae45aaab1" Name="vdom_xml_dialog_close_icon" Type="gif"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAABUAAAApCAYAAADar2JAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KAtiABQAAALRJREFUSA3tldEJgDAMRK0zdbiO0OG6k3LIwRligv4J6UebS5MXvA+7bbXKgUcH5pyHXlqtd4wbA+9UwBijWe31IBdCUaAgaCwMuCJ/Dy/ZouAMiJ4UqkAOycA7C71TgQrSvNeX5izA6hRQBeVAOVAO/M+Btdbt4bPa+6Lwz6+A3nuz2gMiF0JRoCBoLAy4In8PL9mi4AyInhSqQA7JwOHDp0AFaZ6DXp0WYPUrWBWXA98cOAFDDU3vRnEfbgAAAABJRU5ErkJggg==]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae45bbbb1" Name="vdom_xml_dialog_resize_icon" Type="gif"><![CDATA[R0lGODlhDgANAJEDAJGRkZKSkv///9jm7yH5BAEAAAMALAAAAAAOAA0AAAIfnI8mkS3Q0opoUsVUtIMf7mFfVpGPY5qiAolg2sFrAQA7]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae46cccc1" Name="vdom_xml_dialog_icons" Type="png"><![CDATA[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]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae45dddd1" Name="vdom_xml_dialog_resize_header" Type="gif"><![CDATA[R0lGODlhAQAeAJEAAO3t7evr6/Ly8gAAACH5BAAAAAAALAAAAAABAB4AAAIHlI8Jwe1eAAA7]]></Resource>
    <Resource ID="9f1c05cd-fee2-6055-2ef4-16fae32bafe5" Name="vdom_xml_dialog_tinyeditor" Type="js"><![CDATA[VElOWT17fTsNCg0KZnVuY3Rpb24gVCQoaSl7cmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGkpfQ0KZnVuY3Rpb24gVCQkJCgpe3JldHVybiBkb2N1bWVudC5hbGw/MTowfQ0KDQpUSU5ZLmVkaXRvcj1mdW5jdGlvbigpew0KCXZhciBjPVtdLCBvZmZzZXQ9LTMwOw0KCWNbJ2N1dCddPVsxLCdDdXQnLCdhJywnY3V0JywxXTsNCgljWydjb3B5J109WzIsJ0NvcHknLCdhJywnY29weScsMV07DQoJY1sncGFzdGUnXT1bMywnUGFzdGUnLCdhJywncGFzdGUnLDFdOw0KCWNbJ2JvbGQnXT1bNCwnQm9sZCcsJ2EnLCdib2xkJ107DQoJY1snaXRhbGljJ109WzUsJ0l0YWxpYycsJ2EnLCdpdGFsaWMnXTsNCgljWyd1bmRlcmxpbmUnXT1bNiwnVW5kZXJsaW5lJywnYScsJ3VuZGVybGluZSddOw0KCWNbJ3N0cmlrZXRocm91Z2gnXT1bNywnU3RyaWtldGhyb3VnaCcsJ2EnLCdzdHJpa2V0aHJvdWdoJ107DQoJY1snc3Vic2NyaXB0J109WzgsJ1N1YnNjcmlwdCcsJ2EnLCdzdWJzY3JpcHQnXTsNCgljWydzdXBlcnNjcmlwdCddPVs5LCdTdXBlcnNjcmlwdCcsJ2EnLCdzdXBlcnNjcmlwdCddOw0KCWNbJ29yZGVyZWRsaXN0J109WzEwLCdJbnNlcnQgT3JkZXJlZCBMaXN0JywnYScsJ2luc2VydG9yZGVyZWRsaXN0J107DQoJY1sndW5vcmRlcmVkbGlzdCddPVsxMSwnSW5zZXJ0IFVub3JkZXJlZCBMaXN0JywnYScsJ2luc2VydHVub3JkZXJlZGxpc3QnXTsNCgljWydvdXRkZW50J109WzEyLCdPdXRkZW50JywnYScsJ291dGRlbnQnXTsNCgljWydpbmRlbnQnXT1bMTMsJ0luZGVudCcsJ2EnLCdpbmRlbnQnXTsNCgljWydsZWZ0YWxpZ24nXT1bMTQsJ0xlZnQgQWxpZ24nLCdhJywnanVzdGlmeWxlZnQnXTsNCgljWydjZW50ZXJhbGlnbiddPVsxNSwnQ2VudGVyIEFsaWduJywnYScsJ2p1c3RpZnljZW50ZXInXTsNCgljWydyaWdodGFsaWduJ109WzE2LCdSaWdodCBBbGlnbicsJ2EnLCdqdXN0aWZ5cmlnaHQnXTsNCgljWydibG9ja2p1c3RpZnknXT1bMTcsJ0Jsb2NrIEp1c3RpZnknLCdhJywnanVzdGlmeWZ1bGwnXTsNCgljWyd1bmRvJ109WzE4LCdVbmRvJywnYScsJ3VuZG8nXTsNCgljWydyZWRvJ109WzE5LCdSZWRvJywnYScsJ3JlZG8nXTsNCgljWydpbWFnZSddPVsyMCwnSW5zZXJ0IEltYWdlJywnaScsJ2luc2VydGltYWdlJywnRW50ZXIgSW1hZ2UgVVJMOicsJ2h0dHA6Ly8nXTsNCgljWydociddPVsyMSwnSW5zZXJ0IEhvcml6b250YWwgUnVsZScsJ2EnLCdpbnNlcnRob3Jpem9udGFscnVsZSddOw0KCWNbJ2xpbmsnXT1bMjIsJ0luc2VydCBIeXBlcmxpbmsnLCdpJywnY3JlYXRlbGluaycsJ0VudGVyIFVSTDonLCdodHRwOi8vJ107DQoJY1sndW5saW5rJ109WzIzLCdSZW1vdmUgSHlwZXJsaW5rJywnYScsJ3VubGluayddOw0KCWNbJ3VuZm9ybWF0J109WzI0LCdSZW1vdmUgRm9ybWF0dGluZycsJ2EnLCdyZW1vdmVmb3JtYXQnXTsNCgljWydwcmludCddPVsyNSwnUHJpbnQnLCdhJywncHJpbnQnXTsNCglmdW5jdGlvbiBlZGl0KG4sb2JqKXsNCgkJdGhpcy5uPW47d2luZG93W25dPXRoaXM7IHRoaXMudD1UJChvYmouaWQpOyB0aGlzLm9iaj1vYmo7IHRoaXMueGh0bWw9b2JqLnhodG1sOw0KCQl2YXIgcD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwgdz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwgaD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwNCgkJbD1vYmouY29udHJvbHMubGVuZ3RoLCBpPTA7DQoJCXRoaXMuaT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsgdGhpcy5pLmZyYW1lQm9yZGVyPTA7DQoJCXRoaXMuaS53aWR0aD0iMTAwJSI7IHRoaXMuaS5oZWlnaHQ9b2JqLmhlaWdodHx8JzI1MCc7IHRoaXMuaWU9VCQkJCgpOw0KCQloLmNsYXNzTmFtZT1vYmoucm93Y2xhc3N8fCd0ZWhlYWRlcic7IHAuY2xhc3NOYW1lPW9iai5jc3NjbGFzc3x8J3RlJzsgcC5zdHlsZS53aWR0aD0nMTAwJSc7IHAuYXBwZW5kQ2hpbGQoaCk7DQoJCWZvcihpO2k8bDtpKyspew0KCQkJdmFyIGlkPW9iai5jb250cm9sc1tpXTsNCgkJCWlmKGlkPT0nbicpew0KCQkJCWg9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGguY2xhc3NOYW1lPW9iai5yb3djbGFzc3x8J3RlaGVhZGVyJzsgcC5hcHBlbmRDaGlsZChoKQ0KCQkJfWVsc2UgaWYoaWQ9PSd8Jyl7DQoJCQkJdmFyIGQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGQuY2xhc3NOYW1lPW9iai5kaXZpZGVyY2xhc3N8fCd0ZWRpdmlkZXInOyBoLmFwcGVuZENoaWxkKGQpDQoJCQl9ZWxzZSBpZihpZD09J2ZvbnQnKXsNCgkJCQl2YXIgc2VsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpLCBmb250cz1vYmouZm9udHN8fFsnVmVyZGFuYScsJ0FyaWFsJywnR2VvcmdpYSddLCBmbD1mb250cy5sZW5ndGgsIHg9MDsNCgkJCQlzZWwuY2xhc3NOYW1lPSd0ZWZvbnQnOyBzZWwub25jaGFuZ2U9bmV3IEZ1bmN0aW9uKHRoaXMubisnLmRkYWN0aW9uKHRoaXMsImZvbnRuYW1lIiknKTsNCgkJCQlzZWwub3B0aW9uc1swXT1uZXcgT3B0aW9uKCdGb250JywnJyk7DQoJCQkJZm9yKHg7eDxmbDt4Kyspew0KCQkJCQl2YXIgZm9udD1mb250c1t4XTsNCgkJCQkJc2VsLm9wdGlvbnNbeCsxXT1uZXcgT3B0aW9uKGZvbnQsZm9udCkNCgkJCQl9DQoJCQkJaC5hcHBlbmRDaGlsZChzZWwpDQoJCQl9ZWxzZSBpZihpZD09J3NpemUnKXsNCgkJCQl2YXIgc2VsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpLCBzaXplcz1vYmouc2l6ZXN8fFsxLDIsMyw0LDUsNiw3XSwgc2w9c2l6ZXMubGVuZ3RoLCB4PTA7DQoJCQkJc2VsLmNsYXNzTmFtZT0ndGVzaXplJzsgc2VsLm9uY2hhbmdlPW5ldyBGdW5jdGlvbih0aGlzLm4rJy5kZGFjdGlvbih0aGlzLCJmb250c2l6ZSIpJyk7DQoJCQkJZm9yKHg7eDxzbDt4Kyspew0KCQkJCQl2YXIgc2l6ZT1zaXplc1t4XTsNCgkJCQkJc2VsLm9wdGlvbnNbeF09bmV3IE9wdGlvbihzaXplLHNpemUpDQoJCQkJfQ0KCQkJCWguYXBwZW5kQ2hpbGQoc2VsKQ0KCQkJfWVsc2UgaWYoaWQ9PSdzdHlsZScpew0KCQkJCXZhciBzZWw9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0JyksDQoJCQkJc3R5bGVzPW9iai5zdHlsZXN8fFtbJ1N0eWxlJywnJ10sWydQYXJhZ3JhcGgnLCc8cD4nXSxbJ0hlYWRlciAxJywnPGgxPiddLFsnSGVhZGVyIDInLCc8aDI+J10sWydIZWFkZXIgMycsJzxoMz4nXSxbJ0hlYWRlciA0JywnPGg0PiddLFsnSGVhZGVyIDUnLCc8aDU+J10sWydIZWFkZXIgNicsJzxoNj4nXV0sDQoJCQkJc2w9c3R5bGVzLmxlbmd0aCwgeD0wOw0KCQkJCXNlbC5jbGFzc05hbWU9J3Rlc3R5bGUnOyBzZWwub25jaGFuZ2U9bmV3IEZ1bmN0aW9uKHRoaXMubisnLmRkYWN0aW9uKHRoaXMsImZvcm1hdGJsb2NrIiknKTsNCgkJCQlmb3IoeDt4PHNsO3grKyl7DQoJCQkJCXZhciBzdHlsZT1zdHlsZXNbeF07DQoJCQkJCXNlbC5vcHRpb25zW3hdPW5ldyBPcHRpb24oc3R5bGVbMF0sc3R5bGVbMV0pDQoJCQkJfQ0KCQkJCWguYXBwZW5kQ2hpbGQoc2VsKQ0KCQkJfWVsc2UgaWYoY1tpZF0pew0KCQkJCXZhciBkaXY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksIHg9Y1tpZF0sIGZ1bmM9eFsyXSwgZXgsIHBvcz14WzBdKm9mZnNldDsNCgkJCQlkaXYuY2xhc3NOYW1lPW9iai5jb250cm9sY2xhc3M7DQoJCQkJZGl2LnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbj0nMHB4ICcrcG9zKydweCc7DQoJCQkJZGl2LnRpdGxlPXhbMV07DQoJCQkJZXg9ZnVuYz09J2EnPycuYWN0aW9uKCInK3hbM10rJyIsMCwnKyh4WzRdfHwwKSsnKSc6Jy5pbnNlcnQoIicreFs0XSsnIiwiJyt4WzVdKyciLCInK3hbM10rJyIpJzsNCgkJCQlkaXYub25jbGljaz1uZXcgRnVuY3Rpb24odGhpcy5uKyhpZD09J3ByaW50Jz8nLnByaW50KCknOmV4KSk7DQoJCQkJZGl2Lm9ubW91c2VvdmVyPW5ldyBGdW5jdGlvbih0aGlzLm4rJy5ob3Zlcih0aGlzLCcrcG9zKycsMSknKTsNCgkJCQlkaXYub25tb3VzZW91dD1uZXcgRnVuY3Rpb24odGhpcy5uKycuaG92ZXIodGhpcywnK3BvcysnLDApJyk7DQoJCQkJaC5hcHBlbmRDaGlsZChkaXYpOw0KCQkJCWlmKHRoaXMuaWUpe2Rpdi51bnNlbGVjdGFibGU9J29uJ30NCgkJCX0NCgkJfQ0KCQl0aGlzLnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocCx0aGlzLnQpOyAvL3RoaXMudC5zdHlsZS53aWR0aD10aGlzLmkud2lkdGgrJ3B4JzsNCgkJdy5hcHBlbmRDaGlsZCh0aGlzLnQpOyB3LmFwcGVuZENoaWxkKHRoaXMuaSk7IHAuYXBwZW5kQ2hpbGQodyk7IHRoaXMudC5zdHlsZS5kaXNwbGF5PSdub25lJzsNCgkJaWYob2JqLmZvb3Rlcil7DQoJCQl2YXIgZj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsgZi5jbGFzc05hbWU9b2JqLmZvb3RlcmNsYXNzfHwndGVmb290ZXInOw0KCQkJaWYob2JqLnRvZ2dsZSl7DQoJCQkJdmFyIHRvPW9iai50b2dnbGUsIHRzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCQkJCXRzLmNsYXNzTmFtZT10by5jc3NjbGFzc3x8J3RvZ2dsZSc7IHRzLmlubmVySFRNTD10by50ZXh0fHwnc291cmNlJzsNCgkJCQl0cy5vbmNsaWNrPW5ldyBGdW5jdGlvbih0aGlzLm4rJy50b2dnbGUoMCx0aGlzKTtyZXR1cm4gZmFsc2UnKTsNCgkJCQlmLmFwcGVuZENoaWxkKHRzKQ0KCQkJfQ0KCQkJaWYob2JqLnJlc2l6ZSl7DQoJCQkJdmFyIHJvPW9iai5yZXNpemUsIHJzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyBycy5jbGFzc05hbWU9cm8uY3NzY2xhc3N8fCdyZXNpemUnOw0KCQkJCXJzLm9ubW91c2Vkb3duPW5ldyBGdW5jdGlvbignZXZlbnQnLHRoaXMubisnLnJlc2l6ZShldmVudCk7cmV0dXJuIGZhbHNlJyk7DQoJCQkJcnMub25zZWxlY3RzdGFydD1mdW5jdGlvbigpe3JldHVybiBmYWxzZX07DQoJCQkJZi5hcHBlbmRDaGlsZChycykNCgkJCX0NCgkJCXAuYXBwZW5kQ2hpbGQoZikNCgkJfQ0KCQl0aGlzLmU9dGhpcy5pLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7IHRoaXMuZS5vcGVuKCk7DQoJCXZhciBtPSc8aHRtbD48aGVhZD4nLCBib2R5aWQ9b2JqLmJvZHlpZD8iIGlkPVwiIitvYmouYm9keWlkKyJcIiI6IiI7DQoJCWlmKG9iai5jc3NmaWxlKXttKz0nPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSInK29iai5jc3NmaWxlKyciIC8+J30NCgkJaWYob2JqLmNzcyl7bSs9JzxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+JytvYmouY3NzKyc8L3N0eWxlPid9DQoJCW0rPSc8L2hlYWQ+PGJvZHknK2JvZHlpZCsnPicrKG9iai5jb250ZW50fHx0aGlzLnQudmFsdWUpOw0KCQltKz0nPC9ib2R5PjwvaHRtbD4nOw0KCQl0aGlzLmUud3JpdGUobSk7DQoJCXRoaXMuZS5jbG9zZSgpOyB0aGlzLmUuZGVzaWduTW9kZT0nb24nOyB0aGlzLmQ9MTsNCgkJaWYodGhpcy54aHRtbCl7DQoJCQl0cnl7dGhpcy5lLmV4ZWNDb21tYW5kKCJzdHlsZVdpdGhDU1MiLDAsMCl9DQoJCQljYXRjaChlKXt0cnl7dGhpcy5lLmV4ZWNDb21tYW5kKCJ1c2VDU1MiLDAsMSl9Y2F0Y2goZSl7fX0NCgkJfQ0KCX07DQoJZWRpdC5wcm90b3R5cGUucHJpbnQ9ZnVuY3Rpb24oKXsNCgkJdGhpcy5pLmNvbnRlbnRXaW5kb3cucHJpbnQoKQ0KCX0sDQoJZWRpdC5wcm90b3R5cGUuaG92ZXI9ZnVuY3Rpb24oZGl2LHBvcyxkaXIpew0KCQlkaXYuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uPShkaXI/JzM0cHggJzonMHB4ICcpKyhwb3MpKydweCcNCgl9LA0KCWVkaXQucHJvdG90eXBlLmRkYWN0aW9uPWZ1bmN0aW9uKGRkLGEpew0KCQl2YXIgaT1kZC5zZWxlY3RlZEluZGV4LCB2PWRkLm9wdGlvbnNbaV0udmFsdWU7DQoJCXRoaXMuYWN0aW9uKGEsdikNCgl9LA0KCWVkaXQucHJvdG90eXBlLmFjdGlvbj1mdW5jdGlvbihjbWQsdmFsLGllKXsNCgkJaWYoaWUmJiF0aGlzLmllKXsNCgkJCWFsZXJ0KCdZb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIGZ1bmN0aW9uLicpDQoJCX1lbHNlew0KCQkJdGhpcy5lLmV4ZWNDb21tYW5kKGNtZCwwLHZhbHx8bnVsbCkNCgkJfQ0KCX0sDQoJZWRpdC5wcm90b3R5cGUuaW5zZXJ0PWZ1bmN0aW9uKHBybyxtc2csY21kKXsNCgkJdmFyIHZhbD1wcm9tcHQocHJvLG1zZyk7DQoJCWlmKHZhbCE9bnVsbCYmdmFsIT0nJyl7dGhpcy5lLmV4ZWNDb21tYW5kKGNtZCwwLHZhbCl9DQoJfSwNCgllZGl0LnByb3RvdHlwZS5zZXRmb250PWZ1bmN0aW9uKCl7DQoJCWV4ZWNDb21tYW5kKCdmb3JtYXRibG9jaycsMCxoVHlwZSkNCgl9LA0KCWVkaXQucHJvdG90eXBlLnJlc2l6ZT1mdW5jdGlvbihlKXsNCgkJaWYodGhpcy5tdil7dGhpcy5mcmVlemUoKX0NCgkJdGhpcy5pLmJjcz1USU5ZLmN1cnNvci50b3AoZSk7DQoJCXRoaXMubXY9bmV3IEZ1bmN0aW9uKCdldmVudCcsdGhpcy5uKycubW92ZShldmVudCknKTsNCgkJdGhpcy5zcj1uZXcgRnVuY3Rpb24odGhpcy5uKycuZnJlZXplKCknKTsNCgkJaWYodGhpcy5pZSl7DQoJCQlkb2N1bWVudC5hdHRhY2hFdmVudCgnb25tb3VzZW1vdmUnLHRoaXMubXYpOyBkb2N1bWVudC5hdHRhY2hFdmVudCgnb25tb3VzZXVwJyx0aGlzLnNyKQ0KCQl9ZWxzZXsNCgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsdGhpcy5tdiwxKTsgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsdGhpcy5zciwxKQ0KCQl9DQoJfSwNCgllZGl0LnByb3RvdHlwZS5tb3ZlPWZ1bmN0aW9uKGUpew0KCQl2YXIgcG9zPVRJTlkuY3Vyc29yLnRvcChlKTsNCgkJdGhpcy5pLmhlaWdodD1wYXJzZUludCh0aGlzLmkuaGVpZ2h0KStwb3MtdGhpcy5pLmJjczsNCgkJdGhpcy5pLmJjcz1wb3MNCgl9LA0KCWVkaXQucHJvdG90eXBlLmZyZWV6ZT1mdW5jdGlvbigpew0KCQlpZih0aGlzLmllKXsNCgkJCWRvY3VtZW50LmRldGFjaEV2ZW50KCdvbm1vdXNlbW92ZScsdGhpcy5tdik7IGRvY3VtZW50LmRldGFjaEV2ZW50KCdvbm1vdXNldXAnLHRoaXMuc3IpDQoJCX1lbHNlew0KCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJyx0aGlzLm12LDEpOyBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJyx0aGlzLnNyLDEpDQoJCX0NCgl9LA0KCWVkaXQucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbihwb3N0LGRpdil7DQoJCWlmKCF0aGlzLmQpew0KCQkJdmFyIHY9dGhpcy50LnZhbHVlOw0KCQkJaWYoZGl2KXtkaXYuaW5uZXJIVE1MPXRoaXMub2JqLnRvZ2dsZS50ZXh0fHwnc291cmNlJ30NCgkJCWlmKHRoaXMueGh0bWwmJiF0aGlzLmllKXsNCgkJCQl2PXYucmVwbGFjZSgvPHN0cm9uZz4oLiopPFwvc3Ryb25nPi9naSwnPHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OiBib2xkOyI+JDE8L3NwYW4+Jyk7DQoJCQkJdj12LnJlcGxhY2UoLzxlbT4oLiopPFwvZW0+L2dpLCc8c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6IGl0YWxpYzsiPiQxPC9zcGFuPicpDQoJCQl9DQoJCQl0aGlzLmUuYm9keS5pbm5lckhUTUw9djsNCgkJCXRoaXMudC5zdHlsZS5kaXNwbGF5PSdub25lJzsgdGhpcy5pLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsgdGhpcy5kPTENCgkJfWVsc2V7DQoJCQl2YXIgdj10aGlzLmUuYm9keS5pbm5lckhUTUw7DQoJCQlpZih0aGlzLnhodG1sKXsNCgkJCQl2PXYucmVwbGFjZSgvPHNwYW4gY2xhc3M9ImFwcGxlLXN0eWxlLXNwYW4iPiguKik8XC9zcGFuPi9naSwnJDEnKTsNCgkJCQl2PXYucmVwbGFjZSgvIGNsYXNzPSJhcHBsZS1zdHlsZS1zcGFuIi9naSwnJyk7DQoJCQkJdj12LnJlcGxhY2UoLzxzcGFuIHN0eWxlPSIiPi9naSwnJyk7DQoJCQkJdj12LnJlcGxhY2UoLzxicj4vZ2ksJzxiciAvPicpOw0KCQkJCXY9di5yZXBsYWNlKC88YnIgP1wvPz4kL2dpLCcnKTsNCgkJCQl2PXYucmVwbGFjZSgvXjxiciA/XC8/Pi9naSwnJyk7DQoJCQkJdj12LnJlcGxhY2UoLyg8aW1nIFtePl0rW15cL10pPi9naSwnJDEgLz4nKTsNCgkJCQl2PXYucmVwbGFjZSgvPGJcYltePl0qPiguKj8pPFwvYltePl0qPi9naSwnPHN0cm9uZz4kMTwvc3Ryb25nPicpOw0KCQkJCXY9di5yZXBsYWNlKC88aVxiW14+XSo+KC4qPyk8XC9pW14+XSo+L2dpLCc8ZW0+JDE8L2VtPicpOw0KCQkJCXY9di5yZXBsYWNlKC88dVxiW14+XSo+KC4qPyk8XC91W14+XSo+L2dpLCc8c3BhbiBzdHlsZT0idGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZSI+JDE8L3NwYW4+Jyk7DQoJCQkJdj12LnJlcGxhY2UoLzwoYnxzdHJvbmd8ZW18aXx1KSBzdHlsZT0iZm9udC13ZWlnaHQ6IG5vcm1hbDs/Ij4oLiopPFwvKGJ8c3Ryb25nfGVtfGl8dSk+L2dpLCckMicpOw0KCQkJCXY9di5yZXBsYWNlKC88KGJ8c3Ryb25nfGVtfGl8dSkgc3R5bGU9IiguKikiPiguKik8XC8oYnxzdHJvbmd8ZW18aXx1KT4vZ2ksJzxzcGFuIHN0eWxlPSIkMiI+PCQ0PiQzPC8kND48L3NwYW4+Jyk7DQoJCQkJdj12LnJlcGxhY2UoLzxzcGFuIHN0eWxlPSJmb250LXdlaWdodDogbm9ybWFsOz8iPiguKik8XC9zcGFuPi9naSwnJDEnKTsNCgkJCQl2PXYucmVwbGFjZSgvPHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OiBib2xkOz8iPiguKik8XC9zcGFuPi9naSwnPHN0cm9uZz4kMTwvc3Ryb25nPicpOw0KCQkJCXY9di5yZXBsYWNlKC88c3BhbiBzdHlsZT0iZm9udC1zdHlsZTogaXRhbGljOz8iPiguKik8XC9zcGFuPi9naSwnPGVtPiQxPC9lbT4nKTsNCgkJCQl2PXYucmVwbGFjZSgvPHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OiBib2xkOz8iPiguKik8XC9zcGFuPnw8YlxiW14+XSo+KC4qPyk8XC9iW14+XSo+L2dpLCc8c3Ryb25nPiQxPC9zdHJvbmc+JykNCgkJCX0NCgkJCWlmKGRpdil7ZGl2LmlubmVySFRNTD10aGlzLm9iai50b2dnbGUuYWN0aXZldGV4dHx8J3d5c2l3eWcnfQ0KCQkJdGhpcy50LnZhbHVlPXY7DQoJCQlpZighcG9zdCl7DQoJCQkJdGhpcy50LnN0eWxlLmhlaWdodD10aGlzLmkuaGVpZ2h0KydweCc7DQoJCQkJdGhpcy5pLnN0eWxlLmRpc3BsYXk9J25vbmUnOyB0aGlzLnQuc3R5bGUuZGlzcGxheT0nYmxvY2snOyB0aGlzLmQ9MA0KCQkJfQ0KCQl9DQoJfSwNCgllZGl0LnByb3RvdHlwZS5wb3N0PWZ1bmN0aW9uKCl7DQoJCWlmKHRoaXMuZCl7dGhpcy50b2dnbGUoMSl9DQoJfTsNCglyZXR1cm57ZWRpdDplZGl0fQ0KfSgpOw0KDQpUSU5ZLmN1cnNvcj1mdW5jdGlvbigpew0KCXJldHVybnsNCgkJdG9wOmZ1bmN0aW9uKGUpew0KCQkJcmV0dXJuIFQkJCQoKT93aW5kb3cuZXZlbnQuY2xpZW50WStkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wK2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOmUuY2xpZW50WSt3aW5kb3cuc2Nyb2xsWQ0KCQl9DQoJfQ0KfSgpOw0K]]></Resource>
    <Resource ID="b4993ec8-6d66-8240-22a7-48fbbedfe371" Name="jquery.fileupload-n-plugins.js" Type="js"><![CDATA[Ci8qCiAqIGpRdWVyeSBGaWxlIFVwbG9hZCBQbHVnaW4gNC41LjEKICogaHR0cHM6Ly9naXRodWIuY29tL2JsdWVpbXAvalF1ZXJ5LUZpbGUtVXBsb2FkCiAqCiAqIENvcHlyaWdodCAyMDEwLCBTZWJhc3RpYW4gVHNjaGFuCiAqIGh0dHBzOi8vYmx1ZWltcC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlOgogKiBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9NSVQvCiAqLwoKLypqc2xpbnQgYnJvd3NlcjogdHJ1ZSwgdW5wYXJhbTogdHJ1ZSAqLwovKmdsb2JhbCBYTUxIdHRwUmVxdWVzdFVwbG9hZCwgRmlsZSwgRmlsZVJlYWRlciwgRm9ybURhdGEsIFByb2dyZXNzRXZlbnQsIHVuZXNjYXBlLCBqUXVlcnksIHVwbG9hZCAqLwoKKGZ1bmN0aW9uICgkKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgdmFyIGRlZmF1bHROYW1lc3BhY2UgPSAnZmlsZV91cGxvYWQnLAogICAgICAgIHVuZGVmID0gJ3VuZGVmaW5lZCcsCiAgICAgICAgZnVuYyA9ICdmdW5jdGlvbicsCiAgICAgICAgRmlsZVVwbG9hZCwKICAgICAgICBtZXRob2RzLAoKICAgICAgICBNdWx0aUxvYWRlciA9IGZ1bmN0aW9uIChjYWxsQmFjaywgbnVtT3JMaXN0KSB7CiAgICAgICAgICAgIHZhciBsb2FkZWQgPSAwLAogICAgICAgICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgICAgICBpZiAobnVtT3JMaXN0KSB7CiAgICAgICAgICAgICAgICBpZiAobnVtT3JMaXN0Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBudW1Pckxpc3Q7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxpc3RbbnVtT3JMaXN0IC0gMV0gPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBsb2FkZWQgKz0gMTsKICAgICAgICAgICAgICAgIGlmIChsb2FkZWQgPT09IGxpc3QubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2sobGlzdCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gMDsKICAgICAgICAgICAgICAgICAgICBsaXN0ID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMucHVzaCA9IGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICBsaXN0LnB1c2goaXRlbSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuZ2V0TGlzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0OwogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgU2VxdWVuY2VIYW5kbGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VxdWVuY2UgPSBbXTsKICAgICAgICAgICAgdGhpcy5wdXNoID0gZnVuY3Rpb24gKGNhbGxCYWNrKSB7CiAgICAgICAgICAgICAgICBzZXF1ZW5jZS5wdXNoKGNhbGxCYWNrKTsKICAgICAgICAgICAgICAgIGlmIChzZXF1ZW5jZS5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBjYWxsQmFjaygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZXF1ZW5jZS5zaGlmdCgpOwogICAgICAgICAgICAgICAgaWYgKHNlcXVlbmNlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlWzBdKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICAKICAgIEZpbGVVcGxvYWQgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7CiAgICAgICAgdmFyIGZpbGVVcGxvYWQgPSB0aGlzLAogICAgICAgICAgICB1cGxvYWRGb3JtLAogICAgICAgICAgICBmaWxlSW5wdXQsCiAgICAgICAgICAgIHNldHRpbmdzID0gewogICAgICAgICAgICAgICAgbmFtZXNwYWNlOiBkZWZhdWx0TmFtZXNwYWNlLAogICAgICAgICAgICAgICAgdXBsb2FkRm9ybUZpbHRlcjogZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZmlsZUlucHV0RmlsdGVyOiBmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjc3NDbGFzczogZGVmYXVsdE5hbWVzcGFjZSwKICAgICAgICAgICAgICAgIGRyYWdEcm9wU3VwcG9ydDogdHJ1ZSwKICAgICAgICAgICAgICAgIGRyb3Bab25lOiBjb250YWluZXIsCiAgICAgICAgICAgICAgICB1cmw6IGZ1bmN0aW9uIChmb3JtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm0uYXR0cignYWN0aW9uJyk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWV0aG9kOiBmdW5jdGlvbiAoZm9ybSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JtLmF0dHIoJ21ldGhvZCcpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0LmF0dHIoJ25hbWUnKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmb3JtRGF0YTogZnVuY3Rpb24gKGZvcm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzOiBudWxsLAogICAgICAgICAgICAgICAgbXVsdGlwYXJ0OiB0cnVlLAogICAgICAgICAgICAgICAgbXVsdGlGaWxlUmVxdWVzdDogZmFsc2UsCiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLAogICAgICAgICAgICAgICAgZm9yY2VJZnJhbWVVcGxvYWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgc2VxdWVudGlhbFVwbG9hZHM6IGZhbHNlLAogICAgICAgICAgICAgICAgbWF4Q2h1bmtTaXplOiBudWxsLAogICAgICAgICAgICAgICAgbWF4RmlsZVJlYWRlclNpemU6IDUwMDAwMDAwLAogICAgICAgICAgICAgICAgcmVwbGFjZUZpbGVJbnB1dDogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBkb2N1bWVudExpc3RlbmVycyA9IHt9LAogICAgICAgICAgICBkcm9wWm9uZUxpc3RlbmVycyA9IHt9LAogICAgICAgICAgICBwcm90b2NvbFJlZ0V4cCA9IC9eaHR0cChzKT86XC9cLy8sCiAgICAgICAgICAgIG9wdGlvbnNSZWZlcmVuY2UsCiAgICAgICAgICAgIG11bHRpTG9hZGVyID0gbmV3IE11bHRpTG9hZGVyKGZ1bmN0aW9uIChsaXN0KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uTG9hZEFsbCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uTG9hZEFsbChsaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHNlcXVlbmNlSGFuZGxlciA9IG5ldyBTZXF1ZW5jZUhhbmRsZXIoKSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbXBsZXRlTmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIG11bHRpTG9hZGVyLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICBzZXF1ZW5jZUhhbmRsZXIubmV4dCgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaXNYSFJVcGxvYWRDYXBhYmxlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBYTUxIdHRwUmVxdWVzdCAhPT0gdW5kZWYgJiYgdHlwZW9mIFhNTEh0dHBSZXF1ZXN0VXBsb2FkICE9PSB1bmRlZiAmJgogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBGaWxlICE9PSB1bmRlZiAmJiAoIXNldHRpbmdzLm11bHRpcGFydCB8fCB0eXBlb2YgRm9ybURhdGEgIT09IHVuZGVmIHx8CiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiBGaWxlUmVhZGVyICE9PSB1bmRlZiAmJiB0eXBlb2YgWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLnNlbmRBc0JpbmFyeSA9PT0gZnVuYykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdEV2ZW50SGFuZGxlcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuZHJhZ0Ryb3BTdXBwb3J0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkRvY3VtZW50RHJhZ0VudGVyID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50TGlzdGVuZXJzWydkcmFnZW50ZXIuJyArIHNldHRpbmdzLm5hbWVzcGFjZV0gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25Eb2N1bWVudERyYWdFbnRlcihlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkRvY3VtZW50RHJhZ0xlYXZlID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50TGlzdGVuZXJzWydkcmFnbGVhdmUuJyArIHNldHRpbmdzLm5hbWVzcGFjZV0gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25Eb2N1bWVudERyYWdMZWF2ZShlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRMaXN0ZW5lcnNbJ2RyYWdvdmVyLicgICArIHNldHRpbmdzLm5hbWVzcGFjZV0gPSBmaWxlVXBsb2FkLm9uRG9jdW1lbnREcmFnT3ZlcjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudExpc3RlbmVyc1snZHJvcC4nICAgICAgICsgc2V0dGluZ3MubmFtZXNwYWNlXSA9IGZpbGVVcGxvYWQub25Eb2N1bWVudERyb3A7CiAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkuYmluZChkb2N1bWVudExpc3RlbmVycyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkRyYWdFbnRlciA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICBkcm9wWm9uZUxpc3RlbmVyc1snZHJhZ2VudGVyLicgKyBzZXR0aW5ncy5uYW1lc3BhY2VdID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uRHJhZ0VudGVyKGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uRHJhZ0xlYXZlID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bab25lTGlzdGVuZXJzWydkcmFnbGVhdmUuJyArIHNldHRpbmdzLm5hbWVzcGFjZV0gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25EcmFnTGVhdmUoZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRyb3Bab25lTGlzdGVuZXJzWydkcmFnb3Zlci4nICAgKyBzZXR0aW5ncy5uYW1lc3BhY2VdID0gZmlsZVVwbG9hZC5vbkRyYWdPdmVyOwogICAgICAgICAgICAgICAgICAgIGRyb3Bab25lTGlzdGVuZXJzWydkcm9wLicgICAgICAgKyBzZXR0aW5ncy5uYW1lc3BhY2VdID0gZmlsZVVwbG9hZC5vbkRyb3A7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuZHJvcFpvbmUuYmluZChkcm9wWm9uZUxpc3RlbmVycyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaWxlSW5wdXQuYmluZCgnY2hhbmdlLicgKyBzZXR0aW5ncy5uYW1lc3BhY2UsIGZpbGVVcGxvYWQub25DaGFuZ2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVtb3ZlRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQuZWFjaChkb2N1bWVudExpc3RlbmVycywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS51bmJpbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQuZWFjaChkcm9wWm9uZUxpc3RlbmVycywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5kcm9wWm9uZS51bmJpbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZpbGVJbnB1dC51bmJpbmQoJ2NoYW5nZS4nICsgc2V0dGluZ3MubmFtZXNwYWNlKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGlzQ2h1bmtlZFVwbG9hZCA9IGZ1bmN0aW9uIChzZXR0aW5ncykgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBzZXR0aW5ncy51cGxvYWRlZEJ5dGVzICE9PSB1bmRlZjsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZVByb2dyZXNzRXZlbnQgPSBmdW5jdGlvbiAobGVuZ3RoQ29tcHV0YWJsZSwgbG9hZGVkLCB0b3RhbCkgewogICAgICAgICAgICAgICAgdmFyIGV2ZW50OwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFdmVudCA9PT0gZnVuYyAmJiB0eXBlb2YgUHJvZ3Jlc3NFdmVudCAhPT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgICAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdQcm9ncmVzc0V2ZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBldmVudC5pbml0UHJvZ3Jlc3NFdmVudCAhPT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuaW5pdFByb2dyZXNzRXZlbnQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZ3Jlc3MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aENvbXB1dGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoQ29tcHV0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogbG9hZGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRvdGFsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBldmVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoQ29tcHV0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBsb2FkZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQ7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRQcm9ncmVzc1RvdGFsID0gZnVuY3Rpb24gKGZpbGVzLCBpbmRleCwgc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgICAgICAgIHRvdGFsOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5wcm9ncmVzc1RvdGFsID09PSB1bmRlZikgewogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlc1tpbmRleF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBmaWxlc1tpbmRleF0uc2l6ZTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MucHJvZ3Jlc3NUb3RhbCA9IHRvdGFsID8gdG90YWwgOiAxOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSBmaWxlc1tpXS5zaXplOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnByb2dyZXNzVG90YWwgPSB0b3RhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MucHJvZ3Jlc3NUb3RhbDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGhhbmRsZUdsb2JhbFByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIHZhciBwcm9ncmVzc0V2ZW50LAogICAgICAgICAgICAgICAgICAgIGxvYWRlckxpc3QsCiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsTG9hZGVkID0gMCwKICAgICAgICAgICAgICAgICAgICBnbG9iYWxUb3RhbCA9IDA7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQubGVuZ3RoQ29tcHV0YWJsZSAmJiB0eXBlb2Ygc2V0dGluZ3Mub25Qcm9ncmVzc0FsbCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnByb2dyZXNzTG9hZGVkID0gcGFyc2VJbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsICogZ2V0UHJvZ3Jlc3NUb3RhbChmaWxlcywgaW5kZXgsIHNldHRpbmdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgMTAKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGxvYWRlckxpc3QgPSBtdWx0aUxvYWRlci5nZXRMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGxvYWRlckxpc3QsIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBpdGVtIGlzIGFuIGFycmF5IHdpdGggW2ZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5nc10KICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsTG9hZGVkICs9IGl0ZW1bM10ucHJvZ3Jlc3NMb2FkZWQgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsVG90YWwgKz0gZ2V0UHJvZ3Jlc3NUb3RhbChpdGVtWzBdLCBpdGVtWzFdLCBpdGVtWzNdKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0V2ZW50ID0gY3JlYXRlUHJvZ3Jlc3NFdmVudCgKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsTG9hZGVkLAogICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxUb3RhbAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25Qcm9ncmVzc0FsbChwcm9ncmVzc0V2ZW50LCBsb2FkZXJMaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGhhbmRsZUxvYWRFdmVudCA9IGZ1bmN0aW9uIChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIHNldHRpbmdzKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJvZ3Jlc3NFdmVudDsKICAgICAgICAgICAgICAgIGlmIChpc0NodW5rZWRVcGxvYWQoc2V0dGluZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MudXBsb2FkZWRCeXRlcyArPSBzZXR0aW5ncy5jaHVua1NpemU7CiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NFdmVudCA9IGNyZWF0ZVByb2dyZXNzRXZlbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnVwbG9hZGVkQnl0ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2luZGV4XS5zaXplCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uUHJvZ3Jlc3MgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25Qcm9ncmVzcyhwcm9ncmVzc0V2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVHbG9iYWxQcm9ncmVzcyhwcm9ncmVzc0V2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy51cGxvYWRlZEJ5dGVzIDwgZmlsZXNbaW5kZXhdLnNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5yZXN1bWVVcGxvYWQgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnJlc3VtZVVwbG9hZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIHNldHRpbmdzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2V0dGluZ3MucHJvZ3Jlc3NMb2FkZWQgPSBnZXRQcm9ncmVzc1RvdGFsKGZpbGVzLCBpbmRleCwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkxvYWQgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkxvYWQoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb21wbGV0ZU5leHQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGhhbmRsZVByb2dyZXNzRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncykgewogICAgICAgICAgICAgICAgdmFyIHByb2dyZXNzRXZlbnQgPSBldmVudDsKICAgICAgICAgICAgICAgIGlmIChpc0NodW5rZWRVcGxvYWQoc2V0dGluZ3MpICYmIGV2ZW50Lmxlbmd0aENvbXB1dGFibGUpIHsKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0V2ZW50ID0gY3JlYXRlUHJvZ3Jlc3NFdmVudCgKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MudXBsb2FkZWRCeXRlcyArIHBhcnNlSW50KGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsICogc2V0dGluZ3MuY2h1bmtTaXplLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2luZGV4XS5zaXplCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3Mub25Qcm9ncmVzcyA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uUHJvZ3Jlc3MocHJvZ3Jlc3NFdmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIHNldHRpbmdzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhbmRsZUdsb2JhbFByb2dyZXNzKHByb2dyZXNzRXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBpbml0VXBsb2FkRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uIChmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIGlmICh4aHIudXBsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlUHJvZ3Jlc3NFdmVudChlLCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVMb2FkRXZlbnQoZSwgZmlsZXMsIGluZGV4LCB4aHIsIHNldHRpbmdzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB4aHIub25hYm9ydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MucHJvZ3Jlc3NUb3RhbCA9IHNldHRpbmdzLnByb2dyZXNzTG9hZGVkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3Mub25BYm9ydCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkFib3J0KGUsIGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlTmV4dCgpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5wcm9ncmVzc1RvdGFsID0gc2V0dGluZ3MucHJvZ3Jlc3NMb2FkZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkVycm9yID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uRXJyb3IoZSwgZmlsZXMsIGluZGV4LCB4aHIsIHNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVOZXh0KCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0VXJsID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLnVybCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy51cmwoc2V0dGluZ3MudXBsb2FkRm9ybSB8fCB1cGxvYWRGb3JtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy51cmw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBnZXRNZXRob2QgPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3MubWV0aG9kID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLm1ldGhvZChzZXR0aW5ncy51cGxvYWRGb3JtIHx8IHVwbG9hZEZvcm0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLm1ldGhvZDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGdldEZpZWxkTmFtZSA9IGZ1bmN0aW9uIChzZXR0aW5ncykgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5maWVsZE5hbWUgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuZmllbGROYW1lKHNldHRpbmdzLmZpbGVJbnB1dCB8fCBmaWxlSW5wdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLmZpZWxkTmFtZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldEZvcm1EYXRhID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7CiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGE7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmZvcm1EYXRhID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLmZvcm1EYXRhKHNldHRpbmdzLnVwbG9hZEZvcm0gfHwgdXBsb2FkRm9ybSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCQuaXNBcnJheShzZXR0aW5ncy5mb3JtRGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuZm9ybURhdGE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLmZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEgPSBbXTsKICAgICAgICAgICAgICAgICAgICAkLmVhY2goc2V0dGluZ3MuZm9ybURhdGEsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5wdXNoKHtuYW1lOiBuYW1lLCB2YWx1ZTogdmFsdWV9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybURhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpc1NhbWVEb21haW4gPSBmdW5jdGlvbiAodXJsKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvdG9jb2xSZWdFeHAudGVzdCh1cmwpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhvc3QgPSBsb2NhdGlvbi5ob3N0LAogICAgICAgICAgICAgICAgICAgICAgICBpbmRleFN0YXJ0ID0gbG9jYXRpb24ucHJvdG9jb2wubGVuZ3RoICsgMiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSB1cmwuaW5kZXhPZihob3N0LCBpbmRleFN0YXJ0KSwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aEluZGV4ID0gaW5kZXggKyBob3N0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBpZiAoKGluZGV4ID09PSBpbmRleFN0YXJ0IHx8IGluZGV4ID09PSB1cmwuaW5kZXhPZignQCcsIGluZGV4U3RhcnQpICsgMSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1cmwubGVuZ3RoID09PSBwYXRoSW5kZXggfHwgJC5pbkFycmF5KHVybC5jaGFyQXQocGF0aEluZGV4KSwgWycvJywgJz8nLCAnIyddKSAhPT0gLTEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRVcGxvYWRSZXF1ZXN0ID0gZnVuY3Rpb24gKGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncykgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBmaWxlc1tpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgdXJsID0gZ2V0VXJsKHNldHRpbmdzKSwKICAgICAgICAgICAgICAgICAgICBzYW1lRG9tYWluID0gaXNTYW1lRG9tYWluKHVybCk7CiAgICAgICAgICAgICAgICB4aHIub3BlbihnZXRNZXRob2Qoc2V0dGluZ3MpLCB1cmwsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKHNhbWVEb21haW4pIHsKICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsICdYTUxIdHRwUmVxdWVzdCcpOwogICAgICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MubXVsdGlwYXJ0IHx8IGlzQ2h1bmtlZFVwbG9hZChzZXR0aW5ncykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtRmlsZS1OYW1lJywgZmlsZS5uYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtRmlsZS1UeXBlJywgZmlsZS50eXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtRmlsZS1TaXplJywgZmlsZS5zaXplKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0NodW5rZWRVcGxvYWQoc2V0dGluZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgZmlsZS50eXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghc2V0dGluZ3MubXVsdGlwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy53aXRoQ3JlZGVudGlhbHMpIHsKICAgICAgICAgICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkLmlzQXJyYXkoc2V0dGluZ3MucmVxdWVzdEhlYWRlcnMpKSB7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHNldHRpbmdzLnJlcXVlc3RIZWFkZXJzLCBmdW5jdGlvbiAoaW5kZXgsIGhlYWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXIubmFtZSwgaGVhZGVyLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MucmVxdWVzdEhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgICAkLmVhY2goc2V0dGluZ3MucmVxdWVzdEhlYWRlcnMsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmb3JtRGF0YVVwbG9hZCA9IGZ1bmN0aW9uIChmaWxlcywgeGhyLCBzZXR0aW5ncykgewogICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCksCiAgICAgICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgICAgICQuZWFjaChnZXRGb3JtRGF0YShzZXR0aW5ncyksIGZ1bmN0aW9uIChpbmRleCwgZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoZmllbGQubmFtZSwgZmllbGQudmFsdWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoZ2V0RmllbGROYW1lKHNldHRpbmdzKSwgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeGhyLnNlbmQoZm9ybURhdGEpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbG9hZEZpbGVDb250ZW50ID0gZnVuY3Rpb24gKGZpbGUsIGNhbGxCYWNrKSB7CiAgICAgICAgICAgICAgICBmaWxlLnJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgICAgICBmaWxlLnJlYWRlci5vbmxvYWQgPSBjYWxsQmFjazsKICAgICAgICAgICAgICAgIGZpbGUucmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHV0ZjhlbmNvZGUgPSBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYnVpbGRNdWx0aVBhcnRGb3JtRGF0YSA9IGZ1bmN0aW9uIChib3VuZGFyeSwgZmlsZXMsIGZpbGVzRmllbGROYW1lLCBmaWVsZHMpIHsKICAgICAgICAgICAgICAgIHZhciBkb3VibGVEYXNoID0gJy0tJywKICAgICAgICAgICAgICAgICAgICBjcmxmICAgICA9ICdcclxuJywKICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YSA9ICcnLAogICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IFtdOwogICAgICAgICAgICAgICAgJC5lYWNoKGZpZWxkcywgZnVuY3Rpb24gKGluZGV4LCBmaWVsZCkgewogICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhICs9IGRvdWJsZURhc2ggKyBib3VuZGFyeSArIGNybGYgKwogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSInICsKICAgICAgICAgICAgICAgICAgICAgICAgdXRmOGVuY29kZShmaWVsZC5uYW1lKSArCiAgICAgICAgICAgICAgICAgICAgICAgICciJyArIGNybGYgKyBjcmxmICsKICAgICAgICAgICAgICAgICAgICAgICAgdXRmOGVuY29kZShmaWVsZC52YWx1ZSkgKyBjcmxmOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkLmVhY2goZmlsZXMsIGZ1bmN0aW9uIChpbmRleCwgZmlsZSkgewogICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhICs9IGRvdWJsZURhc2ggKyBib3VuZGFyeSArIGNybGYgKwogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSInICsKICAgICAgICAgICAgICAgICAgICAgICAgdXRmOGVuY29kZShmaWxlc0ZpZWxkTmFtZSkgKwogICAgICAgICAgICAgICAgICAgICAgICAnIjsgZmlsZW5hbWU9IicgKyB1dGY4ZW5jb2RlKGZpbGUubmFtZSkgKyAnIicgKyBjcmxmICsKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZTogJyArIHV0ZjhlbmNvZGUoZmlsZS50eXBlKSArIGNybGYgKyBjcmxmOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGZvcm1EYXRhKTsKICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaChmaWxlLnJlYWRlci5yZXN1bHQpOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWxlLnJlYWRlcjsKICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YSA9IGNybGY7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZvcm1EYXRhICs9IGRvdWJsZURhc2ggKyBib3VuZGFyeSArIGRvdWJsZURhc2ggKyBjcmxmOwogICAgICAgICAgICAgICAgYnVmZmVyLnB1c2goZm9ybURhdGEpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZmZlci5qb2luKCcnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVSZWFkZXJVcGxvYWQgPSBmdW5jdGlvbiAoZmlsZXMsIHhociwgc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeSA9ICctLS0tTXVsdGlQYXJ0Rm9ybUJvdW5kYXJ5JyArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCksCiAgICAgICAgICAgICAgICAgICAgbG9hZGVyLAogICAgICAgICAgICAgICAgICAgIGk7CiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PScgKyBib3VuZGFyeSk7CiAgICAgICAgICAgICAgICBsb2FkZXIgPSBuZXcgTXVsdGlMb2FkZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHhoci5zZW5kQXNCaW5hcnkoYnVpbGRNdWx0aVBhcnRGb3JtRGF0YSgKICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRhcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzLAogICAgICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZE5hbWUoc2V0dGluZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBnZXRGb3JtRGF0YShzZXR0aW5ncykKICAgICAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgIH0sIGZpbGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBsb2FkRmlsZUNvbnRlbnQoZmlsZXNbaV0sIGxvYWRlci5jb21wbGV0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRCbG9iID0gZnVuY3Rpb24gKGZpbGUsIHNldHRpbmdzKSB7CiAgICAgICAgICAgICAgICB2YXIgYmxvYiwKICAgICAgICAgICAgICAgICAgICB1YiA9IHNldHRpbmdzLnVwbG9hZGVkQnl0ZXMsCiAgICAgICAgICAgICAgICAgICAgbWNzID0gc2V0dGluZ3MubWF4Q2h1bmtTaXplOwogICAgICAgICAgICAgICAgaWYgKGZpbGUgJiYgdHlwZW9mIGZpbGUuc2xpY2UgPT09IGZ1bmMgJiYgKHViIHx8IChtY3MgJiYgbWNzIDwgZmlsZS5zaXplKSkpIHsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy51cGxvYWRlZEJ5dGVzID0gdWIgPSB1YiB8fCAwOwogICAgICAgICAgICAgICAgICAgIGJsb2IgPSBmaWxlLnNsaWNlKHViLCBtY3MgfHwgZmlsZS5zaXplIC0gdWIpOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNodW5rU2l6ZSA9IGJsb2Iuc2l6ZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmxvYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmaWxlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBsb2FkID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MsIG5leHRDaHVuaykgewogICAgICAgICAgICAgICAgdmFyIHNlbmQ7CiAgICAgICAgICAgICAgICBzZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICghbmV4dENodW5rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3Mub25TZW5kID09PSBmdW5jICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25TZW5kKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgc2V0dGluZ3MpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVOZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBnZXRCbG9iKGZpbGVzW2luZGV4XSwgc2V0dGluZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBmaWxlc1RvVXBsb2FkOwogICAgICAgICAgICAgICAgICAgIGluaXRVcGxvYWRFdmVudEhhbmRsZXJzKGZpbGVzLCBpbmRleCwgeGhyLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgaW5pdFVwbG9hZFJlcXVlc3QoZmlsZXMsIGluZGV4LCB4aHIsIHNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXNldHRpbmdzLm11bHRpcGFydCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnVwbG9hZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoYmxvYik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVycm9yKCdCcm93c2VyIGRvZXMgbm90IHN1cHBvcnQgWEhSIGZpbGUgdXBsb2FkcycpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNUb1VwbG9hZCA9ICh0eXBlb2YgaW5kZXggPT09ICdudW1iZXInKSA/IFtibG9iXSA6IGZpbGVzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIEZvcm1EYXRhICE9PSB1bmRlZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGFVcGxvYWQoZmlsZXNUb1VwbG9hZCwgeGhyLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIEZpbGVSZWFkZXIgIT09IHVuZGVmICYmIHR5cGVvZiB4aHIuc2VuZEFzQmluYXJ5ID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUmVhZGVyVXBsb2FkKGZpbGVzVG9VcGxvYWQsIHhociwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lcnJvcignQnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IG11bHRpcGFydC9mb3JtLWRhdGEgWEhSIGZpbGUgdXBsb2FkcycpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmICghbmV4dENodW5rKSB7CiAgICAgICAgICAgICAgICAgICAgbXVsdGlMb2FkZXIucHVzaChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3Muc2VxdWVudGlhbFVwbG9hZHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2VIYW5kbGVyLnB1c2goc2VuZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZW5kKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBoYW5kbGVVcGxvYWQgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbnB1dCwgZm9ybSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSwKICAgICAgICAgICAgICAgICAgICB1cGxvYWRTZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICB1cGxvYWRTZXR0aW5ncy5maWxlSW5wdXQgPSBpbnB1dDsKICAgICAgICAgICAgICAgIHVwbG9hZFNldHRpbmdzLnVwbG9hZEZvcm0gPSBmb3JtOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1cGxvYWRTZXR0aW5ncy5pbml0VXBsb2FkID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkU2V0dGluZ3MuaW5pdFVwbG9hZCgKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzLAogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLAogICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRTZXR0aW5ncywKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgdXBsb2FkU2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgdXBsb2FkU2V0dGluZ3MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGFuZGxlTGVnYWN5R2xvYmFsUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbmRleCwgaWZyYW1lLCBzZXR0aW5ncykgewogICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gMCwKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0V2ZW50OwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmRleCA9PT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmlsZXMsIGZ1bmN0aW9uIChpbmRleCwgZmlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSBmaWxlLnNpemUgPyBmaWxlLnNpemUgOiAxOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IGZpbGVzW2luZGV4XS5zaXplID8gZmlsZXNbaW5kZXhdLnNpemUgOiAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJvZ3Jlc3NFdmVudCA9IGNyZWF0ZVByb2dyZXNzRXZlbnQodHJ1ZSwgdG90YWwsIHRvdGFsKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzLnByb2dyZXNzTG9hZGVkID0gdG90YWw7CiAgICAgICAgICAgICAgICBoYW5kbGVHbG9iYWxQcm9ncmVzcyhwcm9ncmVzc0V2ZW50LCBmaWxlcywgaW5kZXgsIGlmcmFtZSwgc2V0dGluZ3MpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbGVnYWN5VXBsb2FkRm9ybURhdGFJbml0ID0gZnVuY3Rpb24gKGlucHV0LCBmb3JtLCBzZXR0aW5ncykgewogICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gZ2V0Rm9ybURhdGEoc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgZm9ybS5maW5kKCc6aW5wdXQnKS5ub3QoJzpkaXNhYmxlZCcpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moc2V0dGluZ3MubmFtZXNwYWNlICsgJ19kaXNhYmxlZCcpOwogICAgICAgICAgICAgICAgJC5lYWNoKGZvcm1EYXRhLCBmdW5jdGlvbiAoaW5kZXgsIGZpZWxkKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnPGlucHV0IHR5cGU9ImhpZGRlbiIvPicpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCduYW1lJywgZmllbGQubmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgLnZhbChmaWVsZC52YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHNldHRpbmdzLm5hbWVzcGFjZSArICdfZm9ybV9kYXRhJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZFRvKGZvcm0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpbnB1dAogICAgICAgICAgICAgICAgICAgIC5hdHRyKCduYW1lJywgZ2V0RmllbGROYW1lKHNldHRpbmdzKSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kVG8oZm9ybSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBsZWdhY3lVcGxvYWRGb3JtRGF0YVJlc2V0ID0gZnVuY3Rpb24gKGlucHV0LCBmb3JtLCBzZXR0aW5ncykgewogICAgICAgICAgICAgICAgaW5wdXQuZGV0YWNoKCk7CiAgICAgICAgICAgICAgICBmb3JtLmZpbmQoJy4nICsgc2V0dGluZ3MubmFtZXNwYWNlICsgJ19kaXNhYmxlZCcpCiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJykKICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moc2V0dGluZ3MubmFtZXNwYWNlICsgJ19kaXNhYmxlZCcpOwogICAgICAgICAgICAgICAgZm9ybS5maW5kKCcuJyArIHNldHRpbmdzLm5hbWVzcGFjZSArICdfZm9ybV9kYXRhJykucmVtb3ZlKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBsZWdhY3lVcGxvYWQgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbnB1dCwgZm9ybSwgaWZyYW1lLCBzZXR0aW5ncywgaW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciBzZW5kOwogICAgICAgICAgICAgICAgc2VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uU2VuZCA9PT0gZnVuYyAmJiBzZXR0aW5ncy5vblNlbmQoZXZlbnQsIGZpbGVzLCBpbmRleCwgaWZyYW1lLCBzZXR0aW5ncykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlTmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW5hbEF0dHJpYnV0ZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICdhY3Rpb24nOiBmb3JtLmF0dHIoJ2FjdGlvbicpLAogICAgICAgICAgICAgICAgICAgICAgICAnbWV0aG9kJzogZm9ybS5hdHRyKCdtZXRob2QnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3RhcmdldCc6IGZvcm0uYXR0cigndGFyZ2V0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICdlbmN0eXBlJzogZm9ybS5hdHRyKCdlbmN0eXBlJykKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGlmcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAudW5iaW5kKCdhYm9ydCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKCdhYm9ydCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUucmVhZHlTdGF0ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBqYXZhc2NyaXB0OmZhbHNlIGFzIGlmcmFtZSBzcmMgcHJldmVudHMgd2FybmluZyBwb3B1cHMgb24gSFRUUFMgaW4gSUU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25jYXQgaXMgdXNlZCBoZXJlIHRvIHByZXZlbnQgdGhlICJTY3JpcHQgVVJMIiBKU0xpbnQgZXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUudW5iaW5kKCdsb2FkJykuYXR0cignc3JjJywgJ2phdmFzY3JpcHQnLmNvbmNhdCgnOmZhbHNlOycpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUxlZ2FjeUdsb2JhbFByb2dyZXNzKGUsIGZpbGVzLCBpbmRleCwgaWZyYW1lLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uQWJvcnQgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkFib3J0KGUsIGZpbGVzLCBpbmRleCwgaWZyYW1lLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU5leHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLnVuYmluZCgnbG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKCdsb2FkJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmcmFtZS5yZWFkeVN0YXRlID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUxlZ2FjeUdsb2JhbFByb2dyZXNzKGUsIGZpbGVzLCBpbmRleCwgaWZyYW1lLCBzZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uTG9hZCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uTG9hZChlLCBmaWxlcywgaW5kZXgsIGlmcmFtZSwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRml4IGZvciBJRSBlbmRsZXNzIHByb2dyZXNzIGJhciBhY3Rpdml0eSBidWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIChoYXBwZW5zIG9uIGZvcm0gc3VibWl0cyB0byBpZnJhbWUgdGFyZ2V0cyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8aWZyYW1lIHNyYz0iamF2YXNjcmlwdDpmYWxzZTsiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij48L2lmcmFtZT4nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhmb3JtKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlTmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBmb3JtCiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhY3Rpb24nLCBnZXRVcmwoc2V0dGluZ3MpKQogICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignbWV0aG9kJywgZ2V0TWV0aG9kKHNldHRpbmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RhcmdldCcsIGlmcmFtZS5hdHRyKCduYW1lJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdlbmN0eXBlJywgJ211bHRpcGFydC9mb3JtLWRhdGEnKTsKICAgICAgICAgICAgICAgICAgICBsZWdhY3lVcGxvYWRGb3JtRGF0YUluaXQoaW5wdXQsIGZvcm0sIHNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICBpZnJhbWUucmVhZHlTdGF0ZSA9IDI7CiAgICAgICAgICAgICAgICAgICAgZm9ybS5nZXQoMCkuc3VibWl0KCk7CiAgICAgICAgICAgICAgICAgICAgbGVnYWN5VXBsb2FkRm9ybURhdGFSZXNldChpbnB1dCwgZm9ybSwgc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICQuZWFjaChvcmlnaW5hbEF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uYXR0cihuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnJlbW92ZUF0dHIobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBtdWx0aUxvYWRlci5wdXNoKFtmaWxlcywgaW5kZXgsIGlmcmFtZSwgc2V0dGluZ3NdKTsKICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5zZXF1ZW50aWFsVXBsb2FkcykgewogICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlSGFuZGxlci5wdXNoKHNlbmQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBub3JtYWxpemVGaWxlID0gZnVuY3Rpb24gKGluZGV4LCBmaWxlKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbGUubmFtZSA9PT0gdW5kZWYgJiYgdHlwZW9mIGZpbGUuc2l6ZSA9PT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgICAgICBmaWxlLm5hbWUgPSBmaWxlLmZpbGVOYW1lOwogICAgICAgICAgICAgICAgICAgIGZpbGUuc2l6ZSA9IGZpbGUuZmlsZVNpemU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBoYW5kbGVMZWdhY3lVcGxvYWQgPSBmdW5jdGlvbiAoZXZlbnQsIGlucHV0LCBmb3JtLCBpbmRleCkgewogICAgICAgICAgICAgICAgaWYgKCEoZXZlbnQgJiYgaW5wdXQgJiYgZm9ybSkpIHsKICAgICAgICAgICAgICAgICAgICAkLmVycm9yKCdJZnJhbWUgYmFzZWQgRmlsZSBVcGxvYWQgcmVxdWlyZXMgYSBmaWxlIGlucHV0IGNoYW5nZSBldmVudCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGphdmFzY3JpcHQ6ZmFsc2UgYXMgaWZyYW1lIHNyYyBwcmV2ZW50cyB3YXJuaW5nIHBvcHVwcyBvbiBIVFRQUyBpbiBJRTY6CiAgICAgICAgICAgICAgICB2YXIgaWZyYW1lID0gJCgnPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6ZmFsc2U7IiBzdHlsZT0iZGlzcGxheTpub25lOyIgbmFtZT0iaWZyYW1lXycgKwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm5hbWVzcGFjZSArICdfJyArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyAnIj48L2lmcmFtZT4nKSwKICAgICAgICAgICAgICAgICAgICB1cGxvYWRTZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBzZXR0aW5ncyksCiAgICAgICAgICAgICAgICAgICAgZmlsZXMgPSBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LmZpbGVzOwogICAgICAgICAgICAgICAgZmlsZXMgPSBmaWxlcyA/IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZpbGVzLCAwKSA6IFt7bmFtZTogaW5wdXQudmFsKCksIHR5cGU6IG51bGwsIHNpemU6IG51bGx9XTsKICAgICAgICAgICAgICAgICQuZWFjaChmaWxlcywgbm9ybWFsaXplRmlsZSk7CiAgICAgICAgICAgICAgICBpbmRleCA9IGZpbGVzLmxlbmd0aCA9PT0gMSA/IDAgOiBpbmRleDsKICAgICAgICAgICAgICAgIHVwbG9hZFNldHRpbmdzLmZpbGVJbnB1dCA9IGlucHV0OwogICAgICAgICAgICAgICAgdXBsb2FkU2V0dGluZ3MudXBsb2FkRm9ybSA9IGZvcm07CiAgICAgICAgICAgICAgICBpZnJhbWUucmVhZHlTdGF0ZSA9IDA7CiAgICAgICAgICAgICAgICBpZnJhbWUuYWJvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLnRyaWdnZXIoJ2Fib3J0Jyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWZyYW1lLmJpbmQoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLnVuYmluZCgnbG9hZCcpOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdXBsb2FkU2V0dGluZ3MuaW5pdFVwbG9hZCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRTZXR0aW5ncy5pbml0VXBsb2FkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZyYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkU2V0dGluZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVnYWN5VXBsb2FkKGV2ZW50LCBmaWxlcywgaW5wdXQsIGZvcm0sIGlmcmFtZSwgdXBsb2FkU2V0dGluZ3MsIGluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsZWdhY3lVcGxvYWQoZXZlbnQsIGZpbGVzLCBpbnB1dCwgZm9ybSwgaWZyYW1lLCB1cGxvYWRTZXR0aW5ncywgaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKGZvcm0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2FuSGFuZGxlWEhSVXBsb2FkU2l6ZSA9IGZ1bmN0aW9uIChmaWxlcykgewogICAgICAgICAgICAgICAgdmFyIGJ5dGVzID0gMCwKICAgICAgICAgICAgICAgICAgICB0b3RhbEJ5dGVzID0gMCwKICAgICAgICAgICAgICAgICAgICBpOwogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLm11bHRpcGFydCAmJiB0eXBlb2YgRm9ybURhdGEgPT09IHVuZGVmKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzID0gZmlsZXNbaV0uc2l6ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVzID4gc2V0dGluZ3MubWF4RmlsZVJlYWRlclNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEJ5dGVzICs9IGJ5dGVzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MubXVsdGlGaWxlUmVxdWVzdCAmJiB0b3RhbEJ5dGVzID4gc2V0dGluZ3MubWF4RmlsZVJlYWRlclNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGFuZGxlRmlsZXMgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbnB1dCwgZm9ybSkgewogICAgICAgICAgICAgICAgaWYgKCFjYW5IYW5kbGVYSFJVcGxvYWRTaXplKGZpbGVzKSkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZUxlZ2FjeVVwbG9hZChldmVudCwgaW5wdXQsIGZvcm0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBpOwogICAgICAgICAgICAgICAgZmlsZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmaWxlcywgMCk7CiAgICAgICAgICAgICAgICAkLmVhY2goZmlsZXMsIG5vcm1hbGl6ZUZpbGUpOwogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLm11bHRpRmlsZVJlcXVlc3QgJiYgc2V0dGluZ3MubXVsdGlwYXJ0ICYmIGZpbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVVwbG9hZChldmVudCwgZmlsZXMsIGlucHV0LCBmb3JtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVVwbG9hZChldmVudCwgZmlsZXMsIGlucHV0LCBmb3JtLCBpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBpbml0VXBsb2FkRm9ybSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHVwbG9hZEZvcm0gPSAoY29udGFpbmVyLmlzKCdmb3JtJykgPyBjb250YWluZXIgOiBjb250YWluZXIuZmluZCgnZm9ybScpKQogICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoc2V0dGluZ3MudXBsb2FkRm9ybUZpbHRlcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBpbml0RmlsZUlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZmlsZUlucHV0ID0gKHVwbG9hZEZvcm0ubGVuZ3RoID8gdXBsb2FkRm9ybSA6IGNvbnRhaW5lcikuZmluZCgnaW5wdXQ6ZmlsZScpCiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihzZXR0aW5ncy5maWxlSW5wdXRGaWx0ZXIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgcmVwbGFjZUZpbGVJbnB1dCA9IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAgICAgdmFyIGlucHV0Q2xvbmUgPSBpbnB1dC5jbG9uZSh0cnVlKTsKICAgICAgICAgICAgICAgICQoJzxmb3JtLz4nKS5hcHBlbmQoaW5wdXRDbG9uZSkuZ2V0KDApLnJlc2V0KCk7CiAgICAgICAgICAgICAgICBpbnB1dC5hZnRlcihpbnB1dENsb25lKS5kZXRhY2goKTsKICAgICAgICAgICAgICAgIGluaXRGaWxlSW5wdXQoKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vbkRvY3VtZW50RHJhZ092ZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uRG9jdW1lbnREcmFnT3ZlciA9PT0gZnVuYyAmJgogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uRG9jdW1lbnREcmFnT3ZlcihlKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLm9uRG9jdW1lbnREcm9wID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkRvY3VtZW50RHJvcCA9PT0gZnVuYyAmJgogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uRG9jdW1lbnREcm9wKGUpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLm9uRHJhZ092ZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uRHJhZ092ZXIgPT09IGZ1bmMgJiYKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkRyYWdPdmVyKGUpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkYXRhVHJhbnNmZXIgPSBlLm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyOwogICAgICAgICAgICBpZiAoZGF0YVRyYW5zZmVyICYmIGRhdGFUcmFuc2Zlci5maWxlcykgewogICAgICAgICAgICAgICAgZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBkYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdjb3B5JzsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMub25Ecm9wID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vbkRyb3AgPT09IGZ1bmMgJiYKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkRyb3AoZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGRhdGFUcmFuc2ZlciA9IGUub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXI7CiAgICAgICAgICAgIGlmIChkYXRhVHJhbnNmZXIgJiYgZGF0YVRyYW5zZmVyLmZpbGVzICYmIGlzWEhSVXBsb2FkQ2FwYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVGaWxlcyhlLCBkYXRhVHJhbnNmZXIuZmlsZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMub25DaGFuZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uQ2hhbmdlID09PSBmdW5jICYmCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UoZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGlucHV0ID0gJChlLnRhcmdldCksCiAgICAgICAgICAgICAgICBmb3JtID0gJChlLnRhcmdldC5mb3JtKTsKICAgICAgICAgICAgaWYgKGZvcm0ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MucmVwbGFjZUZpbGVJbnB1dCkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmRhdGEoZGVmYXVsdE5hbWVzcGFjZSArICdfZm9ybScsIGZvcm0pOwogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGaWxlSW5wdXQoaW5wdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9ybSA9IGlucHV0LmRhdGEoZGVmYXVsdE5hbWVzcGFjZSArICdfZm9ybScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc2V0dGluZ3MuZm9yY2VJZnJhbWVVcGxvYWQgJiYgZS50YXJnZXQuZmlsZXMgJiYgaXNYSFJVcGxvYWRDYXBhYmxlKCkpIHsKICAgICAgICAgICAgICAgIGhhbmRsZUZpbGVzKGUsIGUudGFyZ2V0LmZpbGVzLCBpbnB1dCwgZm9ybSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBoYW5kbGVMZWdhY3lVcGxvYWQoZSwgaW5wdXQsIGZvcm0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICQuZXh0ZW5kKHNldHRpbmdzLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIG9wdGlvbnNSZWZlcmVuY2UgPSBvcHRpb25zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluaXRVcGxvYWRGb3JtKCk7CiAgICAgICAgICAgIGluaXRGaWxlSW5wdXQoKTsKICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5kYXRhKHNldHRpbmdzLm5hbWVzcGFjZSkpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoJ0ZpbGVVcGxvYWQgd2l0aCBuYW1lc3BhY2UgIicgKyBzZXR0aW5ncy5uYW1lc3BhY2UgKyAnIiBhbHJlYWR5IGFzc2lnbmVkIHRvIHRoaXMgZWxlbWVudCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRhaW5lcgogICAgICAgICAgICAgICAgLmRhdGEoc2V0dGluZ3MubmFtZXNwYWNlLCBmaWxlVXBsb2FkKQogICAgICAgICAgICAgICAgLmFkZENsYXNzKHNldHRpbmdzLmNzc0NsYXNzKTsKICAgICAgICAgICAgc2V0dGluZ3MuZHJvcFpvbmUubm90KGNvbnRhaW5lcikuYWRkQ2xhc3Moc2V0dGluZ3MuY3NzQ2xhc3MpOwogICAgICAgICAgICBpbml0RXZlbnRIYW5kbGVycygpOwogICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmluaXQgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgIHNldHRpbmdzLmluaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMub3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBvbGRDc3NDbGFzcywKICAgICAgICAgICAgICAgIG9sZERyb3Bab25lLAogICAgICAgICAgICAgICAgdXBsb2FkRm9ybUZpbHRlclVwZGF0ZSwKICAgICAgICAgICAgICAgIGZpbGVJbnB1dEZpbHRlclVwZGF0ZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSB1bmRlZikgewogICAgICAgICAgICAgICAgcmV0dXJuICQuZXh0ZW5kKHt9LCBzZXR0aW5ncyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnNSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnNSZWZlcmVuY2UsIG9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbW92ZUV2ZW50SGFuZGxlcnMoKTsKICAgICAgICAgICAgJC5lYWNoKG9wdGlvbnMsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChuYW1lKSB7CiAgICAgICAgICAgICAgICBjYXNlICduYW1lc3BhY2UnOgogICAgICAgICAgICAgICAgICAgICQuZXJyb3IoJ1RoZSBGaWxlVXBsb2FkIG5hbWVzcGFjZSBjYW5ub3QgYmUgdXBkYXRlZC4nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlICd1cGxvYWRGb3JtRmlsdGVyJzoKICAgICAgICAgICAgICAgICAgICB1cGxvYWRGb3JtRmlsdGVyVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXRGaWx0ZXJVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZmlsZUlucHV0RmlsdGVyJzoKICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXRGaWx0ZXJVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnY3NzQ2xhc3MnOgogICAgICAgICAgICAgICAgICAgIG9sZENzc0NsYXNzID0gc2V0dGluZ3MuY3NzQ2xhc3M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdkcm9wWm9uZSc6CiAgICAgICAgICAgICAgICAgICAgb2xkRHJvcFpvbmUgPSBzZXR0aW5ncy5kcm9wWm9uZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodXBsb2FkRm9ybUZpbHRlclVwZGF0ZSkgewogICAgICAgICAgICAgICAgaW5pdFVwbG9hZEZvcm0oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmlsZUlucHV0RmlsdGVyVXBkYXRlKSB7CiAgICAgICAgICAgICAgICBpbml0RmlsZUlucHV0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBvbGRDc3NDbGFzcyAhPT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhvbGRDc3NDbGFzcykKICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moc2V0dGluZ3MuY3NzQ2xhc3MpOwogICAgICAgICAgICAgICAgKG9sZERyb3Bab25lID8gb2xkRHJvcFpvbmUgOiBzZXR0aW5ncy5kcm9wWm9uZSkubm90KGNvbnRhaW5lcikKICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Mob2xkQ3NzQ2xhc3MpOwogICAgICAgICAgICAgICAgc2V0dGluZ3MuZHJvcFpvbmUubm90KGNvbnRhaW5lcikuYWRkQ2xhc3Moc2V0dGluZ3MuY3NzQ2xhc3MpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9sZERyb3Bab25lKSB7CiAgICAgICAgICAgICAgICBvbGREcm9wWm9uZS5ub3QoY29udGFpbmVyKS5yZW1vdmVDbGFzcyhzZXR0aW5ncy5jc3NDbGFzcyk7CiAgICAgICAgICAgICAgICBzZXR0aW5ncy5kcm9wWm9uZS5ub3QoY29udGFpbmVyKS5hZGRDbGFzcyhzZXR0aW5ncy5jc3NDbGFzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5pdEV2ZW50SGFuZGxlcnMoKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMub3B0aW9uID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBvcHRpb25zOwogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSB1bmRlZikgewogICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlOwogICAgICAgICAgICBmaWxlVXBsb2FkLm9wdGlvbnMob3B0aW9ucyk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3MuZGVzdHJveSA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgc2V0dGluZ3MuZGVzdHJveSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbW92ZUV2ZW50SGFuZGxlcnMoKTsKICAgICAgICAgICAgY29udGFpbmVyCiAgICAgICAgICAgICAgICAucmVtb3ZlRGF0YShzZXR0aW5ncy5uYW1lc3BhY2UpCiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moc2V0dGluZ3MuY3NzQ2xhc3MpOwogICAgICAgICAgICBzZXR0aW5ncy5kcm9wWm9uZS5ub3QoY29udGFpbmVyKS5yZW1vdmVDbGFzcyhzZXR0aW5ncy5jc3NDbGFzcyk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLnVwbG9hZCA9IGZ1bmN0aW9uIChmaWxlcykgewogICAgICAgICAgICBpZiAodHlwZW9mIGZpbGVzLmxlbmd0aCA9PT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgIGZpbGVzID0gW2ZpbGVzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoYW5kbGVGaWxlcyhudWxsLCBmaWxlcyk7CiAgICAgICAgfTsKICAgIH07CgogICAgbWV0aG9kcyA9IHsKICAgICAgICBpbml0IDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAobmV3IEZpbGVVcGxvYWQoJCh0aGlzKSkpLmluaXQob3B0aW9ucyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgb3B0aW9uOiBmdW5jdGlvbiAob3B0aW9uLCB2YWx1ZSwgbmFtZXNwYWNlKSB7CiAgICAgICAgICAgIG5hbWVzcGFjZSA9IG5hbWVzcGFjZSA/IG5hbWVzcGFjZSA6IGRlZmF1bHROYW1lc3BhY2U7CiAgICAgICAgICAgIHZhciBmaWxlVXBsb2FkID0gJCh0aGlzKS5kYXRhKG5hbWVzcGFjZSk7CiAgICAgICAgICAgIGlmIChmaWxlVXBsb2FkKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlVXBsb2FkLm9wdGlvbnMoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHZhbHVlID09PSB1bmRlZikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlVXBsb2FkLm9wdGlvbihvcHRpb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJC5lcnJvcignTm8gRmlsZVVwbG9hZCB3aXRoIG5hbWVzcGFjZSAiJyArIG5hbWVzcGFjZSArICciIGFzc2lnbmVkIHRvIHRoaXMgZWxlbWVudCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGZ1ID0gJCh0aGlzKS5kYXRhKG5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICBpZiAoZnUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnUub3B0aW9uKG9wdGlvbiwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1Lm9wdGlvbnMob3B0aW9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQuZXJyb3IoJ05vIEZpbGVVcGxvYWQgd2l0aCBuYW1lc3BhY2UgIicgKyBuYW1lc3BhY2UgKyAnIiBhc3NpZ25lZCB0byB0aGlzIGVsZW1lbnQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIChuYW1lc3BhY2UpIHsKICAgICAgICAgICAgbmFtZXNwYWNlID0gbmFtZXNwYWNlID8gbmFtZXNwYWNlIDogZGVmYXVsdE5hbWVzcGFjZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZVVwbG9hZCA9ICQodGhpcykuZGF0YShuYW1lc3BhY2UpOwogICAgICAgICAgICAgICAgaWYgKGZpbGVVcGxvYWQpIHsKICAgICAgICAgICAgICAgICAgICBmaWxlVXBsb2FkLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJC5lcnJvcignTm8gRmlsZVVwbG9hZCB3aXRoIG5hbWVzcGFjZSAiJyArIG5hbWVzcGFjZSArICciIGFzc2lnbmVkIHRvIHRoaXMgZWxlbWVudCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIHVwbG9hZDogZnVuY3Rpb24gKGZpbGVzLCBuYW1lc3BhY2UpIHsKICAgICAgICAgICAgbmFtZXNwYWNlID0gbmFtZXNwYWNlID8gbmFtZXNwYWNlIDogZGVmYXVsdE5hbWVzcGFjZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZVVwbG9hZCA9ICQodGhpcykuZGF0YShuYW1lc3BhY2UpOwogICAgICAgICAgICAgICAgaWYgKGZpbGVVcGxvYWQpIHsKICAgICAgICAgICAgICAgICAgICBmaWxlVXBsb2FkLnVwbG9hZChmaWxlcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQuZXJyb3IoJ05vIEZpbGVVcGxvYWQgd2l0aCBuYW1lc3BhY2UgIicgKyBuYW1lc3BhY2UgKyAnIiBhc3NpZ25lZCB0byB0aGlzIGVsZW1lbnQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgJC5mbi5maWxlVXBsb2FkID0gZnVuY3Rpb24gKG1ldGhvZCkgewogICAgICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHsKICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICFtZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQuZXJyb3IoJ01ldGhvZCAiJyArIG1ldGhvZCArICciIGRvZXMgbm90IGV4aXN0IG9uIGpRdWVyeS5maWxlVXBsb2FkJyk7CiAgICAgICAgfQogICAgfTsKICAgIAp9KGpRdWVyeSkpOwoKCi8qCiAqIGpRdWVyeSBGaWxlIFVwbG9hZCBVc2VyIEludGVyZmFjZSBQbHVnaW4gNC40LjEKICogaHR0cHM6Ly9naXRodWIuY29tL2JsdWVpbXAvalF1ZXJ5LUZpbGUtVXBsb2FkCiAqCiAqIENvcHlyaWdodCAyMDEwLCBTZWJhc3RpYW4gVHNjaGFuCiAqIGh0dHBzOi8vYmx1ZWltcC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlOgogKiBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9NSVQvCiAqLwoKLypqc2xpbnQgYnJvd3NlcjogdHJ1ZSwgdW5wYXJhbTogdHJ1ZSAqLwovKmdsb2JhbCBqUXVlcnksIEZpbGVSZWFkZXIsIFVSTCwgd2Via2l0VVJMICovCgooZnVuY3Rpb24gKCQpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICB2YXIgdW5kZWYgPSAndW5kZWZpbmVkJywKICAgICAgICBmdW5jID0gJ2Z1bmN0aW9uJywKICAgICAgICBVcGxvYWRIYW5kbGVyLAogICAgICAgIG1ldGhvZHMsCgogICAgICAgIE11bHRpTG9hZGVyID0gZnVuY3Rpb24gKGNhbGxCYWNrKSB7CiAgICAgICAgICAgIHZhciBsb2FkZWQgPSAwLAogICAgICAgICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgICAgICB0aGlzLmNvbXBsZXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbG9hZGVkICs9IDE7CiAgICAgICAgICAgICAgICBpZiAobG9hZGVkID09PSBsaXN0Lmxlbmd0aCArIDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBsaXN0Lmxlbmd0aCAqIG9uQ29tcGxldGUgKyAxICogb25Mb2FkQWxsCiAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2sobGlzdCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gMDsKICAgICAgICAgICAgICAgICAgICBsaXN0ID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMucHVzaCA9IGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICBsaXN0LnB1c2goaXRlbSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuZ2V0TGlzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0OwogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgICAgCiAgICBVcGxvYWRIYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgIHZhciB1cGxvYWRIYW5kbGVyID0gdGhpcywKICAgICAgICAgICAgZHJhZ092ZXJUaW1lb3V0LAogICAgICAgICAgICBpc0Ryb3Bab25lRW5sYXJnZWQsCiAgICAgICAgICAgIG11bHRpTG9hZGVyID0gbmV3IE11bHRpTG9hZGVyKGZ1bmN0aW9uIChsaXN0KSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmhpZGVQcm9ncmVzc0JhckFsbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5yZXNldFByb2dyZXNzQmFyQWxsKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1cGxvYWRIYW5kbGVyLm9uQ29tcGxldGVBbGwgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5vbkNvbXBsZXRlQWxsKGxpc3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgZ2V0VXBsb2FkVGFibGUgPSBmdW5jdGlvbiAoaGFuZGxlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBoYW5kbGVyLnVwbG9hZFRhYmxlID09PSBmdW5jID8KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnVwbG9hZFRhYmxlKGhhbmRsZXIpIDogaGFuZGxlci51cGxvYWRUYWJsZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RG93bmxvYWRUYWJsZSA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGhhbmRsZXIuZG93bmxvYWRUYWJsZSA9PT0gZnVuYyA/CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5kb3dubG9hZFRhYmxlKGhhbmRsZXIpIDogaGFuZGxlci5kb3dubG9hZFRhYmxlOwogICAgICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMucmVxdWVzdEhlYWRlcnMgPSB7J0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQsICovKjsgcT0wLjAxJ307CiAgICAgICAgdGhpcy5kcm9wWm9uZSA9IGNvbnRhaW5lcjsKICAgICAgICB0aGlzLmltYWdlVHlwZXMgPSAvXmltYWdlXC8oZ2lmfGpwZWd8cG5nKSQvOwogICAgICAgIHRoaXMucHJldmlld01heFdpZHRoID0gdGhpcy5wcmV2aWV3TWF4SGVpZ2h0ID0gODA7CiAgICAgICAgdGhpcy5wcmV2aWV3TG9hZERlbGF5ID0gMTAwOwogICAgICAgIHRoaXMucHJldmlld0FzQ2FudmFzID0gdHJ1ZTsKICAgICAgICB0aGlzLnByZXZpZXdTZWxlY3RvciA9ICcuZmlsZV91cGxvYWRfcHJldmlldyc7CiAgICAgICAgdGhpcy5wcm9ncmVzc1NlbGVjdG9yID0gJy5maWxlX3VwbG9hZF9wcm9ncmVzcyBkaXYnOwogICAgICAgIHRoaXMuY2FuY2VsU2VsZWN0b3IgPSAnLmZpbGVfdXBsb2FkX2NhbmNlbCBidXR0b24nOwogICAgICAgIHRoaXMuY3NzQ2xhc3NTbWFsbCA9ICdmaWxlX3VwbG9hZF9zbWFsbCc7CiAgICAgICAgdGhpcy5jc3NDbGFzc0xhcmdlID0gJ2ZpbGVfdXBsb2FkX2xhcmdlJzsKICAgICAgICB0aGlzLmNzc0NsYXNzSGlnaGxpZ2h0ID0gJ2ZpbGVfdXBsb2FkX2hpZ2hsaWdodCc7CiAgICAgICAgdGhpcy5kcm9wRWZmZWN0ID0gJ2hpZ2hsaWdodCc7CiAgICAgICAgdGhpcy51cGxvYWRUYWJsZSA9IHRoaXMuZG93bmxvYWRUYWJsZSA9IG51bGw7CiAgICAgICAgdGhpcy5idWlsZFVwbG9hZFJvdyA9IHRoaXMuYnVpbGREb3dubG9hZFJvdyA9IG51bGw7CiAgICAgICAgdGhpcy5wcm9ncmVzc0FsbE5vZGUgPSBudWxsOwoKICAgICAgICB0aGlzLmxvYWRJbWFnZSA9IGZ1bmN0aW9uIChmaWxlLCBjYWxsQmFjaywgbWF4V2lkdGgsIG1heEhlaWdodCwgaW1hZ2VUeXBlcywgbm9DYW52YXMpIHsKICAgICAgICAgICAgdmFyIGltZywKICAgICAgICAgICAgICAgIHNjYWxlSW1hZ2UsCiAgICAgICAgICAgICAgICB1cmxBUEksCiAgICAgICAgICAgICAgICBmaWxlUmVhZGVyOwogICAgICAgICAgICBpZiAoaW1hZ2VUeXBlcyAmJiAhaW1hZ2VUeXBlcy50ZXN0KGZpbGUudHlwZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNjYWxlSW1hZ2UgPSBmdW5jdGlvbiAoaW1nKSB7CiAgICAgICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyksCiAgICAgICAgICAgICAgICAgICAgc2NhbGUgPSBNYXRoLm1pbigKICAgICAgICAgICAgICAgICAgICAgICAgKG1heFdpZHRoIHx8IGltZy53aWR0aCkgLyBpbWcud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIChtYXhIZWlnaHQgfHwgaW1nLmhlaWdodCkgLyBpbWcuaGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmIChzY2FsZSA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBzY2FsZSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbWcud2lkdGggPSBwYXJzZUludChpbWcud2lkdGggKiBzY2FsZSwgMTApOwogICAgICAgICAgICAgICAgaW1nLmhlaWdodCA9IHBhcnNlSW50KGltZy5oZWlnaHQgKiBzY2FsZSwgMTApOwogICAgICAgICAgICAgICAgaWYgKG5vQ2FudmFzIHx8IHR5cGVvZiBjYW52YXMuZ2V0Q29udGV4dCAhPT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbWc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBpbWcud2lkdGg7CiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodDsKICAgICAgICAgICAgICAgIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWcsIDAsIDAsIGltZy53aWR0aCwgaW1nLmhlaWdodCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FudmFzOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKICAgICAgICAgICAgdXJsQVBJID0gdHlwZW9mIFVSTCAhPT0gdW5kZWYgPyBVUkwgOiB0eXBlb2Ygd2Via2l0VVJMICE9PSB1bmRlZiA/IHdlYmtpdFVSTCA6IG51bGw7CiAgICAgICAgICAgIGlmICh1cmxBUEkgJiYgdHlwZW9mIHVybEFQSS5jcmVhdGVPYmplY3RVUkwgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsQVBJLnJldm9rZU9iamVjdFVSTCh0aGlzLnNyYyk7CiAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2soc2NhbGVJbWFnZShpbWcpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpbWcuc3JjID0gdXJsQVBJLmNyZWF0ZU9iamVjdFVSTChmaWxlKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgRmlsZVJlYWRlciAhPT0gdW5kZWYgJiYKICAgICAgICAgICAgICAgICAgICB0eXBlb2YgRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzRGF0YVVSTCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjYWxsQmFjayhzY2FsZUltYWdlKGltZykpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FsbEJhY2sobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmFkZE5vZGUgPSBmdW5jdGlvbiAocGFyZW50Tm9kZSwgbm9kZSwgY2FsbEJhY2spIHsKICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUgJiYgcGFyZW50Tm9kZS5sZW5ndGggJiYgbm9kZSAmJiBub2RlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgbm9kZS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpLmFwcGVuZFRvKHBhcmVudE5vZGUpLmZhZGVJbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsQmFjayA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRml4IGVuZGxlc3MgZXhjZXB0aW9uIGxvb3A6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY2FsbEJhY2sgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgIGNhbGxCYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlbW92ZU5vZGUgPSBmdW5jdGlvbiAobm9kZSwgY2FsbEJhY2spIHsKICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG5vZGUuZmFkZU91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxCYWNrID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsQmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaXggZW5kbGVzcyBleGNlcHRpb24gbG9vcDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjYWxsQmFjayA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgY2FsbEJhY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5yZXBsYWNlTm9kZSA9IGZ1bmN0aW9uIChvbGROb2RlLCBuZXdOb2RlLCBjYWxsQmFjaykgewogICAgICAgICAgICBpZiAoIShuZXdOb2RlICYmIG5ld05vZGUubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZEhhbmRsZXIucmVtb3ZlTm9kZShvbGROb2RlLCBjYWxsQmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9sZE5vZGUgJiYgb2xkTm9kZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG9sZE5vZGUuZmFkZU91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpOwogICAgICAgICAgICAgICAgICAgIG9sZE5vZGUucmVwbGFjZVdpdGgobmV3Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZS5mYWRlSW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxCYWNrID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxCYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRml4IGVuZGxlc3MgZXhjZXB0aW9uIGxvb3A6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkTm9kZS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNhbGxCYWNrID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICBjYWxsQmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5yZXNldFByb2dyZXNzQmFyQWxsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodXBsb2FkSGFuZGxlci5wcm9ncmVzc2JhckFsbCkgewogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5wcm9ncmVzc2JhckFsbC5wcm9ncmVzc2JhcigKICAgICAgICAgICAgICAgICAgICAndmFsdWUnLAogICAgICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmhpZGVQcm9ncmVzc0JhckFsbCA9IGZ1bmN0aW9uIChjYWxsQmFjaykgewogICAgICAgICAgICBpZiAodXBsb2FkSGFuZGxlci5wcm9ncmVzc2JhckFsbCAmJiAhJChnZXRVcGxvYWRUYWJsZSh1cGxvYWRIYW5kbGVyKSkKICAgICAgICAgICAgICAgICAgICAuZmluZCh1cGxvYWRIYW5kbGVyLnByb2dyZXNzU2VsZWN0b3IgKyAnOnZpc2libGU6Zmlyc3QnKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIucHJvZ3Jlc3NiYXJBbGwuZmFkZU91dChjYWxsQmFjayk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNhbGxCYWNrID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICBjYWxsQmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vbkFib3J0ID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikgewogICAgICAgICAgICBoYW5kbGVyLnJlbW92ZU5vZGUoaGFuZGxlci51cGxvYWRSb3csIGhhbmRsZXIuaGlkZVByb2dyZXNzQmFyQWxsKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMuY2FuY2VsVXBsb2FkID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikgewogICAgICAgICAgICB2YXIgcmVhZHlTdGF0ZSA9IHhoci5yZWFkeVN0YXRlOwogICAgICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICAgICAgLy8gSWYgcmVhZHlTdGF0ZSBpcyBiZWxvdyAyLCBhYm9ydCgpIGhhcyBubyBlZmZlY3Q6CiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVhZHlTdGF0ZSAhPT0gJ251bWJlcicgfHwgcmVhZHlTdGF0ZSA8IDIpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIub25BYm9ydChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmluaXRQcm9ncmVzc0JhciA9IGZ1bmN0aW9uIChub2RlLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAoIW5vZGUgfHwgIW5vZGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIG5vZGUucHJvZ3Jlc3NiYXIgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBub2RlLnByb2dyZXNzYmFyKHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbm9kZS5hZGRDbGFzcygncHJvZ3Jlc3NiYXInKQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdi8+JykuY3NzKCd3aWR0aCcsIHZhbHVlICsgJyUnKSkKICAgICAgICAgICAgICAgICAgICAucHJvZ3Jlc3NiYXIgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdkZXN0cm95JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ3Byb2dyZXNzYmFyJykuZW1wdHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbigpLmNzcygnd2lkdGgnLCB2YWx1ZSArICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5kZXN0cm95UHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgICBpZiAoIW5vZGUgfHwgIW5vZGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbm9kZS5wcm9ncmVzc2JhcignZGVzdHJveScpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5pbml0VXBsb2FkUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoeGhyLCBoYW5kbGVyKSB7CiAgICAgICAgICAgIGlmICgheGhyLnVwbG9hZCAmJiBoYW5kbGVyLnByb2dyZXNzYmFyKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVyLnByb2dyZXNzYmFyLnByb2dyZXNzYmFyKAogICAgICAgICAgICAgICAgICAgICd2YWx1ZScsCiAgICAgICAgICAgICAgICAgICAgMTAwIC8vIGluZGV0ZXJtaW5hdGUgcHJvZ3Jlc3MgZGlzcGxheWVkIGJ5IGEgZnVsbCBhbmltYXRlZCBwcm9ncmVzcyBiYXIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmluaXRVcGxvYWRQcm9ncmVzc0FsbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHVwbG9hZEhhbmRsZXIucHJvZ3Jlc3NiYXJBbGwgJiYgdXBsb2FkSGFuZGxlci5wcm9ncmVzc2JhckFsbC5pcygnOmhpZGRlbicpKSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLnByb2dyZXNzYmFyQWxsLmZhZGVJbigpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vblNlbmQgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKSB7CiAgICAgICAgICAgIGhhbmRsZXIuaW5pdFVwbG9hZFByb2dyZXNzKHhociwgaGFuZGxlcik7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vblByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikgewogICAgICAgICAgICBpZiAoaGFuZGxlci5wcm9ncmVzc2JhciAmJiBldmVudC5sZW5ndGhDb21wdXRhYmxlKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVyLnByb2dyZXNzYmFyLnByb2dyZXNzYmFyKAogICAgICAgICAgICAgICAgICAgICd2YWx1ZScsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQoZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDAsIDEwKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMub25Qcm9ncmVzc0FsbCA9IGZ1bmN0aW9uIChldmVudCwgbGlzdCkgewogICAgICAgICAgICBpZiAodXBsb2FkSGFuZGxlci5wcm9ncmVzc2JhckFsbCAmJiBldmVudC5sZW5ndGhDb21wdXRhYmxlKSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLnByb2dyZXNzYmFyQWxsLnByb2dyZXNzYmFyKAogICAgICAgICAgICAgICAgICAgICd2YWx1ZScsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQoZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDAsIDEwKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMub25Mb2FkQWxsID0gZnVuY3Rpb24gKGxpc3QpIHsKICAgICAgICAgICAgbXVsdGlMb2FkZXIuY29tcGxldGUoKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLmluaXRQcm9ncmVzc0JhckFsbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCF1cGxvYWRIYW5kbGVyLnByb2dyZXNzYmFyQWxsKSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLnByb2dyZXNzYmFyQWxsID0gdXBsb2FkSGFuZGxlci5pbml0UHJvZ3Jlc3NCYXIoCiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiB1cGxvYWRIYW5kbGVyLnByb2dyZXNzQWxsTm9kZSA9PT0gZnVuYyA/CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5wcm9ncmVzc0FsbE5vZGUodXBsb2FkSGFuZGxlcikgOiB1cGxvYWRIYW5kbGVyLnByb2dyZXNzQWxsTm9kZSksCiAgICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5kZXN0cm95UHJvZ3Jlc3NCYXJBbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZGVzdHJveVByb2dyZXNzQmFyKHVwbG9hZEhhbmRsZXIucHJvZ3Jlc3NiYXJBbGwpOwogICAgICAgIH07CgogICAgICAgIHRoaXMubG9hZFByZXZpZXdJbWFnZSA9IGZ1bmN0aW9uIChmaWxlcywgaW5kZXgsIGhhbmRsZXIpIHsKICAgICAgICAgICAgaW5kZXggPSBpbmRleCB8fCAwOwogICAgICAgICAgICBoYW5kbGVyLnVwbG9hZFJvdy5maW5kKGhhbmRsZXIucHJldmlld1NlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBwcmV2aWV3Tm9kZSA9ICQodGhpcyksCiAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGZpbGVzW2luZGV4XTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIubG9hZEltYWdlKAogICAgICAgICAgICAgICAgICAgICAgICBmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoaW1nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmFkZE5vZGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld05vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChpbWcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnByZXZpZXdNYXhXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5wcmV2aWV3TWF4SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmltYWdlVHlwZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICFoYW5kbGVyLnByZXZpZXdBc0NhbnZhcwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9LCBoYW5kbGVyLnByZXZpZXdMb2FkRGVsYXkpOwogICAgICAgICAgICAgICAgaW5kZXggKz0gMTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0VXBsb2FkUm93ID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikgewogICAgICAgICAgICB2YXIgdXBsb2FkUm93ID0gaGFuZGxlci51cGxvYWRSb3cgPSAodHlwZW9mIGhhbmRsZXIuYnVpbGRVcGxvYWRSb3cgPT09IGZ1bmMgPwogICAgICAgICAgICAgICAgaGFuZGxlci5idWlsZFVwbG9hZFJvdyhmaWxlcywgaW5kZXgsIGhhbmRsZXIpIDogbnVsbCk7CiAgICAgICAgICAgIGlmICh1cGxvYWRSb3cpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIucHJvZ3Jlc3NiYXIgPSBoYW5kbGVyLmluaXRQcm9ncmVzc0JhcigKICAgICAgICAgICAgICAgICAgICB1cGxvYWRSb3cuZmluZChoYW5kbGVyLnByb2dyZXNzU2VsZWN0b3IpLAogICAgICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB1cGxvYWRSb3cuZmluZChoYW5kbGVyLmNhbmNlbFNlbGVjdG9yKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuY2FuY2VsVXBsb2FkKGUsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGhhbmRsZXIubG9hZFByZXZpZXdJbWFnZShmaWxlcywgaW5kZXgsIGhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmluaXRVcGxvYWQgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyLCBjYWxsQmFjaykgewogICAgICAgICAgICBoYW5kbGVyLmluaXRVcGxvYWRSb3coZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgaGFuZGxlci5hZGROb2RlKAogICAgICAgICAgICAgICAgZ2V0VXBsb2FkVGFibGUoaGFuZGxlciksCiAgICAgICAgICAgICAgICBoYW5kbGVyLnVwbG9hZFJvdywKICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIuYmVmb3JlU2VuZCA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmJlZm9yZVNlbmQoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyLCBjYWxsQmFjayk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGhhbmRsZXIuaW5pdFVwbG9hZFByb2dyZXNzQWxsKCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLnBhcnNlUmVzcG9uc2UgPSBmdW5jdGlvbiAoeGhyLCBoYW5kbGVyKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgeGhyLnJlc3BvbnNlVGV4dCAhPT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkLnBhcnNlSlNPTih4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEluc3RlYWQgb2YgYW4gWEhSIG9iamVjdCwgYW4gaWZyYW1lIGlzIHVzZWQgZm9yIGxlZ2FjeSBicm93c2VyczoKICAgICAgICAgICAgICAgIHJldHVybiAkLnBhcnNlSlNPTih4aHIuY29udGVudHMoKS50ZXh0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmluaXREb3dubG9hZFJvdyA9IGZ1bmN0aW9uIChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpIHsKICAgICAgICAgICAgdmFyIGpzb24sIGRvd25sb2FkUm93OwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAganNvbiA9IGhhbmRsZXIucmVzcG9uc2UgPSBoYW5kbGVyLnBhcnNlUmVzcG9uc2UoeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyLm9uRXJyb3IgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm9yaWdpbmFsRXZlbnQgPSBldmVudDsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm9uRXJyb3IoZSwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvd25sb2FkUm93ID0gaGFuZGxlci5kb3dubG9hZFJvdyA9ICh0eXBlb2YgaGFuZGxlci5idWlsZERvd25sb2FkUm93ID09PSBmdW5jID8KICAgICAgICAgICAgICAgIGhhbmRsZXIuYnVpbGREb3dubG9hZFJvdyhqc29uLCBoYW5kbGVyKSA6IG51bGwpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5vbkxvYWQgPSBmdW5jdGlvbiAoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKSB7CiAgICAgICAgICAgIHZhciB1cGxvYWRUYWJsZSA9IGdldFVwbG9hZFRhYmxlKGhhbmRsZXIpLAogICAgICAgICAgICAgICAgZG93bmxvYWRUYWJsZSA9IGdldERvd25sb2FkVGFibGUoaGFuZGxlciksCiAgICAgICAgICAgICAgICBjYWxsQmFjayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIub25Db21wbGV0ZSA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm9uQ29tcGxldGUoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbXVsdGlMb2FkZXIuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIG11bHRpTG9hZGVyLnB1c2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICAgICAgICAgIGhhbmRsZXIuaW5pdERvd25sb2FkUm93KGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcik7CiAgICAgICAgICAgIGlmICh1cGxvYWRUYWJsZSAmJiBoYW5kbGVyLnVwbG9hZFJvdyAmJiBoYW5kbGVyLnVwbG9hZFJvdy5sZW5ndGggJiYKICAgICAgICAgICAgICAgICAgICAoIWRvd25sb2FkVGFibGUgfHwgdXBsb2FkVGFibGUuZ2V0KDApID09PSBkb3dubG9hZFRhYmxlLmdldCgwKSkpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIucmVwbGFjZU5vZGUoaGFuZGxlci51cGxvYWRSb3csIGhhbmRsZXIuZG93bmxvYWRSb3csIGNhbGxCYWNrKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIucmVtb3ZlTm9kZShoYW5kbGVyLnVwbG9hZFJvdywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuYWRkTm9kZSgKICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRUYWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5kb3dubG9hZFJvdywKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2sKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmRyb3Bab25lRW5sYXJnZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCFpc0Ryb3Bab25lRW5sYXJnZWQpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5zd2l0Y2hDbGFzcyA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZHJvcFpvbmUuc3dpdGNoQ2xhc3MoCiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuY3NzQ2xhc3NTbWFsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5jc3NDbGFzc0xhcmdlCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5hZGRDbGFzcyh1cGxvYWRIYW5kbGVyLmNzc0NsYXNzTGFyZ2UpOwogICAgICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZHJvcFpvbmUucmVtb3ZlQ2xhc3ModXBsb2FkSGFuZGxlci5jc3NDbGFzc1NtYWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlzRHJvcFpvbmVFbmxhcmdlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMuZHJvcFpvbmVSZWR1Y2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5zd2l0Y2hDbGFzcyA9PT0gZnVuYykgewogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5zd2l0Y2hDbGFzcygKICAgICAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmNzc0NsYXNzTGFyZ2UsCiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5jc3NDbGFzc1NtYWxsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5hZGRDbGFzcyh1cGxvYWRIYW5kbGVyLmNzc0NsYXNzU21hbGwpOwogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5yZW1vdmVDbGFzcyh1cGxvYWRIYW5kbGVyLmNzc0NsYXNzTGFyZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlzRHJvcFpvbmVFbmxhcmdlZCA9IGZhbHNlOwogICAgICAgIH07CgogICAgICAgIHRoaXMub25Eb2N1bWVudERyYWdFbnRlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmRyb3Bab25lRW5sYXJnZSgpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5vbkRvY3VtZW50RHJhZ092ZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGRyYWdPdmVyVGltZW91dCkgewogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGRyYWdPdmVyVGltZW91dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZHJhZ092ZXJUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmRyb3Bab25lUmVkdWNlKCk7CiAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLm9uRHJhZ0VudGVyID0gdGhpcy5vbkRyYWdMZWF2ZSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmRyb3Bab25lLnRvZ2dsZUNsYXNzKHVwbG9hZEhhbmRsZXIuY3NzQ2xhc3NIaWdobGlnaHQpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5vbkRyb3AgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGRyYWdPdmVyVGltZW91dCkgewogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGRyYWdPdmVyVGltZW91dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVwbG9hZEhhbmRsZXIuZHJvcEVmZmVjdCAmJiB0eXBlb2YgdXBsb2FkSGFuZGxlci5kcm9wWm9uZS5lZmZlY3QgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZHJvcFpvbmUuZWZmZWN0KHVwbG9hZEhhbmRsZXIuZHJvcEVmZmVjdCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZHJvcFpvbmUucmVtb3ZlQ2xhc3ModXBsb2FkSGFuZGxlci5jc3NDbGFzc0hpZ2hsaWdodCk7CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kcm9wWm9uZVJlZHVjZSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmRyb3Bab25lLnJlbW92ZUNsYXNzKHVwbG9hZEhhbmRsZXIuY3NzQ2xhc3NIaWdobGlnaHQpOwogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kcm9wWm9uZVJlZHVjZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmluaXRQcm9ncmVzc0JhckFsbCgpOwogICAgICAgICAgICBpZiAodHlwZW9mIHVwbG9hZEhhbmRsZXIuaW5pdEV4dGVuZGVkID09PSBmdW5jKSB7CiAgICAgICAgICAgICAgICB1cGxvYWRIYW5kbGVyLmluaXRFeHRlbmRlZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdXBsb2FkSGFuZGxlci5kZXN0cm95RXh0ZW5kZWQgPT09IGZ1bmMpIHsKICAgICAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZGVzdHJveUV4dGVuZGVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kZXN0cm95UHJvZ3Jlc3NCYXJBbGwoKTsKICAgICAgICB9OwoKICAgICAgICAkLmV4dGVuZCh0aGlzLCBvcHRpb25zKTsKICAgIH07CgogICAgbWV0aG9kcyA9IHsKICAgICAgICBpbml0IDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbGVVcGxvYWQobmV3IFVwbG9hZEhhbmRsZXIoJCh0aGlzKSwgb3B0aW9ucykpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIG9wdGlvbjogZnVuY3Rpb24gKG9wdGlvbiwgdmFsdWUsIG5hbWVzcGFjZSkgewogICAgICAgICAgICBpZiAoIW9wdGlvbiB8fCAodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHZhbHVlID09PSB1bmRlZikpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmZpbGVVcGxvYWQoJ29wdGlvbicsIG9wdGlvbiwgdmFsdWUsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbGVVcGxvYWQoJ29wdGlvbicsIG9wdGlvbiwgdmFsdWUsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgIGRlc3Ryb3kgOiBmdW5jdGlvbiAobmFtZXNwYWNlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCh0aGlzKS5maWxlVXBsb2FkKCdkZXN0cm95JywgbmFtZXNwYWNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICB1cGxvYWQ6IGZ1bmN0aW9uIChmaWxlcywgbmFtZXNwYWNlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCh0aGlzKS5maWxlVXBsb2FkKCd1cGxvYWQnLCBmaWxlcywgbmFtZXNwYWNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgJC5mbi5maWxlVXBsb2FkVUkgPSBmdW5jdGlvbiAobWV0aG9kKSB7CiAgICAgICAgaWYgKG1ldGhvZHNbbWV0aG9kXSkgewogICAgICAgICAgICByZXR1cm4gbWV0aG9kc1ttZXRob2RdLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ29iamVjdCcgfHwgIW1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJC5lcnJvcignTWV0aG9kICInICsgbWV0aG9kICsgJyIgZG9lcyBub3QgZXhpc3Qgb24galF1ZXJ5LmZpbGVVcGxvYWRVSScpOwogICAgICAgIH0KICAgIH07CiAgICAKfShqUXVlcnkpKTsKCgovKgogKiBqUXVlcnkgRmlsZSBVcGxvYWQgVXNlciBJbnRlcmZhY2UgRXh0ZW5kZWQgUGx1Z2luIDQuNgogKiBodHRwczovL2dpdGh1Yi5jb20vYmx1ZWltcC9qUXVlcnktRmlsZS1VcGxvYWQKICoKICogQ29weXJpZ2h0IDIwMTAsIFNlYmFzdGlhbiBUc2NoYW4KICogaHR0cHM6Ly9ibHVlaW1wLm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2U6CiAqIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL01JVC8KICovCgovKmpzbGludCByZWdleHA6IGZhbHNlLCB1bnBhcmFtOiB0cnVlICovCi8qZ2xvYmFsIGpRdWVyeSAqLwoKKGZ1bmN0aW9uICgkKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgdmFyIFVwbG9hZEhhbmRsZXIsCiAgICAgICAgbWV0aG9kczsKCiAgICAvLyBFbXVsYXRlIGpRdWVyeSBVSSBidXR0b24gKHdpdGhvdXQgc3RhdGVzKSBpZiBub3QgYXZhaWxhYmxlOgogICAgaWYgKHR5cGVvZiAkKCkuYnV0dG9uICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgJC5mbi5idXR0b24gPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zID09PSAnZGVzdHJveScpIHsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKAogICAgICAgICAgICAgICAgICAgICAgICAndWktYnV0dG9uIHVpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgdWktYnV0dG9uLWljb24tb25seSB1aS1idXR0b24tdGV4dC1pY29uLXByaW1hcnknCiAgICAgICAgICAgICAgICAgICAgKS5odG1sKCQodGhpcykudGV4dCgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3VpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy50ZXh0ID09PSBmYWxzZSA/ICd1aS1idXR0b24taWNvbi1vbmx5JyA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VpLWJ1dHRvbi10ZXh0LWljb24tcHJpbWFyeScKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAuaHRtbCgkKCc8c3BhbiBjbGFzcz0idWktYnV0dG9uLXRleHQiLz4nKS50ZXh0KCQodGhpcykudGV4dCgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgLnByZXBlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8c3BhbiBjbGFzcz0idWktYnV0dG9uLWljb24tcHJpbWFyeSB1aS1pY29uIi8+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5pY29ucy5wcmltYXJ5KQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfQogICAgICAgIAogICAgVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uIChjb250YWluZXIsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgdXBsb2FkSGFuZGxlciA9IHRoaXM7CgogICAgICAgIHRoaXMubG9jYWxlID0ge307CiAgICAgICAgdGhpcy5tYXhGaWxlU2l6ZSA9IG51bGw7CiAgICAgICAgdGhpcy5taW5GaWxlU2l6ZSA9IDE7CiAgICAgICAgdGhpcy5tYXhOdW1iZXJPZkZpbGVzID0gbnVsbDsKICAgICAgICB0aGlzLmFjY2VwdEZpbGVUeXBlcyA9IC8uKyQvaTsKICAgICAgICB0aGlzLmF1dG9VcGxvYWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmZvcmNlSWZyYW1lRG93bmxvYWQgPSB0cnVlOwogICAgICAgIHRoaXMudXJsID0gY29udGFpbmVyLmZpbmQoJ2Zvcm06Zmlyc3QnKS5hdHRyKCdhY3Rpb24nKTsKICAgICAgICB0aGlzLmRyb3Bab25lID0gY29udGFpbmVyLmZpbmQoJ2Zvcm06Zmlyc3QnKTsKICAgICAgICB0aGlzLnVwbG9hZFRhYmxlID0gY29udGFpbmVyLmZpbmQoJy5maWxlczpmaXJzdCcpOwogICAgICAgIHRoaXMuZG93bmxvYWRUYWJsZSA9IHRoaXMudXBsb2FkVGFibGU7CiAgICAgICAgdGhpcy5wcm9ncmVzc0FsbE5vZGUgPSBjb250YWluZXIuZmluZCgnLmZpbGVfdXBsb2FkX292ZXJhbGxfcHJvZ3Jlc3MgZGl2OmZpcnN0Jyk7CiAgICAgICAgdGhpcy51cGxvYWRUZW1wbGF0ZSA9IHRoaXMudXBsb2FkVGFibGUuZmluZCgnLmZpbGVfdXBsb2FkX3RlbXBsYXRlOmZpcnN0Jyk7CiAgICAgICAgdGhpcy5kb3dubG9hZFRlbXBsYXRlID0gdGhpcy51cGxvYWRUYWJsZS5maW5kKCcuZmlsZV9kb3dubG9hZF90ZW1wbGF0ZTpmaXJzdCcpOwogICAgICAgIHRoaXMubXVsdGlCdXR0b25zID0gY29udGFpbmVyLmZpbmQoJy5maWxlX3VwbG9hZF9idXR0b25zOmZpcnN0Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5hZGp1c3RNYXhOdW1iZXJPZkZpbGVzID0gZnVuY3Rpb24gKG9wZXJhbmQpIHsKICAgICAgICAgICAgdmFyIG51bWJlciA9IGNvbnRhaW5lci5maWxlVXBsb2FkVUlYKCdvcHRpb24nLCAnbWF4TnVtYmVyT2ZGaWxlcycpOwogICAgICAgICAgICBpZiAodHlwZW9mIG51bWJlciA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maWxlVXBsb2FkVUlYKCdvcHRpb24nLCAnbWF4TnVtYmVyT2ZGaWxlcycsIG51bWJlciArIG9wZXJhbmQpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmZvcm1hdEZpbGVTaXplID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgYnl0ZXMgIT09ICdudW1iZXInIHx8IGJ5dGVzID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJ5dGVzID49IDEwMDAwMDAwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAoYnl0ZXMgLyAxMDAwMDAwMDAwKS50b0ZpeGVkKDIpICsgJyBHQic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJ5dGVzID49IDEwMDAwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAoYnl0ZXMgLyAxMDAwMDAwKS50b0ZpeGVkKDIpICsgJyBNQic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChieXRlcyAvIDEwMDApLnRvRml4ZWQoMikgKyAnIEtCJzsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMuZm9ybWF0RmlsZU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gJyc7CiAgICAgICAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoL14uKltcL1xcXS8sICcnKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMuZW5hYmxlRHJhZ1RvRGVza3RvcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGxpbmsgPSAkKHRoaXMpLAogICAgICAgICAgICAgICAgdXJsID0gbGluay5nZXQoMCkuaHJlZiwKICAgICAgICAgICAgICAgIG5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQodXJsLnNwbGl0KCcvJykucG9wKCkpLnJlcGxhY2UoLzovZywgJy0nKSwKICAgICAgICAgICAgICAgIHR5cGUgPSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJzsKICAgICAgICAgICAgbGluay5iaW5kKCdkcmFnc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIKICAgICAgICAgICAgICAgICAgICAgICAgLnNldERhdGEoJ0Rvd25sb2FkVVJMJywgW3R5cGUsIG5hbWUsIHVybF0uam9pbignOicpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHRoaXMuYnVpbGRNdWx0aVVwbG9hZFJvdyA9IGZ1bmN0aW9uIChmaWxlcywgaGFuZGxlcikgewogICAgICAgICAgICB2YXIgcm93cyA9ICQoJzx0Ym9keSBzdHlsZT0iZGlzcGxheTpub25lOyIvPicpOwogICAgICAgICAgICAkLmVhY2goZmlsZXMsIGZ1bmN0aW9uIChpbmRleCwgZmlsZSkgewogICAgICAgICAgICAgICAgdmFyIHJvdyA9IGhhbmRsZXIuYnVpbGRVcGxvYWRSb3coZmlsZXMsIGluZGV4LCBoYW5kbGVyKS5zaG93KCksCiAgICAgICAgICAgICAgICAgICAgY2VsbHMgPSByb3cuZmluZCgKICAgICAgICAgICAgICAgICAgICAgICAgJy5maWxlX3VwbG9hZF9wcm9ncmVzcywgLmZpbGVfdXBsb2FkX3N0YXJ0LCAuZmlsZV91cGxvYWRfY2FuY2VsJwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjZWxscy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2VsbHMuYXR0cigncm93c3BhbicsIGZpbGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByb3dzLmFwcGVuZChyb3cpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJvd3M7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5idWlsZFVwbG9hZFJvdyA9IGZ1bmN0aW9uIChmaWxlcywgaW5kZXgsIGhhbmRsZXIpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmRleCAhPT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmJ1aWxkTXVsdGlVcGxvYWRSb3coZmlsZXMsIGhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBmaWxlID0gZmlsZXNbaW5kZXhdLAogICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBoYW5kbGVyLmZvcm1hdEZpbGVOYW1lKGZpbGUubmFtZSksCiAgICAgICAgICAgICAgICB1cGxvYWRSb3cgPSBoYW5kbGVyLnVwbG9hZFRlbXBsYXRlCiAgICAgICAgICAgICAgICAgICAgLmNsb25lKCkucmVtb3ZlQXR0cignaWQnKTsKICAgICAgICAgICAgdXBsb2FkUm93LmZpbmQoJy5maWxlX25hbWUnKQogICAgICAgICAgICAgICAgLnRleHQoZmlsZU5hbWUpOwogICAgICAgICAgICB1cGxvYWRSb3cuZmluZCgnLmZpbGVfc2l6ZScpCiAgICAgICAgICAgICAgICAudGV4dChoYW5kbGVyLmZvcm1hdEZpbGVTaXplKGZpbGUuc2l6ZSkpOwogICAgICAgICAgICBpZiAoaGFuZGxlci5hdXRvVXBsb2FkKSB7CiAgICAgICAgICAgICAgICB1cGxvYWRSb3cuZmluZCgnLmZpbGVfdXBsb2FkX3N0YXJ0IGJ1dHRvbicpLmhpZGUoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVwbG9hZFJvdy5maW5kKCcuZmlsZV91cGxvYWRfc3RhcnQgYnV0dG9uJykKICAgICAgICAgICAgICAgICAgICAuYnV0dG9uKHtpY29uczoge3ByaW1hcnk6ICd1aS1pY29uLWNpcmNsZS1hcnJvdy1lJ30sIHRleHQ6IGZhbHNlfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBsb2FkUm93LmZpbmQoJy5maWxlX3VwbG9hZF9jYW5jZWwgYnV0dG9uJykKICAgICAgICAgICAgICAgIC5idXR0b24oe2ljb25zOiB7cHJpbWFyeTogJ3VpLWljb24tY2FuY2VsJ30sIHRleHQ6IGZhbHNlfSk7CiAgICAgICAgICAgIHJldHVybiB1cGxvYWRSb3c7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5nZXRGaWxlVXJsID0gZnVuY3Rpb24gKGZpbGUsIGhhbmRsZXIpIHsKICAgICAgICAgICAgcmV0dXJuIGZpbGUudXJsOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5nZXRUaHVtYm5haWxVcmwgPSBmdW5jdGlvbiAoZmlsZSwgaGFuZGxlcikgewogICAgICAgICAgICByZXR1cm4gZmlsZS50aHVtYm5haWw7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5idWlsZE11bHRpRG93bmxvYWRSb3cgPSBmdW5jdGlvbiAoZmlsZXMsIGhhbmRsZXIpIHsKICAgICAgICAgICAgdmFyIHJvd3MgPSAkKCc8dGJvZHkgc3R5bGU9ImRpc3BsYXk6bm9uZTsiLz4nKTsKICAgICAgICAgICAgJC5lYWNoKGZpbGVzLCBmdW5jdGlvbiAoaW5kZXgsIGZpbGUpIHsKICAgICAgICAgICAgICAgIHJvd3MuYXBwZW5kKGhhbmRsZXIuYnVpbGREb3dubG9hZFJvdyhmaWxlLCBoYW5kbGVyKS5zaG93KCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJvd3M7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5idWlsZERvd25sb2FkUm93ID0gZnVuY3Rpb24gKGZpbGUsIGhhbmRsZXIpIHsKICAgICAgICAgICAgaWYgKCQuaXNBcnJheShmaWxlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuYnVpbGRNdWx0aURvd25sb2FkUm93KGZpbGUsIGhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBmaWxlTmFtZSA9IGhhbmRsZXIuZm9ybWF0RmlsZU5hbWUoZmlsZS5uYW1lKSwKICAgICAgICAgICAgICAgIGZpbGVVcmwgPSBoYW5kbGVyLmdldEZpbGVVcmwoZmlsZSwgaGFuZGxlciksCiAgICAgICAgICAgICAgICB0aHVtYm5haWxVcmwgPSBoYW5kbGVyLmdldFRodW1ibmFpbFVybChmaWxlLCBoYW5kbGVyKSwKICAgICAgICAgICAgICAgIGRvd25sb2FkUm93ID0gaGFuZGxlci5kb3dubG9hZFRlbXBsYXRlCiAgICAgICAgICAgICAgICAgICAgLmNsb25lKCkucmVtb3ZlQXR0cignaWQnKTsKICAgICAgICAgICAgZG93bmxvYWRSb3cuYXR0cignZGF0YS1pZCcsIGZpbGUuaWQgfHwgZmlsZS5uYW1lKTsKICAgICAgICAgICAgZG93bmxvYWRSb3cuZmluZCgnLmZpbGVfbmFtZSBhJykKICAgICAgICAgICAgICAgIC50ZXh0KGZpbGVOYW1lKTsKICAgICAgICAgICAgZG93bmxvYWRSb3cuZmluZCgnLmZpbGVfc2l6ZScpCiAgICAgICAgICAgICAgICAudGV4dChoYW5kbGVyLmZvcm1hdEZpbGVTaXplKGZpbGUuc2l6ZSkpOwogICAgICAgICAgICBpZiAodGh1bWJuYWlsVXJsKSB7CiAgICAgICAgICAgICAgICBkb3dubG9hZFJvdy5maW5kKCcuZmlsZV9kb3dubG9hZF9wcmV2aWV3JykuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxhLz4nKS5hcHBlbmQoJCgnPGltZy8+JykuYXR0cignc3JjJywgdGh1bWJuYWlsVXJsKSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkb3dubG9hZFJvdy5maW5kKCdhJykuYXR0cigndGFyZ2V0JywgJ19ibGFuaycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvd25sb2FkUm93LmZpbmQoJ2EnKQogICAgICAgICAgICAgICAgLmF0dHIoJ2hyZWYnLCBmaWxlVXJsIHx8IG51bGwpCiAgICAgICAgICAgICAgICAuZWFjaChoYW5kbGVyLmVuYWJsZURyYWdUb0Rlc2t0b3ApOwogICAgICAgICAgICBkb3dubG9hZFJvdy5maW5kKCcuZmlsZV9kb3dubG9hZF9kZWxldGUgYnV0dG9uJykKICAgICAgICAgICAgICAgIC5idXR0b24oe2ljb25zOiB7cHJpbWFyeTogJ3VpLWljb24tdHJhc2gnfSwgdGV4dDogZmFsc2V9KTsKICAgICAgICAgICAgcmV0dXJuIGRvd25sb2FkUm93OwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5vbkVycm9yID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlcikgewogICAgICAgICAgICBoYW5kbGVyLnVwbG9hZFJvdy5hZGRDbGFzcygnZmlsZV91cGxvYWRfZXJyb3InKQogICAgICAgICAgICAgICAgLmZpbmQoJy5maWxlX3VwbG9hZF9wcm9ncmVzcycpLmFwcGVuZCgkKCc8ZGl2IGNsYXNzPSJlcnJvciIvPicpLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmxvY2FsZVtldmVudF0gfHwgZXZlbnQKICAgICAgICAgICAgICAgICkpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy52YWxpZGF0ZSA9IGZ1bmN0aW9uIChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpIHsKICAgICAgICAgICAgdmFyIGlzVmFsaWQgPSB0cnVlLAogICAgICAgICAgICAgICAgZmlsZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmRleCAhPT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgICQuZWFjaChmaWxlcywgZnVuY3Rpb24gKGluZGV4LCBmaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IGhhbmRsZXIudmFsaWRhdGUoZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZmlsZSA9IGZpbGVzW2luZGV4XTsKICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLm1heEZpbGVTaXplICYmIGZpbGUuc2l6ZSA+IGhhbmRsZXIubWF4RmlsZVNpemUpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm9uRXJyb3IoJ0ZpbGUgaXMgdG9vIGJpZycsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaWxlLnNpemUgPT09ICdudW1iZXInICYmIGZpbGUuc2l6ZSA8IGhhbmRsZXIubWluRmlsZVNpemUpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm9uRXJyb3IoJ0ZpbGUgaXMgdG9vIHNtYWxsJywgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpOwogICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghKGhhbmRsZXIuYWNjZXB0RmlsZVR5cGVzLnRlc3QoZmlsZS50eXBlKSB8fAogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmFjY2VwdEZpbGVUeXBlcy50ZXN0KGZpbGUubmFtZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5vbkVycm9yKCdGaWxldHlwZSBub3QgYWxsb3dlZCcsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIubWF4TnVtYmVyT2ZGaWxlcyA9PT0gJ251bWJlcicgJiYKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5tYXhOdW1iZXJPZkZpbGVzIDwgaW5kZXggKyAxKSB7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5vbkVycm9yKCdNYXggbnVtYmVyIGV4Y2VlZGVkJywgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpOwogICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaXNWYWxpZDsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnVwbG9hZENhbGxCYWNrID0gZnVuY3Rpb24gKGV2ZW50LCBmaWxlcywgaW5kZXgsIHhociwgaGFuZGxlciwgY2FsbEJhY2spIHsKICAgICAgICAgICAgY2FsbEJhY2soKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMuYmVmb3JlU2VuZCA9IGZ1bmN0aW9uIChldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIsIGNhbGxCYWNrKSB7CiAgICAgICAgICAgIGlmICghaGFuZGxlci52YWxpZGF0ZShldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG51bWJlciA9IHR5cGVvZiBpbmRleCA9PT0gJ251bWJlcicgPyAxIDogZmlsZXMubGVuZ3RoOwogICAgICAgICAgICBoYW5kbGVyLmFkanVzdE1heE51bWJlck9mRmlsZXMoLW51bWJlcik7CiAgICAgICAgICAgIGhhbmRsZXIudXBsb2FkUm93LmZpbmQoaGFuZGxlci5jYW5jZWxTZWxlY3RvcikuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIuYWRqdXN0TWF4TnVtYmVyT2ZGaWxlcyhudW1iZXIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGhhbmRsZXIuYXV0b1VwbG9hZCkgewogICAgICAgICAgICAgICAgaGFuZGxlci51cGxvYWRDYWxsQmFjayhldmVudCwgZmlsZXMsIGluZGV4LCB4aHIsIGhhbmRsZXIsIGNhbGxCYWNrKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIudXBsb2FkUm93LmZpbmQoJy5maWxlX3VwbG9hZF9zdGFydCBidXR0b24nKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICQodGhpcykuZmFkZU91dCgpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIudXBsb2FkQ2FsbEJhY2soZXZlbnQsIGZpbGVzLCBpbmRleCwgeGhyLCBoYW5kbGVyLCBjYWxsQmFjayk7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmRvd25sb2FkSGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmICh1cGxvYWRIYW5kbGVyLmZvcmNlSWZyYW1lRG93bmxvYWQpIHsKICAgICAgICAgICAgICAgIC8vIE9wZW4gZG93bmxvYWQgZGlhbG9ncyB2aWEgaWZyYW1lcywgdG8gcHJldmVudCBhYm9ydGluZyBjdXJyZW50IHVwbG9hZHM6CiAgICAgICAgICAgICAgICAkKCc8aWZyYW1lIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ii8+JykKICAgICAgICAgICAgICAgICAgICAuYXR0cignc3JjJywgdGhpcy5ocmVmKQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpOwogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5kZWxldGVIYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHJvdyA9ICQodGhpcykuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogdXBsb2FkSGFuZGxlci51cmwgKyAnP2ZpbGU9JyArIGVuY29kZVVSSUNvbXBvbmVudCgKICAgICAgICAgICAgICAgICAgICByb3cuYXR0cignZGF0YS1pZCcpCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5hZGp1c3RNYXhOdW1iZXJPZkZpbGVzKDEpOwogICAgICAgICAgICAgICAgICAgIHJvdy5mYWRlT3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcm93LnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5pbml0RXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kb3dubG9hZFRhYmxlLmZpbmQoJ2E6bm90KFt0YXJnZXQ9Il9ibGFuayJdKScpCiAgICAgICAgICAgICAgICAubGl2ZSgnY2xpY2snLCB1cGxvYWRIYW5kbGVyLmRvd25sb2FkSGFuZGxlcik7CiAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZG93bmxvYWRUYWJsZS5maW5kKCcuZmlsZV9kb3dubG9hZF9kZWxldGUgYnV0dG9uJykKICAgICAgICAgICAgICAgIC5saXZlKCdjbGljaycsIHVwbG9hZEhhbmRsZXIuZGVsZXRlSGFuZGxlcik7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5kZXN0cm95RXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kb3dubG9hZFRhYmxlLmZpbmQoJ2E6bm90KFt0YXJnZXQ9Il9ibGFuayJdKScpCiAgICAgICAgICAgICAgICAuZGllKCdjbGljaycsIHVwbG9hZEhhbmRsZXIuZG93bmxvYWRIYW5kbGVyKTsKICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kb3dubG9hZFRhYmxlLmZpbmQoJy5maWxlX2Rvd25sb2FkX2RlbGV0ZSBidXR0b24nKQogICAgICAgICAgICAgICAgLmRpZSgnY2xpY2snLCB1cGxvYWRIYW5kbGVyLmRlbGV0ZUhhbmRsZXIpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdGhpcy5tdWx0aUJ1dHRvbkhhbmRsZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB1cGxvYWRIYW5kbGVyLnVwbG9hZFRhYmxlLmZpbmQoZS5kYXRhLnNlbGVjdG9yICsgJyBidXR0b246dmlzaWJsZScpLmNsaWNrKCk7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHRoaXMuaW5pdE11bHRpQnV0dG9ucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHVwbG9hZEhhbmRsZXIuYXV0b1VwbG9hZCkgewogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5tdWx0aUJ1dHRvbnMuZmluZCgnLmZpbGVfdXBsb2FkX3N0YXJ0OmZpcnN0JykuaGlkZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5tdWx0aUJ1dHRvbnMuZmluZCgnLmZpbGVfdXBsb2FkX3N0YXJ0OmZpcnN0JykKICAgICAgICAgICAgICAgICAgICAuYnV0dG9uKHtpY29uczoge3ByaW1hcnk6ICd1aS1pY29uLWNpcmNsZS1hcnJvdy1lJ319KQogICAgICAgICAgICAgICAgICAgIC5iaW5kKCdjbGljaycsIHtzZWxlY3RvcjogJy5maWxlX3VwbG9hZF9zdGFydCd9LCB1cGxvYWRIYW5kbGVyLm11bHRpQnV0dG9uSGFuZGxlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5tdWx0aUJ1dHRvbnMuZmluZCgnLmZpbGVfdXBsb2FkX2NhbmNlbDpmaXJzdCcpCiAgICAgICAgICAgICAgICAuYnV0dG9uKHtpY29uczoge3ByaW1hcnk6ICd1aS1pY29uLWNhbmNlbCd9fSkKICAgICAgICAgICAgICAgIC5iaW5kKCdjbGljaycsIHtzZWxlY3RvcjogJy5maWxlX3VwbG9hZF9jYW5jZWwnfSwgdXBsb2FkSGFuZGxlci5tdWx0aUJ1dHRvbkhhbmRsZXIpOwogICAgICAgICAgICB1cGxvYWRIYW5kbGVyLm11bHRpQnV0dG9ucy5maW5kKCcuZmlsZV9kb3dubG9hZF9kZWxldGU6Zmlyc3QnKQogICAgICAgICAgICAgICAgLmJ1dHRvbih7aWNvbnM6IHtwcmltYXJ5OiAndWktaWNvbi10cmFzaCd9fSkKICAgICAgICAgICAgICAgIC5iaW5kKCdjbGljaycsIHtzZWxlY3RvcjogJy5maWxlX2Rvd25sb2FkX2RlbGV0ZSd9LCB1cGxvYWRIYW5kbGVyLm11bHRpQnV0dG9uSGFuZGxlcik7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB0aGlzLmRlc3Ryb3lNdWx0aUJ1dHRvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIubXVsdGlCdXR0b25zLmZpbmQoCiAgICAgICAgICAgICAgICAnLmZpbGVfdXBsb2FkX3N0YXJ0OmZpcnN0LCAuZmlsZV91cGxvYWRfY2FuY2VsOmZpcnN0LCAuZmlsZV9kb3dubG9hZF9kZWxldGU6Zmlyc3QnCiAgICAgICAgICAgICkudW5iaW5kKCdjbGljaycsIHVwbG9hZEhhbmRsZXIubXVsdGlCdXR0b25IYW5kbGVyKS5idXR0b24oJ2Rlc3Ryb3knKS5zaG93KCk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0RXh0ZW5kZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuaW5pdEV2ZW50SGFuZGxlcnMoKTsKICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5pbml0TXVsdGlCdXR0b25zKCk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5kZXN0cm95RXh0ZW5kZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHVwbG9hZEhhbmRsZXIuZGVzdHJveUV2ZW50SGFuZGxlcnMoKTsKICAgICAgICAgICAgdXBsb2FkSGFuZGxlci5kZXN0cm95TXVsdGlCdXR0b25zKCk7CiAgICAgICAgfTsKCiAgICAgICAgJC5leHRlbmQodGhpcywgb3B0aW9ucyk7CiAgICB9OwoKICAgIG1ldGhvZHMgPSB7CiAgICAgICAgaW5pdCA6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCh0aGlzKS5maWxlVXBsb2FkVUkobmV3IFVwbG9hZEhhbmRsZXIoJCh0aGlzKSwgb3B0aW9ucykpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIG9wdGlvbjogZnVuY3Rpb24gKG9wdGlvbiwgdmFsdWUsIG5hbWVzcGFjZSkgewogICAgICAgICAgICBpZiAoIW9wdGlvbiB8fCAodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmZpbGVVcGxvYWQoJ29wdGlvbicsIG9wdGlvbiwgdmFsdWUsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbGVVcGxvYWRVSSgnb3B0aW9uJywgb3B0aW9uLCB2YWx1ZSwgbmFtZXNwYWNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgZGVzdHJveSA6IGZ1bmN0aW9uIChuYW1lc3BhY2UpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbGVVcGxvYWRVSSgnZGVzdHJveScsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgdXBsb2FkOiBmdW5jdGlvbiAoZmlsZXMsIG5hbWVzcGFjZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQodGhpcykuZmlsZVVwbG9hZFVJKCd1cGxvYWQnLCBmaWxlcywgbmFtZXNwYWNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgJC5mbi5maWxlVXBsb2FkVUlYID0gZnVuY3Rpb24gKG1ldGhvZCkgewogICAgICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHsKICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICFtZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQuZXJyb3IoJ01ldGhvZCAiJyArIG1ldGhvZCArICciIGRvZXMgbm90IGV4aXN0IG9uIGpRdWVyeS5maWxlVXBsb2FkVUlYJyk7CiAgICAgICAgfQogICAgfTsKICAgIAp9KGpRdWVyeSkpOwo=]]></Resource>
  </Resources>
  <SourceCode><![CDATA[

#!/usr/bin/env python

import re

from xml.dom.minidom import parseString

from utils.csrf import create_csrf_token, csrf_token_arg_name


# RegExp to remove <script> section in XML
RE_REMOVE_SCRIPT = re.compile(r"(?si)<(script)[^<>]*>.*?</\1>")

# Placeholder for default value
_DEFAULT = []

# Boolean values map
BOOL_MAP = {
    "0": False,
    "false": False,
    "1": True,
    "true": True
}

# Sort by key lambda function
sort_by_key = lambda pair: pair[0]

# Sort by value lambda function
sort_by_val = lambda pair: pair[1]

# Sorting map
SORT_MAP = {
    "0": "default",
    "1": sort_by_key,
    "2": sort_by_val,
    "key": sort_by_key,
    "value": sort_by_val
}

# Sorting order map
SORT_ORDER_MAP = {
    "0": "default",
    "1": "asc",
    "2": "desc",
    "asc": "asc",
    "desc": "desc"
}

# Components CSS classes map
COMPONENTS_CSS_MAP = {
    "heading" : "heading",
    "textbox" : "textbox",
    "password" : "password",
    "dropdown" : "dropdown",
    "radiobutton" : "radio",
    "checkbox" : "checkbox",
    "textarea" : "textarea",
    "hypertext" : "hypertext",
    "button" : "button",
    "container": "container",
    "livesearch": "livesearch",
    "richtextarea": "richtextarea",
    "fileupload" : "fileupload",
    "codeeditor": "codeeditor",
}


def on_compile(application, object, action_name, context, objects):
    """
    """
    return [{"object": xobject} for xobject in object.get_objects_list()]


def set_attr(app_id, object_id, param):
    """
    """
    if "xmldata" in param:
        obj = application.objects.search(object_id)
        
        attr = (param["xmldata"]["value"]).replace('<![CDATA[', '<!--[CDATA[')
        obj.attributes.xmldata = attr.replace(']'+']>', ']]-->')

    return ""


def parse_int(value, default):
    """
    Parse str to int
    """
    try:
        return int(value)

    except Exception:
        return default


def to_bool(value, default):
    """
    Convert string value to boolean
    """
    return BOOL_MAP.get(value, default)


def escape_quote(text):
    """
    Quote escape
    """
    return text.replace('"', '&quot;')


def get_elem_attr(elem, attr, default):
    """
    Return attribute of element
    """
    value = elem.getAttribute(attr.lower()).strip()
    if not value:
        return default

    if isinstance(default, bool):
        value = BOOL_MAP.get(value, default)

    return value


def get_elem_attrs(elem):
    """
    Return dictionary of element attributes
    """
    return {attr.lower(): value for attr, value in elem.attributes.items()}


def get_elem_props(elem):
    """
    Return dictionary of element Property section
    """
    props = {}

    properties = None
    for child in elem.childNodes:
        if child .nodeType == child.ELEMENT_NODE and \
           child.localName.lower() == "properties":
            
            properties = child
            break

    if not properties:
        return props

    is_property_node = lambda node: node.nodeType == node.ELEMENT_NODE and \
                                    node.localName == 'Property' and \
                                    node.childNodes

    for node in properties.childNodes:
        if not is_property_node(node):
            continue

        name = get_elem_attr(node, "name", "").lower()
        if name == "options":
            data = [child for child in node.childNodes if child.nodeType == child.ELEMENT_NODE]

        else:
            data = node.childNodes[0].nodeValue.strip()

        if data and name:
            props[name] = data

    return props


def is_disabled(elem):
    """
    Check is element disabled or not
    """
    return u"""disabled="disabled\"""" if get_elem_attr(elem, "disabled", False) else u""


def is_readonly(elem):
    """
    Check is element readonly or not
    """
    return u"""readonly="readonly\"""" if get_elem_attr(elem, "readonly", False) else u""


def is_multiple(elem):
    """
    Check is element readonly or not
    """
    return u"""multiple="multiple\"""" if get_elem_attr(elem, "multiple", False) else u""


def is_visible(elem):
    """
    Check element's visibility
    """
    return u"" if get_elem_attr(elem, "visible", True) else u"""style="display: none\""""


def is_fullsize(elem):
    """
    Check is element fullsize or not
    """
    return "fullsize" if get_elem_attr(elem, "fullsize", False) else u""


def get_elem_options(options):
    """
    Get Options section of elemet
    """
    if not options:
        return []

    result = []
    for option in options:
        key = get_elem_attr(option, "id", "")
        value = option.childNodes[0].nodeValue.strip()

        if key and value:
            result.append((key, value))

    return result
    

def make_div_row(html, elem, label):
    """
    Wraps HTML data to DIV
    """
    return (u"""<div class="row {fullsize} {classes}" {visibility}>"""
            u"""<label class="title">{label}</label>"""
            u"""<div class="item {elem_type}">{html}</div>"""
            u"""<br style="clear: both" />"""
            u"""</div>""").format(
                fullsize=is_fullsize(elem),
                classes=get_elem_attr(elem, "class", ""),
                visibility=is_visible(elem),
                label=label,
                elem_type=COMPONENTS_CSS_MAP[elem.localName.lower()],
                html=html
            ) 


def render_heading(elem):
    """
    Render Heading component

    Example:

    <Heading id='headingName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 level='1 | 2 | 3 | 4 | 5 | 6'>

        <Properties>
            <Property name='text'><!--[CDATA[Heading text]]--></Property>
        </Properties>
    </Heading>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    level = parse_int(attrs.get("level", "3"), 3)
    if not (6 >= level >= 1):
        level = 3

    return u"""<h{level} class="{classes}" id="{attr_id}" {visibility}>{text}</h{level}>""".format(
        attr_id=escape_quote(attrs.get("id", "")),
        classes=attrs.get("class", ""),
        level=level,
        text=props.get("text", ""),
        visibility=is_visible(elem),
    )

    return html


def render_textbox(elem):
    """
    Render TextBox component

    Example:

    <TextBox id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Label]]--></Property>
            <Property name='defaultValue'><!--[CDATA[Test]]--></Property>
        </Properties>
    </TextBox>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    html = u"""<input type="text" name="{attr_id}" value="{value}" {disabled} {readonly} />""".format(
        attr_id=escape_quote(attrs.get("id", "")),
        value=escape_quote(props.get("defaultvalue", "")),
        disabled=is_disabled(elem),
        readonly=is_readonly(elem)
    )

    return make_div_row(html, elem, props.get("label", ""))


def render_password(elem):
    """
    Render Password component

    Example:

    <Password id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Label]]--></Property>
            <Property name='defaultValue'><!--[CDATA[Test]]--></Property>
        </Properties>
    </Password>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    html = u"""<input type="password" name="{attr_id}" value="{value}" {disabled} {readonly} />""".format(
        attr_id=escape_quote(attrs.get("id", "")),
        value=escape_quote(props.get("defaultvalue", "")),
        disabled=is_disabled(elem),
        readonly=is_readonly(elem)
    )

    return make_div_row(html, elem, props.get("label", ""))


def render_dropdown(elem):
    """
    Render DropDown component

    Example:

    <DropDown id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 sort='0 | 1 | 2 | key | value'
                 order='0 | 1 | 2 | asc | desc'
                 multiple='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Test]]--></Property>
            <Property name='rows'><!--[CDATA[10]]--></Property>
            <Property name='selected'><!--[CDATA[key1,key3]]--></Property>
            <Property name='disabled'><!--[CDATA[key1,key2]]--></Property>
            <Property name='options'>
                <option id='key2'>val2</option>
                <option id='key1'>val1</option>
                <option id='key3'>val3</option>
            </Property>
        </Properties>
    </DropDown>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    rows = parse_int(props.get("rows", "0"), 0)
    options = get_elem_options(props.get("options", []))
    sort_type = SORT_MAP.get(attrs.get("sort", "0"), "default")
    sort_order = SORT_ORDER_MAP.get(attrs.get("order", "0"), "default")

    if sort_type != "default":
        options = sorted(options, key=sort_type)

        if sort_order == "desc":
            options = reversed(options)

    selected_keys = [key.strip() for key in props.get("selected", "").split(",")]
    disabled_keys = [key.strip() for key in props.get("disabled", "").split(",")]

    multiple = is_multiple(elem)
    if not multiple and len(selected_keys) > 1:
        selected_keys = selected_keys[-1:]

    options_html = []
    for key, value in options:
        selected = u"""selected="selected\"""" if key in selected_keys and not (key in disabled_keys) else u""
        disabled = u"""disabled="disabled\"""" if key in disabled_keys else u""

        options_html.append(u"""<option value="{key}" {selected} {disabled}>{value}</option>""".format(
            key=escape_quote(key),
            value=value,
            selected=selected,
            disabled=disabled
        ))

    html = u"""<select name="{attr_id}" {size} {multiple} {disabled}>{options}</select>""".format(
        attr_id=escape_quote(attrs.get("id", "")),
        size=u"""size="{}\"""".format(rows) if rows else u"",
        multiple=multiple,
        disabled=is_disabled(elem),
        options=u"".join(options_html)
    )

    return make_div_row(html, elem, props.get("label", ""))


def render_radiobutton(elem):
    """
    Render RadioButton component

    Example:

    <RadioButton id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'
                 sort='0 | 1 | 2 | key | value'
                 order='0 | 1 | 2 | asc | desc'
                 breakline='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Test]]--></Property>
            <Property name='selected'><!--[CDATA[key1]]--></Property>
            <Property name='options'>
                <option id='key2'>val2</option>
                <option id='key1'>val1</option>
                <option id='key3'>val3</option>
            </Property>
        </Properties>
    </RadioButton>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    disabled = is_disabled(elem)
    selected_key = props.get("selected", "").strip()
    options = get_elem_options(props.get("options", []))
    sort_type = SORT_MAP.get(attrs.get("sort", "0"), "default")
    sort_order = SORT_ORDER_MAP.get(attrs.get("order", "0"), "default")
    breakline = u"<br/>" if to_bool(attrs.get("breakline", "0"), False) else u""

    if sort_type != "default":
        options = sorted(options, key=sort_type)

        if sort_order == "desc":
            options = reversed(options)

    elem_id = escape_quote(attrs.get("id", ""))
    options_html = []
    for key, value in options:
        selected = u"""checked="checked\"""" if key == selected_key else u""
        
        options_html.append(u"""<label><input autocomplete="off" type="radio" name="{attr_id}" value="{key}" {selected} {disabled} />&nbsp;{label}</label>{breakline}""".format(
            attr_id=elem_id,
            selected=selected,
            disabled=disabled,
            label=value,
            key=escape_quote(key),
            breakline=breakline
        ))

    return make_div_row(u"".join(options_html), elem, props.get("label", ""))


def render_checkbox(elem):
    """
    Render CheckBox component

    Example:

    <CheckBox id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 sort='0 | 1 | 2 | key | value'
                 order='0 | 1 | 2 | asc | desc'
                 breakline='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Test]]--></Property>
            <Property name='selected'><!--[CDATA[key1,key2]]--></Property>
            <Property name='disabled'><!--[CDATA[key1,key3]]--></Property>
            <Property name='options'>
                <option id='key2'>val2</option>
                <option id='key1'>val1</option>
                <option id='key3'>val3</option>
            </Property>
        </Properties>
    </CheckBox>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    disabled = is_disabled(elem)
    options = get_elem_options(props.get("options", []))
    sort_type = SORT_MAP.get(attrs.get("sort", "0"), "default")
    sort_order = SORT_ORDER_MAP.get(attrs.get("order", "0"), "default")
    breakline = u"<br/>" if to_bool(attrs.get("breakline", "0"), False) else u""

    if sort_type != "default":
        options = sorted(options, key=sort_type)

        if sort_order == "desc":
            options = reversed(options)

    selected_keys = [key.strip() for key in props.get("selected", "").split(",")]
    disabled_keys = [key.strip() for key in props.get("disabled", "").split(",")]

    options_html = []
    elem_id = escape_quote(attrs.get("id", ""))

    for key, value in options:
        selected = u"""checked="checked\"""" if key in selected_keys else u""
        inactive = u"""disabled="disabled\"""" if disabled or key in disabled_keys else u""
        
        options_html.append(u"""<label><input autocomplete="off" type="checkbox" name="{attr_id}[{key}]" {selected} {disabled} />&nbsp;{label}</label>{breakline}""".format(
            attr_id=elem_id,
            selected=selected,
            disabled=inactive,
            label=value,
            key=escape_quote(key),
            breakline=breakline
        ))

    return make_div_row(u"".join(options_html), elem, props.get("label", ""))


def render_textarea(elem):
    """
    Render TextArea component

    Example:

    <TextArea id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Label]]--></Property>
            <Property name='defaultValue'><!--[CDATA[Test]]--></Property>
            <Property name='width'><!--[CDATA[400]]--></Property>
            <Property name='height'><!--[CDATA[500]]--></Property>
        </Properties>
    </TextArea>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    width = parse_int(props.get("width", "0"), 0)
    height = parse_int(props.get("height", "0"), 0)

    style = u"""style="{width}{height}\"""".format( 
        width=u"width: {}px;".format(width) if width else u"", 
        height=u"height: {}px;".format(height) if height else u""
    )
        
    html = u"""<textarea name="{attr_id}" {disabled} {readonly} {style}>{value}</textarea>""".format(
        attr_id=escape_quote(attrs.get("id", "")),
        disabled=is_disabled(elem),
        readonly=is_readonly(elem),
        style=style,
        value=props.get("defaultvalue", "")
    )       
    
    return make_div_row(html, elem, props.get("label", ""))

def render_hypertext(elem):
    """
    Render Hypertext component

    Example:

    <Hypertext id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'>

        <Properties>
            <Property name='value'><!--[CDATA[<span>blabla</span>]]--></Property>
        </Properties>
    </Hypertext>
    """
    props = get_elem_props(elem) 
    return make_div_row(props.get("value", ""), elem, props.get("label", ""))


def render_button(elem):
    """
    Render Button component

    Example:

    <Button id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 disabled='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Label]]--></Property>
            <Property name='buttonAlign'><!--[CDATA[center | justify | left | right | start | end]]--></Property>
            <Property name='buttonImage'><!--[CDATA[/path/to/image.png]]--></Property>
        </Properties>
    </Button>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    align = props.get("buttonalign", "").strip().replace("'",'&acute;')
    image = props.get("buttonimage", "").strip().replace("'",'&acute;')
    label = props.get("label", "").replace("'",'&acute;')

    if image:
        button = u"""<input type="image" alt="{label}" title="{label}" src="{img}" {disabled} />""".format( 
            label=label,
            img=image,
            disabled=is_disabled(elem)
        )

    else:
        button = u"""<input type="submit" value="{label}" {disabled} />""".format(
            label=label,
            disabled=is_disabled(elem)
        )

    return (u"""<div class="row" {visible}>"""
            u"""<div id='{attr_id}' class="submit {classes}" style="text-align: {align}">"""
            u"""{button}"""
            u"""</div>"""
            u"""</div>""").format(
                visible=is_visible(elem),
                align=align,
                button=button,
                classes=attrs.get('class', ''),
                attr_id=escape_quote(attrs.get('id', ''))
            )


def render_default_button():
    """
    Render default form button
    """
    return u"""<div class="submit"><input type="submit" /></div>"""


def render_container(elem):
    """
    Render Container component

    Example:

    <Container id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'>
        <Properties>
            <Property name='width'><!--[CDATA[400px | 100%]]--></Property>
            <Property name='height'><!--[CDATA[500px | 100%]]--></Property>
        </Properties>  
        <Components>
            <Button>...
            <DropDown>...
            <Container>...
        </Components>
    </Container>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    width = props.get("width", "")
    height = props.get("height", "")

    style = u"""style="{width}{height}{visibility}\"""".format( 
        width=u"width: {};".format(width) if width else u"", 
        height=u"height: {};".format(height) if height else u"",
        visibility=u"display: none;" if is_visible(elem) else u"" ,
    )

    components = elem.getElementsByTagName('Components')
    components = render_components(components[0], elem.form_id) if components else u""    

    return (u"""<div id="{attr_id}" class="row fullsize {classes}" {style}>"""
            u"""<div class="item">"""
            u"""{components}"""
            u"""</div>"""
            u"""</div>""").format(
                attr_id=escape_quote(attrs.get("id", "")),
                classes=attrs.get("classes", ""),
                style=style,
                components=components
            )    


def render_livesearch(elem):
    """
    Render LiveSearch component

    Example:

    <LiveSearch id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'>
        <Properties>
            <Property name='label'><!--[CDATA[LiveSearch]]--></Property>
            <Property name='sourceURI'><!--[CDATA[/blabla/livesearch]]--></Property>
            <Property name='sourceEvent'><!--[CDATA[something or empty]]--></Property>
            <Property name='sourceData'><!--[CDATA[["key1", "key2", "key3", "key4"] | [{label: '', value: ''}, {label: '', value: ''}]]]--></Property>                   
        </Properties>  
    </LiveSearch>

    If sourceEvent presented: callback 'liveSearch' will be executed, so do not forget register it.
    Params are:
        textarea - textarea object
        term - search query

    You need return data in format presented in sourceData
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    html = u"""<div id="xml-dialog-lvs-{attr_id}-data">{sourceData}</div><input id="xml-dialog-lvs-{attr_id}" name="{attr_id}" {disabled} {readonly} sourceuri="{sourceURI}" sourceevent="{sourceEvent}" value="{value}" />""".format(

        attr_id=escape_quote(attrs.get("id", "")),
        value=escape_quote(props.get("defaultvalue", "")),
        disabled=is_disabled(elem),
        readonly=is_readonly(elem),
        sourceURI=escape_quote(props.get("sourceuri", "")),
        sourceEvent=escape_quote(props.get("sourceevent", "")),
        sourceData=props.get("sourcedata", "").replace("&", "&amp;").replace("<", "&lt;")
    )

    return make_div_row(html, elem, props.get("label", ""))


def render_richtextarea(elem):
    """
    Render RichTextAreat component

    Example:

    <RichTextArea id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'>
        <Properties>
            <Property name='label'><!--[CDATA[Rich Text Area]]--></Property>
            <Property name='defaultValue'><!--[CDATA[default value]]--></Property>
            <Property name='height'><!--[CDATA[500]]--></Property>
        </Properties>  
    </RichTextArea>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    html = u"""<textarea id="xml-dialog-rte-{attr_id}" name="{attr_id}" {disabled} {readonly} eheight="{height}">{value}</textarea>""".format(
        attr_id=escape_quote(attrs.get("id", "")),
        value=escape_quote(props.get("defaultvalue", "")),
        disabled=is_disabled(elem),
        readonly=is_readonly(elem),
        height=props.get("height", ""),
    )

    return make_div_row(html, elem, props.get("label", ""))


def render_fileupload(elem):
    """
    Render FileUpload component

    Example:

    <FileUpload id='uploadName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 fullsize='1 | 0 | true | false'>

        <Properties>
            <Property name='label'><!--[CDATA[Label]]--></Property>
        </Properties>
    </FileUpload>
    """
    attrs = get_elem_attrs(elem)
    props = get_elem_props(elem)

    code = u"""<script type="text/javascript">
        var max_fileupload_size = 15 * 1024 * 1024;
        var fileupload_next = 1;
        var fileupload_progress = 0;
        var update_selected_files = function() {{
            var val = "";
            $(".{attr_id}-guid").each(function(i) {{
                if (val != "") val = val + ",";
                val = val + $(this)[0].value;
            }});
            $("#{attr_id}")[0].value = val;
        }}
        var add_uploaded_file = function(filename, guid) {{
                var newelem = '<input type="text" id="{attr_id}_' + fileupload_next + '_name" name="{attr_id}_' + fileupload_next + '_name" readonly="readonly" disabled="disabled" />';
                var newelement = $(newelem);
                newelement[0].value = filename;
                var removebtn = '<button id="{attr_id}_remove_' + fileupload_next + '" class="{attr_id}-remove-me">x</button></div><div id="{attr_id}_div">';
                var removebutton = $(removebtn);
                var guidelem = '<input type="hidden" id="{attr_id}_' + fileupload_next + '" name="{attr_id}_' + fileupload_next + '" class="{attr_id}-guid" disabled="disabled" />';
                var guidelement = $(guidelem);
                guidelement[0].value = guid;
                $("#{attr_id}_input").before(newelement);
                $(newelement).after(guidelement);
                $(guidelement).after(removebutton);
                fileupload_next = fileupload_next + 1;
                $(".{attr_id}-remove-me").click(function(e) {{
                    e.preventDefault();
                    var fieldnum = this.id.substring("{attr_id}".length + 8);
                    $(this).remove();
                    $("#{attr_id}_" + fieldnum + "_name").remove();
                    $("#{attr_id}_" + fieldnum).remove();
                    update_selected_files();
                }});
                update_selected_files();
        }}
        var fileupload_started = function() {{
            if (fileupload_progress == 0) $('input[type="submit"]', $("#{form_id}")).attr("disabled", true);
            fileupload_progress = fileupload_progress + 1;
        }}
        var fileupload_ended = function() {{
            if (fileupload_progress > 0) fileupload_progress = fileupload_progress - 1;
            if (fileupload_progress == 0) {{
                $("#{attr_id}_progress")[0].innerHTML = "";
                $('input[type="submit"]', $("#{form_id}")).attr("disabled", false);
            }}
        }}
        var init_file_upload = function() {{
            $("#{form_id}").fileUploadUI({{
                url: "/upload.py",
                dataType: "json",
                dropZone: $("#{form_id}"),
                autoUpload: true,
                replaceFileInput: false,
                onComplete: function (event, files, index, xhr, handler) {{
                    var resp = xhr.response.trim();
                    if (xhr.status == 200 && resp.length == 36) add_uploaded_file(files[0].name, resp);
                    else {{
                        if (xhr.status != 200) alert("Upload error: " + xhr.statusText);
                        else alert("Upload error");
                    }}
                    fileupload_ended();
                }},
                onSend: function (event, files, index, xhr, handler) {{
                    if (!xhr.upload && handler.progressbar) handler.progressbar.progressbar("value", 100);
                    if (event.target.type == "file") event.target.value = "";
                    if (files[0].size <= max_fileupload_size) fileupload_started();
                    else alert("File is too big");
                }},
                onError: function (event, files, index, xhr, handler) {{
                }},
                onProgressAll: function (event, list) {{
                    if (fileupload_progress > 0) {{
                        var percent = parseInt(event.loaded / event.total * 100, 10);
                        $("#{attr_id}_progress")[0].innerHTML = "Uploading " + fileupload_progress + " file(s)... " + percent + "%";
                    }}
                }},
                onProgress: function (progressEvent, files, index, xhr, settings) {{
                    if (files[0].size > max_fileupload_size) xhr.abort();
                }},
            }});
        }}
        $(document).ready(function(){{
            init_file_upload();
        }});
    </script>""".format(attr_id=escape_quote(attrs.get("id", "")), form_id=escape_quote(elem.form_id))

    html = """<div id="{attr_id}_div"><input id="{attr_id}_input" name="{attr_id}_input" type="file"/><div id="{attr_id}_progress"></div><input id="{attr_id}" name="{attr_id}" type="hidden"/></div>""".format(attr_id=escape_quote(attrs.get("id", "")))

    return make_div_row(html, elem, props.get("label", "")) + code


def render_codeeditor(elem):
	"""
	Render CodeEditor component

	Example:

    <CodeEditor id='inputName'
                 class='css class'
                 visible= '1 | 0 | true | false'
                 disabled='1 | 0 | true | false'
                 readonly='1 | 0 | true | false'>
        <Properties>
            <Property name='label'><!--[CDATA[Code Editor Label]]--></Property>
            <Property name='value'><!--[CDATA[default value]]--></Property>
            <Property name='width'><!--[CDATA[360]]--></Property>
            <Property name='height'><!--[CDATA[130]]--></Property>
            <Property name='syntax'><!--[CDATA[python]]--></Property>
        </Properties>..
    </CodeEditor>
    """

	attrs = get_elem_attrs(elem)
	props = get_elem_props(elem)

	style = u"""overflow: visible; width: {width}px; height: {height}px; padding: 2px 5px 2px 5px; font: 14px tahoma""".format(width = props.get("width", ""), height = props.get("height", ""))
	style_area = u"""width:{width}px; height:{height}px""".format(width = props.get("width", ""), height = props.get("height", ""))

	html = u"""
<style type="text/css">#{id} .CodeMirror-scroll {{ height: {height}px; }}</style>
<div id="{id}" style="{style}">
	<textarea name="{name}" style="{style_area}">{value}</textarea>
</div>
<script type="text/javascript">$q(document).bind('dialog.loaded', function(){{
	if (typeof window.{id}_codeeditor !== 'undefined') {{
		window.{id}_codeeditor.toTextArea();
		delete(window.{id}_codeeditor);
	}}
	window.{id}_codeeditor = CodeMirror.fromTextArea($q('#{id}>textarea').get(0), {{
		mode: '{mode}',
		lineNumbers: true,
		styleActiveLine: true,
		onCursorActivity: function() {{ window.{id}_codeeditor.matchHighlight("CodeMirror-matchhighlight"); }}
	}})
	$q('#{id}').parents('form:first').submit(function(){{
		window.{id}_codeeditor.save()
	}})
	window.{id}_codeeditor.refresh()
}});</script>
""".format(
		id	 = u"xml_dialog_ce_" + escape_quote(attrs.get("id", "")),
		name   = escape_quote(attrs.get("id", "")),
		mode   = props.get("syntax", ""),
		style  = style,
		style_area = style_area,
		value  = unicode(props.get("value", "")).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('"', '&quot;'),
		width  = props.get("width", ""),
		height = props.get("height", ""),
	)
	return html
#	return make_div_row(html, elem, props.get("label", ""))


COMPONENTS_MAP = {
    "heading" : render_heading,
    "textbox" : render_textbox,
    "password" : render_password,
    "dropdown" : render_dropdown,
    "radiobutton" : render_radiobutton,
    "checkbox" : render_checkbox,
    "textarea" : render_textarea,
    "hypertext" : render_hypertext,
    "button" : render_button,
    "livesearch": render_livesearch,
    "container": render_container,
    "fileupload" : render_fileupload,
    "richtextarea": render_richtextarea,
    "codeeditor": render_codeeditor,
}


def render_components(components, form_id):
    """
    Render XML components to HTML
    """
    result = []

    for elem in components.childNodes:
        if elem.nodeType != elem.ELEMENT_NODE:
            continue

        render = COMPONENTS_MAP.get(elem.localName.lower(), None)
        if render:
            elem.form_id = form_id
            result.append(render(elem))

    return "".join(result)


# try:
#     parent_class = VDOM_object

# except Exception as ex:
#     parent_class = object

#     VDOM_CONFIG_1 = {
#         "ENABLE-PAGE-DEBUG": "1",
#         "DEBUG": "1"
#     }


class VDOM_xmldialog(VDOM_object):
    """
    XML Dialog class
    """
        
    def exception_to_str(self, error, is_wysiwyg=False):
        """
        Exception to string
        """
        err_str = u""
        
        if is_wysiwyg or VDOM_CONFIG_1["ENABLE-PAGE-DEBUG"] == "1":
            err_str = u"""<p style="color:#ff0000;"><b>Error:</b> {0}</p>""".format(error)

        else:
            if VDOM_CONFIG_1["DEBUG"]=="1" :
                err_str = u"""<!--<p>Error: {0}</p>-->""".format(error)
                
        return err_str
    
    def xml_to_html(self, is_wysiwyg=False):
        """
        Conver XML data to HTML
        """
        if not self.xmldata:
            return u""

        try:
            xml_data = self.xmldata.encode("utf8")

        except Exception as ex:
            raise
            return self.exception_to_str(ex, is_wysiwyg=is_wysiwyg)

        xml_data = xml_data.replace('<!--[CDATA[', '<![CDATA[')\
                           .replace(']]-->', ']'+']>')

        if is_wysiwyg:
            # if WYSIWYG render - remove <script></script> from XML
            xml_data = RE_REMOVE_SCRIPT.sub("", xml_data)

        try:
            dom = parseString(xml_data)

        except Exception as ex:
            raise
            return self.exception_to_str(ex, is_wysiwyg=is_wysiwyg)

        form_id = u'xml_form_' + (self.id).replace('-', '_')

        components = dom.getElementsByTagName('Components')

        try:
            output = render_components(components[0], form_id) if components else u""

        except Exception as ex:
            raise
            return self.exception_to_str(ex, is_wysiwyg=is_wysiwyg)

        if not dom.getElementsByTagName("Button"):
            output += render_default_button()
        csrftoken = '<input type="hidden" name="%s" value="%s">' % (csrf_token_arg_name, create_csrf_token())
        return self.parse_dialog_title(dom), u"""<form id="{}" action="" method="post" enctype="multipart/form-data" class="xml-dialog-form">{} {}</form>""".format(form_id, output, csrftoken)


    def parse_dialog_title(self, elem):
        """
        Parse title value from DOM
        """
        default_title = self.title

        vdomf = elem.getElementsByTagName("VDOMFormContainer")
        if not vdomf:
            return default_title

        props = get_elem_props(vdomf[0])
        return props["label"] if "label" in props else default_title

    def render(self, parent, contents=""):
        """
        VDOM Object render
        """
        idn = (self.id).replace('-', '_')
        oid = u'o_' + idn

        show = "false" if self.show == "0" else "true"
        modal = "false" if self.modal == "0" else "true"
        
        render_result = self.xml_to_html()
        if isinstance(render_result, (list, tuple)):
            title, html = render_result

        else:
            title, html = '', render_result
        
        if VDOM_CONFIG_1["DEBUG"] == "1":
            debug_info = u"objtype='xmldialog' objname='%s' ver='%s'" % (self.name, self.type.version)
        else:
            debug_info = u""

        result = """
<div style='display:none' %(debug_info)s><div id='%(id)s'>%(data)s</div></div>
<script type='text/javascript'>$q(function(){
    dialog = $q("#%(id)s")
    var dialogScripts = $q("#%(id)s").find("script");
    dialogScripts.remove();
    $q("#%(id)s").data('ev','1');
    $q("#%(id)s:ui-dialog").dialog("destroy");
    $q("#%(id)s").dialog({
        title: "%(title)s",
        width: %(width)s,
        height: %(height)s,
        modal: %(modal)s,
        draggable: !%(modal)s,
        resizable: false,
        autoOpen: %(show)s,
        open: function(e,u) {
            var dialog = $q("#%(id)s");
            if (dialog.data('ev')=='1') execEventBinded('%(idn)s', "show", {});

            vdom_xd_create_richtextarea(dialog);
            vdom_xd_create_livesearch(dialog);

            $j.datepicker.setDefaults($j.datepicker.regional['fr']);
            $j('#%(id)s input.date, #%(id)s .date input').datepicker('destroy').datepicker({
                dateFormat: 'dd/mm/yy', showButtonPanel: true
            }).blur();
        },
        close: function(e,u) {
            $j('#ui-datepicker-div,#ColorDropdown_selector').fadeOut();
            if ($q("#%(id)s").data('ev')=='1') execEventBinded('%(idn)s', "hide", {});
        }
    });
    
    $q("#%(id)s form.xml-dialog-form").live('submit',function(e){
        function escapeXml(s) {
            return s.replace(/[<>&'"]/g, function (c) {
                switch (c) {
                    case '<': return '&lt;';
                    case '>': return '&gt;';
                    case '&': return '&amp;';
                    case "'": return '&apos;';
                    case '"': return '&quot;';
                }
            });
        }
        e.preventDefault;
        for (var i in window["xmlDialogTinyEditors"])
            window["xmlDialogTinyEditors"][i].post();

        var x=[], a=$q(this).serializeArray();
        for (k in a) if(typeof a[k].name !== 'undefined' && typeof a[k].value !== 'undefined') x[escapeXml(a[k].name)]=a[k].value;
        execEventBinded('%(idn)s', "submit", x);
        return false;
    });
    
    $(document).trigger('dialog.loaded')
    var dialogContainer = document.getElementById('%(id)s');
    dialogScripts.each(function() { dialogContainer.appendChild(this); });
});</script>""" % {
            "data":   html,
            "id":     oid,
            "idn":    idn,
            "width":  self.width,
            "height": self.height,
            "title":  title.replace('"','&quot;'),
            "show":   show,
            "modal":  modal,
            "debug_info": debug_info
        }

        return  VDOM_object.render(self, parent, contents=result)

    def wysiwyg(self, parent, contents=""):
        """
        WYSIWYG render
        """
        dialog_width = int(self.width) if int(self.width) >= 150 else 150
        dialog_height = int(self.height) if int(self.height) >= 50 else 50
        
        render_result = self.xml_to_html(True)
        if isinstance(render_result, (list, tuple)):
            title, html = render_result

        else:
            title, html = '', render_result

        title = title.replace('"','&quot;')

        result= \
            u"""<container id="{id}" hierarchy="{hierarchy}" order="{order}" 
                            top="{top}" left="{left}" width="{width}" height="{height}" overflow="visible">
                    <svg>
                        <rect x="0" y="0" rx="7" ry="5" width="{width}" height="{height}" fill="#eeeeee"/>
                        <rect x="3" y="3" rx="7" ry="5" width="{rect_width}" height="30" fill="#333333"/>
                        <line x1="{line_x1}"  y1="14" x2="{line_x2}"   y2="22" style="stroke:#eeeeee; stroke-width:3;"/>
                        <line x1="{line_x1}"  y1="22" x2="{line_x2}"   y2="14" style="stroke:#eeeeee; stroke-width:3;"/>
                        <text x="13" y="22" width="{title_width}" fill="#eeeeee" font-size="14">{dlg_title}</text>
                    </svg>
                    
                    <htmltext top="35" left="10" width="{content_width}" height="{content_height}">
                        <div>{xmldata}</div>
                    </htmltext>
                </container>
            """.format( 
                id=self.id,
                hierarchy=self.hierarchy,
                order=self.order, 
                top=self.top,
                left=self.left, 
                width=self.width,
                height=self.height,
                rect_width=dialog_width-6,
                line_x1=dialog_width-20,
                line_x2=dialog_width-12,
                title_width=dialog_width-25,
                content_height=dialog_height-40,
                content_width=dialog_width-20,
                xmldata=html,
                dlg_title=title
            )

        return VDOM_object.wysiwyg(self, parent, contents=result)


# if __name__ == "__main__":

#     xml_dialog = VDOM_xmldialog()
#     xml_dialog.title = "Default title"
#     xml_dialog.id = "9f1c05cd-fee2-6055-2ef4-16fae6375ed7"
#     xml_dialog.show = "1"
#     xml_dialog.modal = "1"
#     xml_dialog.width = "300"
#     xml_dialog.height = "300"
#     xml_dialog.top = "0"
#     xml_dialog.left = "0"
#     xml_dialog.hierarchy = "0"
#     xml_dialog.order = "0"
#     xml_dialog.name = "xmldialog"

#     xml_dialog.xmldata = \
# u"""<?xml version='1.0' encoding='utf-8'?>
# <VDOMFormContainer>
#     <Properties>
#         <Property name='label'><!--[CDATA[Default Email Composer]]--></Property>
#     </Properties>
#     <Components>
#     <RichTextArea id='inputName'
#                  class='css class'
#                  visible= '1 | 0 | true | false'
#                  fullsize='1 | 0 | true | false'
#                  disabled='1 | 0 | true | false'
#                  readonly='1 | 0 | true | false'>
#         <Properties>
#             <Property name='label'><!--[CDATA[Rich Text Area]]--></Property>
#             <Property name='defaultValue'><!--[CDATA[default value]]--></Property>
#         </Properties>  
#     </RichTextArea>
#     </Components>
# </VDOMFormContainer>"""

#     print xml_dialog.wysiwyg('', '')
#     print xml_dialog.render('', '')

		]]></SourceCode>
  <Libraries>
    <Library Target="HTML"><![CDATA[<link rel="stylesheet" media="screen" type="text/css" href="/9f1c05cd-fee2-6055-2ef4-16fae66214c8.res" />
<script type="text/javascript" src="/9f1c05cd-fee2-6055-2ef4-16fae32145d0.res"></script>
<script type="text/javascript" src="/9f1c05cd-fee2-6055-2ef4-16fae32bafe5.res"></script>
<script type="text/javascript" src="/9f1c05cd-fee2-6055-2ef4-16fae6cbdfa6.res"></script>
<script type="text/javascript" src="/966f39fb-3da2-95f2-c33a-398880aff765.res?v2.22"></script>
<script type="text/javascript" src="/5cd10fee-6e10-5253-24ea-3edb0a87f9ec.res?match"></script>
<script type="text/javascript" src="/95be4415-7ccb-b87b-f50f-77c8485f6bd9.res?syntaxes"></script>
<script type='text/javascript' src='/b4993ec8-6d66-8240-22a7-48fbbedfe371.res'></script>

<style type="text/css">
.CodeMirror {
	line-height: 1em;
	font-family: monospace;
	border: 1px solid silver;
	overflow: visible;
}

.CodeMirror-scroll { 
	overflow: auto;
	position: relative;
}

.CodeMirror-gutter { position: absolute; left: 0; top: 0; z-index: 10; background-color: #f7f7f7; border-right: 1px solid #eee; min-width: 2em; height: 100%; }
.CodeMirror-gutter-text { color: #aaa; text-align: right; padding: .4em .2em .4em .4em; white-space: pre !important; }
.CodeMirror-lines { padding: .4em; }

.CodeMirror pre {
-moz-border-radius: 0;
-webkit-border-radius: 0;
-o-border-radius: 0; border-radius: 0; border-width: 0; margin: 0; padding: 0; background: transparent;
font-family: inherit; font-size: inherit; padding: 0; margin: 0; white-space: pre; word-wrap: normal; }

.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; }
.CodeMirror-wrap .CodeMirror-scroll { 
	/*overflow-x: auto;*/
}

.CodeMirror textarea { outline: none !important; }

.CodeMirror pre.CodeMirror-cursor { z-index: 10; position: absolute; visibility: hidden; border-left: 1px solid black; border-right:none; width:0; }
.CodeMirror pre.CodeMirror-cursor.CodeMirror-overwrite {}
.CodeMirror-focused pre.CodeMirror-cursor { visibility: visible; }

div.CodeMirror-selected { background: #d9d9d9; }
.CodeMirror-focused div.CodeMirror-selected { background: #d7d4f0; }

.CodeMirror-searching {
background: #ffa;
background: rgba(255, 255, 0, .4);
}

span.CodeMirror-matchhighlight { background: #ff1 }
.CodeMirror-focused span.CodeMirror-matchhighlight { background: #ff1; !important }

/* Default theme */

.cm-s-default span.cm-keyword {color: #708;}
.cm-s-default span.cm-atom {color: #219;}
.cm-s-default span.cm-number {color: #164;}
.cm-s-default span.cm-def {color: #00f;}
.cm-s-default span.cm-variable {color: black;}
.cm-s-default span.cm-variable-2 {color: #05a;}
.cm-s-default span.cm-variable-3 {color: #085;}
.cm-s-default span.cm-property {color: black;}
.cm-s-default span.cm-operator {color: black;}
.cm-s-default span.cm-comment {color: #999;}
.cm-s-default span.cm-string {color: #a11;}
.cm-s-default span.cm-string-2 {color: #f50;}
.cm-s-default span.cm-meta {color: #555;}
.cm-s-default span.cm-error {color: #f00;}
.cm-s-default span.cm-qualifier {color: #555;}
.cm-s-default span.cm-builtin {color: #30a;}
.cm-s-default span.cm-bracket {color: #cc7;}
.cm-s-default span.cm-tag {color: #170;}
.cm-s-default span.cm-attribute {color: #00c;}
.cm-s-default span.cm-header {color: #a0a;}
.cm-s-default span.cm-quote {color: #090;}
.cm-s-default span.cm-hr {color: #999;}
.cm-s-default span.cm-link {color: #00c;}

span.cm-header, span.cm-strong {font-weight: bold;}
span.cm-em {font-style: italic;}
span.cm-emstrong {font-style: italic; font-weight: bold;}
span.cm-link {text-decoration: underline;}

div.CodeMirror span.CodeMirror-matchingbracket {color: #0f0;}
div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #f22;}
</style>

]]></Library>
  </Libraries>
  <E2vdom>
    <Events>
      <Userinterfaceevents>
        <Event Name="customEvent" Help="#Lang(506)">
          <Parameters>
            <Parameter Name="macros_id" Order="" VbType="" Help="#Lang(901)"/>
          </Parameters>
        </Event>
        <Event Name="hide" Help="#Lang(507)">
          <Parameters/>
        </Event>
        <Event Name="show" Help="#Lang(508)">
          <Parameters/>
        </Event>
        <Event Name="submit" Help="#Lang(509)">
          <Parameters>
            <Parameter Name="params" Order="" VbType="" Help="#Lang(902)"/>
          </Parameters>
        </Event>
      </Userinterfaceevents>
    </Events>
    <Actions>
      <Container ID="2330fe83-8cd6-4ed5-907d-11874e7ebcf4">
        <Action Help="#Lang(501)" InterfaceName="#Lang(601)" MethodName="executeCallback">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(701)" ScriptName="callbackName" Help="#Lang(801)" RegularExpressionValidation=".*"/>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(702)" ScriptName="params" Help="#Lang(802)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[
$q("#"+this.domCont.id).dialog('executeCallback', callbackName, params);
]]></SourceCode>
        </Action>
        <Action Help="#Lang(502)" InterfaceName="#Lang(602)" MethodName="hide">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(703)" ScriptName="fade" Help="#Lang(803)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[
$q("#"+this.domCont.id).dialog('close');
]]></SourceCode>
        </Action>
        <Action Help="#Lang(503)" InterfaceName="#Lang(603)" MethodName="loadData">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(704)" ScriptName="xmldata" Help="#Lang(804)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[
vdom_xd_load("#"+this.domCont.id,xmldata);
]]></SourceCode>
        </Action>
        <Action Help="#Lang(504)" InterfaceName="#Lang(604)" MethodName="resizeTo">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(705)" ScriptName="width" Help="#Lang(805)" RegularExpressionValidation=".*"/>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(706)" ScriptName="height" Help="#Lang(806)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[
$q("#"+this.domCont.id).dialog("option",{width:parseInt(width,10),height:parseInt(height,10)});
]]></SourceCode>
        </Action>
        <Action Help="#Lang(505)" InterfaceName="#Lang(605)" MethodName="show">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(707)" ScriptName="fade" Help="#Lang(807)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[
$q("#"+this.domCont.id).dialog('open');
]]></SourceCode>
        </Action>
      </Container>
    </Actions>
  </E2vdom>
</Type>